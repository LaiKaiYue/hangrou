<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>å¤¯è‚‰ HANGROU - POS é»é¤ç³»çµ±åŸå‹</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            /* ç¦æ­¢è§¸æ§ç¸®æ”¾å’Œæ‰‹å‹¢æ“ä½œ */
            touch-action: manipulation;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }

        /* å…è¨±è¼¸å…¥æ¡†é¸å–æ–‡å­— */
        input, textarea {
            -webkit-user-select: text;
            user-select: text;
        }

        html {
            /* å…è¨±æ­£å¸¸çš„æ‰‹å‹¢æ“ä½œï¼Œä½†ç¦ç”¨æ‰‹å‹¢ç¸®æ”¾ */
            touch-action: manipulation;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans TC", sans-serif;
            background: #F8F9FA;
            color: #2D3436;
            overflow-x: hidden;
            /* å…è¨±æ­£å¸¸æ‰‹å‹¢ï¼Œä½†ç¦ç”¨ç¸®æ”¾ */
            touch-action: manipulation;
            -webkit-overflow-scrolling: touch;
        }

        /* é ‚éƒ¨å›ºå®šå€å¡Š */
        .top-fixed-bar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            background: white;
        }

        /* é ‚éƒ¨å°èˆª */
        .header {
            background: #FF6B35;
            color: white;
            padding: 12px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            /* å›ºå®šé«˜åº¦ä»¥æ–¹ä¾¿è¨ˆç®— */
            height: 56px;
        }

        .header h1 {
            font-size: 20px;
            font-weight: 600;
        }

        .header-buttons {
            display: flex;
            gap: 10px;
        }

        .header-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }

        .header-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        .header-business-date {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: default;
            font-size: 14px;
            font-weight: 600;
            display: flex;
            align-items: center;
            transition: all 0.2s;
        }

        /* åˆ†é¡æ¨™ç±¤ */
        .category-tabs {
            display: flex;
            gap: 8px;
            padding: 12px 20px;
            background: white;
            overflow-x: auto;
            white-space: nowrap;
            border-bottom: 1px solid #DFE6E9;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            /* å›ºå®šé«˜åº¦ä»¥æ–¹ä¾¿è¨ˆç®— */
            height: 56px;
            /* iPad Safari æ»¾å‹•å„ªåŒ– */
            -webkit-overflow-scrolling: touch;
            touch-action: pan-x;
            overscroll-behavior: contain;
        }

        .category-tab {
            padding: 6px 20px;
            background: #F8F9FA;
            border: 2px solid #F8F9FA;
            border-radius: 20px;
            cursor: pointer;
            font-size: 16px;
            line-height: 1.4;
            transition: all 0.2s;
            /* ç¢ºä¿æŒ‰éˆ•é«˜åº¦åˆé© */
            height: 32px;
            display: flex;
            align-items: center;
        }

        .category-tab.active {
            background: #FF6B35;
            color: white;
            border-color: #FF6B35;
        }

        /* ä¸»å…§å®¹å€ */
        .main-content {
            display: flex;
            /* å›ºå®šåœ¨é ‚éƒ¨å€å¡Šä¸‹æ–¹ */
            position: fixed;
            top: 112px; /* header(56px) + category-tabs(56px) */
            left: 0;
            right: 0;
            bottom: 0;
            /* é«˜åº¦è‡ªå‹•å¡«æ»¿å‰©é¤˜ç©ºé–“ */
        }

        /* é¸å–®å€åŸŸ */
        .menu-section {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            /* iPad Safari æ»¾å‹•å„ªåŒ– */
            -webkit-overflow-scrolling: touch;
            position: relative;
            /* å…è¨±æ­£å¸¸æ»¾å‹•æ‰‹å‹¢ */
            touch-action: pan-y;
            overscroll-behavior: contain;
            /* ç¢ºä¿ flex é«˜åº¦æ­£ç¢ºè¨ˆç®— */
            min-height: 0;
            height: 100%;
        }

        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 16px;
        }

        .menu-item {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            cursor: pointer;
            /* ç§»é™¤éæ¸¡å‹•ç•«ä»¥æå‡è§¸æ§éŸ¿æ‡‰é€Ÿåº¦ */
            transition: none;
            /* å…è¨±æ­£å¸¸çš„æ‰‹å‹¢æ“ä½œï¼Œç”± JavaScript åˆ¤æ–·æ˜¯é»æ“Šé‚„æ˜¯æ»¾å‹• */
            touch-action: auto;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            -webkit-user-select: none;
            min-height: 80px;
            display: flex;
            align-items: center;
        }

        .menu-item:hover {
            transform: translateY(-4px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.12);
        }

        .menu-item:active {
            transform: scale(0.98);
            background: #F8F9FA;
        }

        .menu-item.pressed {
            transform: scale(0.98);
            background: #F8F9FA;
        }

        .menu-item-info {
            padding: 16px;
            width: 100%;
        }

        .menu-item-name {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .menu-item-price {
            font-size: 20px;
            color: #FF6B35;
            font-weight: 600;
        }

        /* è³¼ç‰©è»Šå´é‚Šæ¬„ */
        .cart-sidebar {
            width: 380px;
            background: white;
            border-left: 1px solid #DFE6E9;
            display: flex;
            flex-direction: column;
            /* é«˜åº¦ç”±çˆ¶å®¹å™¨è‡ªå‹•æ±ºå®š */
            height: 100%;
            overflow: hidden;
        }

        .cart-header {
            padding: 16px 20px;
            background: #FF8C42;
            color: white;
            font-size: 18px;
            font-weight: 600;
            /* ç¢ºä¿ header ä¸å¯å£“ç¸® */
            flex-shrink: 0;
        }

        .cart-items {
            flex: 1;
            overflow-y: auto;
            padding: 12px;
            /* iPad Safari æ»¾å‹•å„ªåŒ– */
            -webkit-overflow-scrolling: touch;
            position: relative;
            touch-action: pan-y;
            overscroll-behavior: contain;
            /* ç¢ºä¿ flex é«˜åº¦æ­£ç¢ºè¨ˆç®— */
            min-height: 0;
        }

        .cart-item {
            background: #F8F9FA;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 8px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .cart-item-info {
            flex: 1;
        }

        .cart-item-name {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .cart-item-price {
            color: #636E72;
            font-size: 14px;
        }

        .cart-item-bottom {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .cart-item-actions {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .cart-item-total-price {
            font-weight: 600;
            color: #2D3436;
            font-size: 16px;
            text-align: right;
        }

        .quantity-btn {
            width: 32px;
            height: 32px;
            border: none;
            background: #FF6B35;
            color: white;
            border-radius: 4px;
            cursor: pointer;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            /* ç§»é™¤éæ¸¡å‹•ç•«ä»¥æå‡è§¸æ§éŸ¿æ‡‰é€Ÿåº¦ */
            transition: none;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            -webkit-user-select: none;
        }

        .quantity-btn:hover {
            background: #FF8C42;
        }

        .quantity-btn:active {
            transform: scale(0.95);
            background: #E65A2B;
        }

        .quantity-btn.pressed {
            transform: scale(0.95);
            background: #E65A2B;
        }

        .quantity-display {
            font-weight: 600;
            min-width: 30px;
            text-align: center;
        }

        .delete-btn {
            background: #D63031;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            /* ç§»é™¤éæ¸¡å‹•ç•«ä»¥æå‡è§¸æ§éŸ¿æ‡‰é€Ÿåº¦ */
            transition: none;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            -webkit-user-select: none;
        }

        .delete-btn:active {
            transform: scale(0.95);
            background: #B02929;
        }

        /* é€šç”¨æ“ä½œæŒ‰éˆ•æ¨£å¼ */
        .action-button {
            background: #FF6B35;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            /* ç§»é™¤éæ¸¡å‹•ç•«ä»¥æå‡è§¸æ§éŸ¿æ‡‰é€Ÿåº¦ */
            transition: none;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            -webkit-user-select: none;
        }

        .action-button:hover {
            background: #FF8C42;
        }

        .action-button:active {
            transform: scale(0.95);
            background: #E65A2B;
        }

        /* æ—¥æœŸé¸æ“‡å™¨è¼¸æ¡†æ¨£å¼ */
        .menu-input {
            padding: 10px 14px;
            border: 2px solid #DFE6E9;
            border-radius: 4px;
            font-size: 15px;
            background: white;
            color: #2D3436;
            outline: none;
        }

        .menu-input:focus {
            border-color: #FF6B35;
        }

        .delete-btn.pressed {
            transform: scale(0.95);
            background: #B02929;
        }

        .cart-footer {
            padding: 16px 20px;
            background: #F8F9FA;
            border-top: 1px solid #DFE6E9;
            /* ç¢ºä¿ footer ä¸å¯å£“ç¸®ï¼Œå§‹çµ‚å¯è¦‹ */
            flex-shrink: 0;
        }

        .cart-summary {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            font-size: 16px;
        }

        .cart-total {
            font-size: 24px;
            font-weight: 600;
            color: #FF6B35;
        }

        .cart-actions {
            display: flex;
            gap: 8px;
        }

        .btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background: #FF6B35;
            color: white;
        }

        .btn-primary:hover {
            background: #FF8C42;
        }

        .btn-secondary {
            background: #636E72;
            color: white;
        }

        .btn-secondary:hover {
            background: #2D3436;
        }

        /* çµå¸³å½ˆçª— */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: white;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow: hidden;
            /* iPad Safari æ»¾å‹•å„ªåŒ– */
            -webkit-overflow-scrolling: touch;
            position: relative;
            display: flex;
            flex-direction: column;
        }

        .modal-header {
            background: #FF6B35;
            color: white;
            padding: 16px 20px;
            border-radius: 12px 12px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
        }

        .modal-body {
            padding: 20px;
            flex: 1;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            touch-action: pan-y;
            overscroll-behavior: contain;
        }

        .modal-header {
            flex-shrink: 0;
        }

        .order-info {
            background: #F8F9FA;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 16px;
        }

        .order-info-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .order-header {
            transition: background-color 0.2s;
        }

        .order-header:hover {
            background-color: #E8EAED !important;
        }

        .order-header:active {
            background-color: #D8DADD !important;
        }

        .expand-arrow {
            display: inline-block;
            /* ç§»é™¤ transition ä»¥æå‡éŸ¿æ‡‰é€Ÿåº¦ */
            user-select: none;
        }

        .order-details {
            /* ç§»é™¤å‹•ç•«ä»¥æå‡æ•ˆèƒ½ */
        }

        .order-action-link {
            display: inline-block;
            cursor: pointer;
            padding: 6px 12px;
            border-radius: 4px;
            transition: all 0.2s ease;
            user-select: none;
        }

        .order-action-link:hover {
            background: #F8F9FA;
            transform: scale(1.05);
        }

        .order-action-link:active {
            transform: scale(0.95);
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .checkout-items {
            margin-bottom: 16px;
        }

        .checkout-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #F8F9FA;
            font-size: 18px;
        }

        .payment-section {
            margin-top: 20px;
        }

        .payment-method {
            background: #F8F9FA;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 20px;
        }

        .input-group {
            margin-bottom: 16px;
        }

        .input-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            font-size: 18px;
        }

        .input-field {
            width: 100%;
            padding: 14px;
            border: 2px solid #DFE6E9;
            border-radius: 8px;
            font-size: 20px;
        }

        .input-field:focus {
            outline: none;
            border-color: #FF6B35;
        }

        .quick-amount-buttons {
            display: flex;
            gap: 8px;
            margin-top: 8px;
        }

        .quick-amount-btn {
            flex: 1;
            padding: 12px;
            background: #F8F9FA;
            border: 2px solid #F8F9FA;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 16px;
            /* ç§»é™¤éæ¸¡å‹•ç•«ä»¥æå‡è§¸æ§éŸ¿æ‡‰é€Ÿåº¦ */
            transition: none;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            -webkit-user-select: none;
            /* é˜²æ­¢é€£é»æ™‚çš„å»¶é² */
            -webkit-touch-callout: none;
            -webkit-user-drag: none;
        }

        .quick-amount-btn:hover {
            border-color: #FF6B35;
            background: white;
        }

        .quick-amount-btn:active {
            transform: scale(0.95);
            background: #F0F0F0;
        }

        /* æŒ‰éˆ•æŒ‰ä¸‹ç‹€æ…‹ï¼ˆåƒ…ç”¨æ–¼è§¸æ§è£ç½®ï¼‰ */
        .quick-amount-btn.pressed {
            transform: scale(0.95);
            background: #E0E0E0;
        }

        .change-display {
            background: #00B894;
            color: white;
            padding: 16px;
            border-radius: 8px;
            text-align: center;
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 16px;
        }

        .modal-actions {
            display: flex;
            gap: 8px;
        }

        /* å ±è¡¨é é¢ */
        .reports-page {
            display: none;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
            /* é¿é–‹é ‚éƒ¨å›ºå®šå€å¡Šï¼ˆåªæœ‰ headerï¼‰ */
            padding-top: 76px; /* 56px header + 20px padding */
            box-sizing: border-box;
        }

        .reports-page.active ~ .category-tabs,
        .reports-page.active {
            /* å ±è¡¨é é¢é¡¯ç¤ºæ™‚éš±è—åˆ†é¡æ¨™ç±¤ */
        }

        /* éš±è—åˆ†é¡æ¨™ç±¤ï¼ˆç•¶åœ¨å ±è¡¨æˆ–è¨­å®šé é¢æ™‚ï¼‰ */
        .category-tabs.hidden {
            display: none;
        }

        .reports-page.active {
            display: block;
        }

        .reports-header {
            margin-bottom: 20px;
        }

        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .stat-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.12);
            transform: translateY(-2px);
            transition: all 0.2s ease;
        }

        .clickable-card {
            cursor: pointer;
            position: relative;
        }

        .clickable-card:hover {
            background: #FFF8F0;
            box-shadow: 0 4px 16px rgba(255, 107, 53, 0.2);
        }

        .clickable-card:hover .stat-hint {
            color: #FF6B35;
            font-weight: 600;
        }

        .stat-label {
            font-size: 14px;
            color: #636E72;
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 600;
            color: #FF6B35;
        }

        .stat-hint {
            font-size: 14px;
            color: #636E72;
            margin-top: 8px;
            text-align: right;
            font-weight: 500;
        }

        .chart-container {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            margin-bottom: 24px;
        }

        .chart-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
        }

        .hourly-bar {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
        }

        .hourly-label {
            width: 100px;
            font-size: 14px;
        }

        .hourly-bar-bg {
            flex: 1;
            height: 24px;
            background: #F8F9FA;
            border-radius: 4px;
            overflow: hidden;
            margin: 0 12px;
        }

        .hourly-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #FF6B35, #FF8C42);
            transition: width 0.5s;
        }

        .hourly-value {
            width: 80px;
            text-align: right;
            font-weight: 600;
        }

        .top-items-list {
            list-style: none;
        }

        .top-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #F8F9FA;
        }

        .top-item-rank {
            width: 30px;
            height: 30px;
            background: #FF6B35;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            margin-right: 12px;
        }

        .top-item-info {
            flex: 1;
        }

        .top-item-name {
            font-weight: 600;
        }

        .top-item-qty {
            color: #636E72;
            font-size: 14px;
        }

        .top-item-discount {
            color: #D63031;
            font-size: 12px;
            margin-top: 2px;
        }

        .top-item-revenue {
            font-weight: 600;
            color: #FF6B35;
            text-align: right;
        }

        .back-btn {
            background: #636E72;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin-bottom: 16px;
        }

        /* ç©ºè³¼ç‰©è»Šç‹€æ…‹ */
        .empty-cart {
            text-align: center;
            padding: 40px 20px;
            color: #636E72;
        }

        .empty-cart-icon {
            font-size: 64px;
            margin-bottom: 16px;
        }

        /* å ±è¡¨é¡å‹åˆ‡æ› */
        .report-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
        }

        .report-tab {
            flex: 1;
            padding: 12px;
            background: white;
            border: 2px solid #DFE6E9;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }

        .report-tab.active {
            background: #FF6B35;
            color: white;
            border-color: #FF6B35;
        }

        .report-tab:hover:not(.active) {
            border-color: #FF6B35;
        }

        /* å ±è¡¨å…§å®¹å€ */
        .report-content {
            display: none;
        }

        .report-content.active {
            display: block;
        }

        /* åˆ†é¡çµ±è¨ˆ */
        .category-stats {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .category-stat-item {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .category-label {
            width: 100px;
            font-weight: 600;
        }

        .category-bar-bg {
            flex: 1;
            height: 24px;
            background: #F8F9FA;
            border-radius: 4px;
            overflow: hidden;
        }

        .category-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #FF6B35, #FF8C42);
            transition: width 0.5s;
        }

        .category-value {
            width: 80px;
            text-align: right;
            font-weight: 600;
        }

        /* æ™‚æ®µåœ–è¡¨ */
        .hourly-bars {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        /* è¶¨å‹¢åœ–è¡¨ */
        .trend-chart {
            display: flex;
            align-items: flex-end;
            justify-content: space-around;
            height: 200px;
            padding: 20px 0;
            gap: 8px;
        }

        .trend-bar {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .trend-bar-fill {
            width: 100%;
            background: linear-gradient(180deg, #FF6B35, #FF8C42);
            border-radius: 4px 4px 0 0;
            transition: height 0.5s;
            min-height: 4px;
        }

        .trend-bar-label {
            font-size: 12px;
            color: #636E72;
        }

        .trend-bar-value {
            font-size: 12px;
            font-weight: 600;
            color: #FF6B35;
        }

        /* æˆé•·çµ±è¨ˆ */
        .growth-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
        }

        .growth-item {
            background: #F8F9FA;
            padding: 16px;
            border-radius: 8px;
            text-align: center;
        }

        .growth-label {
            font-size: 14px;
            color: #636E72;
            margin-bottom: 8px;
        }

        .growth-value {
            font-size: 24px;
            font-weight: 600;
        }

        .growth-value.positive {
            color: #00B894;
        }

        .growth-value.negative {
            color: #D63031;
        }

        /* è¨­å®šé é¢ */
        .settings-page {
            display: none;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
            /* é¿é–‹é ‚éƒ¨å›ºå®šå€å¡Šï¼ˆåªæœ‰ headerï¼‰*/
            padding-top: 76px; /* 56px header + 20px padding */
            box-sizing: border-box;
        }

        .settings-page.active {
            display: block;
        }

        .settings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .settings-header h2 {
            font-size: 24px;
            font-weight: 600;
        }

        .settings-section {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            margin-bottom: 24px;
        }

        .settings-section h3 {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .section-desc {
            color: #636E72;
            font-size: 14px;
            margin-bottom: 16px;
        }

        .discount-rules-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .discount-rule-card {
            background: #F8F9FA;
            border-radius: 8px;
            padding: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 2px solid transparent;
            transition: all 0.2s;
        }

        .discount-rule-card:hover {
            border-color: #FF6B35;
            background: white;
        }

        .discount-rule-info {
            flex: 1;
        }

        .discount-rule-title {
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 4px;
        }

        .discount-rule-desc {
            color: #636E72;
            font-size: 14px;
        }

        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            margin-right: 8px;
        }

        .badge-item {
            background: #E3F2FD;
            color: #1976D2;
        }

        .badge-category {
            background: #F3E5F5;
            color: #7B1FA2;
        }

        .badge-total {
            background: #FFF3E0;
            color: #F57C00;
        }

        .discount-rule-actions {
            display: flex;
            gap: 8px;
        }

        .discount-rule-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.2s;
        }

        .btn-edit {
            background: #0984E3;
            color: white;
        }

        .btn-edit:hover {
            background: #0770C0;
        }

        .btn-delete {
            background: #D63031;
            color: white;
        }

        .btn-delete:hover {
            background: #B02929;
        }

        .empty-rules {
            text-align: center;
            padding: 40px 20px;
            color: #636E72;
        }

        .empty-rules-icon {
            font-size: 48px;
            margin-bottom: 12px;
        }

        /* æŠ˜æ‰£é è¦½ */
        .discount-preview {
            background: linear-gradient(135deg, #FF6B35, #FF8C42);
            color: white;
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 16px;
        }

        .preview-label {
            font-size: 12px;
            opacity: 0.9;
            margin-bottom: 8px;
        }

        .preview-text {
            font-size: 20px;
            font-weight: 600;
        }

        /* è³¼ç‰©è»ŠæŠ˜æ‰£é¡¯ç¤º */
        .cart-discount {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: #FFF3CD;
            border-radius: 8px;
            margin-bottom: 12px;
            border: 1px solid #FFC107;
        }

        .discount-label {
            font-weight: 600;
            color: #856404;
        }

        .discount-value {
            font-size: 18px;
            font-weight: 600;
            color: #856404;
        }

        select.input-field {
            cursor: pointer;
        }

        /* éŸ¿æ‡‰å¼ */
        @media (max-width: 968px) {
            .main-content {
                flex-direction: column;
                /* æ‰‹æ©Ÿç‰ˆä¿æŒç›¸åŒçš„å®šä½ */
            }

            .menu-section {
                /* æ‰‹æ©Ÿç‰ˆé¸å–®å€åŸŸä½¿ç”¨è‡ªå‹•é«˜åº¦ */
                flex: 1;
                min-height: 0;
            }

            .cart-sidebar {
                width: 100%;
                border-left: none;
                border-top: 1px solid #DFE6E9;
                /* æ‰‹æ©Ÿç‰ˆè³¼ç‰©è»Šå›ºå®šé«˜åº¦ï¼Œç¢ºä¿æŒ‰éˆ•å¯è¦‹ */
                height: 400px;
                flex-shrink: 0;
            }
        }

        /* è¦æ ¼é¸æ“‡å°è©±æ¡†æ¨£å¼ */
        .spec-item-info {
            text-align: center;
            padding: 20px;
            background: #F8F9FA;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .spec-item-info h3 {
            font-size: 20px;
            margin-bottom: 8px;
            color: #2D3436;
        }

        .spec-item-info p {
            font-size: 24px;
            color: #FF6B35;
            font-weight: 600;
        }

        .spec-section {
            margin-bottom: 20px;
        }

        .spec-section h4 {
            margin-bottom: 12px;
            font-size: 16px;
            color: #2D3436;
        }

        .spec-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
        }

        .spec-btn {
            padding: 10px 8px;
            border: 2px solid #DFE6E9;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            /* ç§»é™¤éæ¸¡å‹•ç•«ä»¥æå‡è§¸æ§éŸ¿æ‡‰é€Ÿåº¦ */
            transition: none;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }

        .spec-btn.active {
            background: #FF6B35 !important;
            color: white !important;
            border-color: #FF6B35 !important;
        }

        .spec-btn.pressed {
            transform: scale(0.95);
            background: #F8F9FA !important;
        }

        .spicy-section .spec-btn.active {
            background: #FF6B35;
            color: white;
            border-color: #FF6B35;
        }

        /* èª¿å‘³æŒ‰éˆ• active æ¨£å¼ */
        .pepper-btn.active,
        .sauce-btn.active {
            background: #FF6B35 !important;
            color: white !important;
            border-color: #FF6B35 !important;
        }

        /* é£²æ–™æŒ‰éˆ• active æ¨£å¼ */
        .temp-btn.active,
        .ice-level-btn.active,
        .sugar-level-btn.active {
            background: #FF6B35 !important;
            color: white !important;
            border-color: #FF6B35 !important;
        }

        /* è¦æ ¼é¸é …ç¾¤çµ„ */
        .spec-option-group {
            margin-bottom: 12px;
        }

        /* ä¸åŒæ¬„ä½æ•¸çš„æŒ‰éˆ•å®¹å™¨ */
        .spec-buttons-2 {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }

        .spec-buttons-3 {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }

        .spec-buttons-5 {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
        }

        .spec-checkboxes {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }

        .spec-checkboxes label {
            display: flex;
            align-items: center;
            padding: 10px;
            background: #F8F9FA;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            user-select: none;
        }

        .spec-checkboxes input[type="checkbox"] {
            margin-right: 6px;
            width: 18px;
            height: 18px;
        }

        .discount-btn {
            flex: 1;
            padding: 8px 12px;
            border: 2px solid #FF6B35;
            background: white;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            color: #FF6B35;
            transition: all 0.2s;
            touch-action: manipulation;
            user-select: none;
        }

        .discount-btn:active {
            background: #FF6B35;
            color: white;
            transform: scale(0.95);
        }

        .spec-custom-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #DFE6E9;
            border-radius: 6px;
            margin-top: 8px;
            font-size: 14px;
        }

        .spec-custom-input:focus {
            outline: none;
            border-color: #FF6B35;
        }

        .spec-quantity {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 16px;
        }

        .spec-quantity .qty-btn {
            width: 40px;
            height: 40px;
            border: none;
            background: #FF6B35;
            color: white;
            border-radius: 6px;
            font-size: 20px;
            cursor: pointer;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }

        .spec-quantity .qty-display {
            font-size: 18px;
            font-weight: 600;
            min-width: 40px;
            text-align: center;
        }

        /* è³¼ç‰©è»Šé …ç›®è¦æ ¼é¡¯ç¤º */
        .cart-item-specs {
            font-size: 12px;
            color: #636E72;
            margin-top: 4px;
        }

        .cart-item-specs .spec-tag {
            display: inline-block;
            background: #FFEAA7;
            color: #2D3436;
            padding: 2px 6px;
            border-radius: 4px;
            margin-right: 4px;
            margin-bottom: 2px;
            font-size: 11px;
        }

        /* æŠ˜æ‰£æ¨™ç±¤ */
        .cart-item-specs .discount-tag {
            background: #D63031;
            color: white;
        }

        /* æ‰‹å‹•æŠ˜æ‰£å€å¡Šæ¨£å¼ */
        .manual-discount-section {
            background: #FFF3CD;
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 16px;
            border: 1px solid #FFC107;
        }

        .manual-discount-section h4 {
            margin: 0 0 12px 0;
            font-size: 20px;
            color: #2D3436;
        }

        .quick-discount-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-bottom: 12px;
        }

        .quick-discount-btn {
            padding: 10px;
            background: #FF6B35;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: none;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }

        .quick-discount-btn:active {
            background: #E65A2B;
        }

        .percentage-discount {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-bottom: 12px;
        }

        .percentage-btn {
            padding: 10px;
            background: #00B894;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: none;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }

        .percentage-btn:active {
            background: #00A383;
        }
    </style>
</head>
<body>
    <!-- é ‚éƒ¨å›ºå®šå€å¡Šï¼ˆHeader + åˆ†é¡æ¨™ç±¤ï¼‰ -->
    <div class="top-fixed-bar">
        <!-- é ‚éƒ¨å°èˆª -->
        <header class="header">
            <h1>å¤¯è‚‰ HANGROU</h1>
            <div class="header-buttons">
                <div class="header-business-date">
                    ğŸ“… <span id="headerBusinessDate">-</span>
                </div>
                <button class="header-btn" onclick="showReports()">ğŸ“Š å ±è¡¨</button>
                <button class="header-btn" onclick="showSettings()">âš™ï¸ è¨­å®š</button>
            </div>
        </header>

        <!-- åˆ†é¡æ¨™ç±¤ -->
        <div class="category-tabs" id="categoryTabs">
            <div class="category-tab active" data-category="all">ğŸ” å…¨éƒ¨</div>
            <div class="category-tab" data-category="beef">ğŸ‚ ç‰›è‚‰</div>
            <div class="category-tab" data-category="pork">ğŸ– è±¬è‚‰</div>
            <div class="category-tab" data-category="chicken">ğŸ” é›è‚‰</div>
            <div class="category-tab" data-category="vegetable">ğŸ¥¬ è”¬èœ</div>
            <div class="category-tab" data-category="skewer">ğŸ¢ ä¸²ç‡’</div>
            <div class="category-tab" data-category="drink">ğŸº é£²æ–™</div>
        </div>
    </div>

    <!-- ä¸»ç•«é¢ -->
    <div id="mainPage">
        <!-- ä¸»å…§å®¹å€ -->
        <div class="main-content">
            <!-- é¸å–®å€åŸŸ -->
            <div class="menu-section">
                <div class="menu-grid" id="menuGrid">
                    <!-- èœå“æœƒç”± JavaScript å‹•æ…‹ç”Ÿæˆ -->
                </div>
            </div>

            <!-- è³¼ç‰©è»Šå´é‚Šæ¬„ -->
            <div class="cart-sidebar">
                <div class="cart-header">
                    ğŸ›’ è³¼ç‰©è»Š
                </div>
                <div class="cart-items" id="cartItems">
                    <div class="empty-cart">
                        <div class="empty-cart-icon">ğŸ›’</div>
                        <p>å°šæœªé»é¸ä»»ä½•å•†å“</p>
                    </div>
                </div>
                <div class="cart-footer">
                    <div class="cart-summary">
                        <span>ç¸½è¨ˆï¼š<span id="totalItems">0</span> ä»¶</span>
                        <span class="cart-total" id="cartTotal">$0</span>
                    </div>
                    <div class="cart-actions">
                        <button class="btn btn-secondary" onclick="clearCart()">æ¸…ç©º</button>
                        <button class="btn btn-primary" onclick="showCheckout()">çµå¸³</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- å ±è¡¨é é¢ -->
    <div class="reports-page" id="reportsPage">
        <button class="back-btn" onclick="hideReports()">â† è¿”å›é»é¤</button>

        <div class="reports-header">
            <h2>éŠ·å”®å ±è¡¨</h2>
        </div>

        <!-- å ±è¡¨é¡å‹åˆ‡æ› -->
        <div class="report-tabs">
            <div class="report-tab active" data-report="daily" onclick="switchReport('daily')">æ—¥å ±è¡¨</div>
            <div class="report-tab" data-report="weekly" onclick="switchReport('weekly')">é€±å ±è¡¨</div>
            <div class="report-tab" data-report="monthly" onclick="switchReport('monthly')">æœˆå ±è¡¨</div>
        </div>

        <!-- æ—¥å ±è¡¨ -->
        <div class="report-content active" id="dailyReport">
            <div class="chart-container">
                <div class="chart-title">ğŸ“Š æ—¥å ±è¡¨æŸ¥è©¢</div>
                <div style="display: flex; gap: 12px; align-items: center; flex-wrap: wrap; padding: 20px;">
                    <input type="date" id="dailyStartDateSelector" class="menu-input" style="flex: 1; min-width: 180px;" placeholder="é–‹å§‹æ—¥æœŸ">
                    <span style="color: #636E72;">è‡³</span>
                    <input type="date" id="dailyEndDateSelector" class="menu-input" style="flex: 1; min-width: 180px;" placeholder="çµæŸæ—¥æœŸ">
                    <button class="action-button" onclick="loadDailyReportByDateRange()">
                        ğŸ” æŸ¥è©¢
                    </button>
                    <button class="action-button" onclick="loadTodayReport()" style="background: #636E72;">
                        ä»Šæ—¥
                    </button>
                </div>
            </div>

            <div class="stats-cards">
                <div class="stat-card">
                    <div class="stat-label" id="revenueLabel">ä»Šæ—¥ç‡Ÿæ¥­é¡</div>
                    <div class="stat-value" id="todayRevenue">$0</div>
                </div>
                <div class="stat-card clickable-card" onclick="showOrderListModal()">
                    <div class="stat-label">è¨‚å–®æ•¸</div>
                    <div class="stat-value" id="todayOrders">0</div>
                    <div class="stat-hint">>> è©³ç´°è³‡æ–™</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label" id="discountLabel">ä»Šæ—¥ç¸½æŠ˜æ‰£</div>
                    <div class="stat-value" id="todayDiscount" style="color: #D63031;">$0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label" id="profitLabel">ä»Šæ—¥åˆ©æ½¤</div>
                    <div class="stat-value" id="todayProfit" style="color: #00B894;">$0</div>
                </div>
            </div>

            <!-- åˆ†é¡éŠ·å”®å æ¯” -->
            <div class="chart-container">
                <div class="chart-title">å„åˆ†é¡éŠ·å”®å æ¯”</div>
                <div class="category-stats" id="categoryStats">
                    <div class="category-stat-item">
                        <div class="category-label">ğŸ‚ ç‰›è‚‰</div>
                        <div class="category-bar-bg">
                            <div class="category-bar-fill" style="width: 45%; background: linear-gradient(90deg, #FF6B35, #FF8C42);"></div>
                        </div>
                        <div class="category-value">$0</div>
                    </div>
                    <div class="category-stat-item">
                        <div class="category-label">ğŸ– è±¬è‚‰</div>
                        <div class="category-bar-bg">
                            <div class="category-bar-fill" style="width: 30%; background: linear-gradient(90deg, #FF6B35, #FF8C42);"></div>
                        </div>
                        <div class="category-value">$0</div>
                    </div>
                    <div class="category-stat-item">
                        <div class="category-label">ğŸ” é›è‚‰</div>
                        <div class="category-bar-bg">
                            <div class="category-bar-fill" style="width: 15%; background: linear-gradient(90deg, #FF6B35, #FF8C42);"></div>
                        </div>
                        <div class="category-value">$0</div>
                    </div>
                    <div class="category-stat-item">
                        <div class="category-label">ğŸ¥¬ è”¬èœ</div>
                        <div class="category-bar-bg">
                            <div class="category-bar-fill" style="width: 10%; background: linear-gradient(90deg, #FF6B35, #FF8C42);"></div>
                        </div>
                        <div class="category-value">$0</div>
                    </div>
                </div>
            </div>

            <!-- æ™‚æ®µåˆ†å¸ƒ -->
            <div class="chart-container">
                <div class="chart-title">æ¯å°æ™‚ç‡Ÿæ¥­é¡åˆ†æ</div>
                <div class="hourly-bars" id="hourlyBars">
                    <div class="hourly-bar">
                        <div class="hourly-label">17:00</div>
                        <div class="hourly-bar-bg">
                            <div class="hourly-bar-fill" style="width: 0%"></div>
                        </div>
                        <div class="hourly-value">$0</div>
                    </div>
                    <div class="hourly-bar">
                        <div class="hourly-label">18:00</div>
                        <div class="hourly-bar-bg">
                            <div class="hourly-bar-fill" style="width: 0%"></div>
                        </div>
                        <div class="hourly-value">$0</div>
                    </div>
                    <div class="hourly-bar">
                        <div class="hourly-label">19:00</div>
                        <div class="hourly-bar-bg">
                            <div class="hourly-bar-fill" style="width: 0%"></div>
                        </div>
                        <div class="hourly-value">$0</div>
                    </div>
                    <div class="hourly-bar">
                        <div class="hourly-label">20:00</div>
                        <div class="hourly-bar-bg">
                            <div class="hourly-bar-fill" style="width: 0%"></div>
                        </div>
                        <div class="hourly-value">$0</div>
                    </div>
                    <div class="hourly-bar">
                        <div class="hourly-label">21:00</div>
                        <div class="hourly-bar-bg">
                            <div class="hourly-bar-fill" style="width: 0%"></div>
                        </div>
                        <div class="hourly-value">$0</div>
                    </div>
                    <div class="hourly-bar">
                        <div class="hourly-label">22:00</div>
                        <div class="hourly-bar-bg">
                            <div class="hourly-bar-fill" style="width: 0%"></div>
                        </div>
                        <div class="hourly-value">$0</div>
                    </div>
                </div>
            </div>

            <!-- ç†±éŠ·å•†å“ TOP 10 -->
            <div class="chart-container">
                <div class="chart-title">ç†±éŠ·å•†å“ TOP 10</div>
                <ul class="top-items-list" id="topItemsList">
                    <li style="text-align: center; padding: 20px; color: #636E72;">ä»Šæ—¥å°šç„¡éŠ·å”®è¨˜éŒ„</li>
                </ul>
            </div>

            <!-- æŠ˜æ‰£æ˜ç´° -->
            <div class="chart-container">
                <div class="chart-title">æŠ˜æ‰£æ˜ç´°</div>
                <div class="discount-details" id="discountDetails">
                    <div style="text-align: center; padding: 20px; color: #636E72;">ä»Šæ—¥å°šç„¡æŠ˜æ‰£è¨˜éŒ„</div>
                </div>
            </div>

            <!-- çµå¸³æ“ä½œ -->
            <div class="chart-container" id="dailyCheckoutSection">
                <div class="chart-title" id="checkoutTitle">ğŸ”’ ç‡Ÿæ¥­æ—¥çµå¸³æ“ä½œ</div>
                <div style="display: flex; gap: 12px; justify-content: center; padding: 20px; flex-wrap: wrap;">
                    <button class="action-button" onclick="exportDailyReport()" style="background: #0984E3;">
                        ğŸ“¥ åŒ¯å‡ºçµå¸³æ˜ç´°
                    </button>
                    <button class="action-button" id="closeoutButton" onclick="performDailyCloseout()" style="background: #D63031;">
                        ğŸ”’ é—œå¸³ï¼ˆæ›æ—¥ï¼‰
                    </button>
                </div>
                <div style="text-align: center; padding: 0 20px 20px 20px; font-size: 14px; color: #636E72; line-height: 1.6;">
                    <strong style="color: #2D3436;">èªªæ˜ï¼š</strong><br>
                    â€¢ åŒ¯å‡ºçµå¸³æ˜ç´°ï¼šä¾æ“šä¸Šæ–¹æ—¥æœŸå€é–“åŒ¯å‡º CSV æª”æ¡ˆ<br>
                    â€¢ é—œå¸³ï¼ˆæ›æ—¥ï¼‰ï¼šæ›´æ–°ç‡Ÿæ¥­æ—¥åˆ°ä¸‹ä¸€å¤©ï¼Œæ¸…ç©ºçµ±è¨ˆè³‡æ–™ï¼Œé‡ç½®è¨‚å–®ç·¨è™Ÿ
                </div>
            </div>
        </div>

        <!-- é€±å ±è¡¨ -->
        <div class="report-content" id="weeklyReport">
            <div class="chart-container">
                <div class="chart-title">é¸æ“‡é€±</div>
                <div style="display: flex; gap: 12px; align-items: center; flex-wrap: wrap; padding: 20px;">
                    <input type="week" id="weeklyDateSelector" class="menu-input" style="flex: 1; min-width: 200px;">
                    <button class="action-button" onclick="loadWeeklyReportByWeek()">
                        ğŸ” æŸ¥è©¢
                    </button>
                    <button class="action-button" onclick="loadThisWeekReport()" style="background: #636E72;">
                        æœ¬é€±
                    </button>
                    <button class="action-button" onclick="loadLastWeekReport()" style="background: #636E72;">
                        ä¸Šé€±
                    </button>
                </div>
            </div>

            <div class="stats-cards">
                <div class="stat-card">
                    <div class="stat-label">æœ¬é€±ç‡Ÿæ¥­é¡</div>
                    <div class="stat-value" id="weekRevenue">$0</div>
                </div>
                <div class="stat-card clickable-card" onclick="showOrderListModal()">
                    <div class="stat-label">æœ¬é€±è¨‚å–®æ•¸</div>
                    <div class="stat-value" id="weekOrders">0</div>
                    <div class="stat-hint">>> è©³ç´°è³‡æ–™</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">æ—¥å‡ç‡Ÿæ¥­é¡</div>
                    <div class="stat-value" id="weekAvg">$0</div>
                </div>
            </div>

            <div class="chart-container">
                <div class="chart-title">7å¤©ç‡Ÿæ¥­é¡è¶¨å‹¢åœ–</div>
                <div class="trend-chart" id="weekTrendChart">
                    <!-- æœƒç”± JavaScript å‹•æ…‹ç”Ÿæˆ -->
                </div>
            </div>

            <div class="chart-container">
                <div class="chart-title">é€±æˆé•·å°æ¯”</div>
                <div class="growth-stats">
                    <div class="growth-item">
                        <div class="growth-label">ç‡Ÿæ¥­é¡æˆé•·</div>
                        <div class="growth-value positive">+0%</div>
                    </div>
                    <div class="growth-item">
                        <div class="growth-label">è¨‚å–®æ•¸æˆé•·</div>
                        <div class="growth-value positive">+0%</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- æœˆå ±è¡¨ -->
        <div class="report-content" id="monthlyReport">
            <div class="chart-container">
                <div class="chart-title">é¸æ“‡æœˆä»½</div>
                <div style="display: flex; gap: 12px; align-items: center; flex-wrap: wrap; padding: 20px;">
                    <input type="month" id="monthlyDateSelector" class="menu-input" style="flex: 1; min-width: 200px;">
                    <button class="action-button" onclick="loadMonthlyReportByMonth()">
                        ğŸ” æŸ¥è©¢
                    </button>
                    <button class="action-button" onclick="loadThisMonthReport()" style="background: #636E72;">
                        æœ¬æœˆ
                    </button>
                    <button class="action-button" onclick="loadLastMonthReport()" style="background: #636E72;">
                        ä¸Šæœˆ
                    </button>
                </div>
            </div>

            <div class="stats-cards">
                <div class="stat-card">
                    <div class="stat-label">æœ¬æœˆç‡Ÿæ¥­é¡</div>
                    <div class="stat-value" id="monthRevenue">$0</div>
                </div>
                <div class="stat-card clickable-card" onclick="showOrderListModal()">
                    <div class="stat-label">æœ¬æœˆè¨‚å–®æ•¸</div>
                    <div class="stat-value" id="monthOrders">0</div>
                    <div class="stat-hint">>> è©³ç´°è³‡æ–™</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">æ—¥å‡ç‡Ÿæ¥­é¡</div>
                    <div class="stat-value" id="monthAvg">$0</div>
                </div>
            </div>

            <div class="chart-container">
                <div class="chart-title">æœˆåº¦éŠ·å”®è¶¨å‹¢</div>
                <div class="trend-chart" id="monthTrendChart">
                    <!-- æœƒç”± JavaScript å‹•æ…‹ç”Ÿæˆ -->
                </div>
            </div>
        </div>
    </div>

    <!-- è¨‚å–®åˆ—è¡¨å½ˆçª— -->
    <div class="modal-overlay" id="orderListModal">
        <div class="modal" style="max-width: 800px; max-height: 90vh; display: flex; flex-direction: column;">
            <div class="modal-header" style="flex-shrink: 0;">
                <div class="modal-title" id="orderListModalTitle">è¨‚å–®æ˜ç´°</div>
                <button class="modal-close" onclick="hideOrderListModal()">Ã—</button>
            </div>
            <div class="modal-body" style="flex: 1; overflow-y: auto; padding: 20px;">
                <div id="orderListDate" style="margin-bottom: 12px; color: #636E72;"></div>

                <!-- è¨‚å–®æœå°‹æ¡† -->
                <div style="margin-bottom: 16px;">
                    <input
                        type="text"
                        id="orderSearchInput"
                        class="input-field"
                        placeholder="ğŸ” è¼¸å…¥è¨‚å–®ç·¨è™Ÿæœå°‹ï¼ˆä¾‹å¦‚ï¼š#20250207-001ï¼‰"
                        style="width: 100%;"
                        oninput="filterOrderList()"
                    >
                    <div style="text-align: right; margin-top: 8px; font-size: 14px;">
                        <span class="order-action-link" style="color: #00B894;" onclick="expandAllOrders()">å…¨éƒ¨å±•é–‹</span>
                        <span style="color: #636E72; margin: 0 8px;">|</span>
                        <span class="order-action-link" style="color: #636E72;" onclick="collapseAllOrders()">å…¨éƒ¨æ”¶èµ·</span>
                    </div>
                </div>

                <div id="orderListContainer">
                    <!-- è¨‚å–®æœƒç”± JavaScript å‹•æ…‹ç”Ÿæˆ -->
                </div>

                <div class="modal-actions" style="margin-top: 20px;">
                    <button class="btn btn-secondary" onclick="hideOrderListModal()">é—œé–‰</button>
                </div>
            </div>
        </div>
    </div>

    <!-- çµå¸³å½ˆçª— -->
    <div class="modal-overlay" id="checkoutModal">
        <div class="modal" style="max-height: 90vh; display: flex; flex-direction: column;">
            <div class="modal-header" style="flex-shrink: 0;">
                <div class="modal-title">çµå¸³ä»˜æ¬¾</div>
                <button class="modal-close" onclick="hideCheckout()">Ã—</button>
            </div>
            <div class="modal-body" style="flex: 1; overflow-y: auto; padding: 20px;">
                <div class="order-info">
                    <div class="order-info-row">
                        <span>è¨‚å–®è™Ÿï¼š</span>
                        <span id="orderNumber">#20260126001</span>
                    </div>
                    <div class="order-info-row">
                        <span>æ™‚é–“ï¼š</span>
                        <span id="orderTime">2026-01-26 19:35</span>
                    </div>
                </div>

                <div class="checkout-items" id="checkoutItems">
                    <!-- è¨‚å–®é …ç›®æœƒç”± JavaScript å‹•æ…‹ç”Ÿæˆ -->
                </div>

                <!-- çµ±ä¸€è¦æ ¼é¸æ“‡å€å¡Š -->
                <div class="unified-spec-section" style="display: none; background: #F8F9FA; padding: 16px; border-radius: 8px; margin: 16px 0;">
                    <h4 style="margin: 0 0 12px 0; color: #2D3436;">ğŸ½ï¸ å£å‘³</h4>

                    <!-- è¾£åº¦é¸æ“‡ -->
                    <div class="spicy-section" style="margin-bottom: 12px;">
                        <div style="font-size: 18px; color: #2D3436; margin-bottom: 8px;">ğŸŒ¶ï¸ è¾£åº¦ï¼š</div>
                        <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                            <button class="spec-btn unified-spec-btn" data-spicy="ä¸è¾£" onclick="selectUnifiedSpicy('ä¸è¾£')">ä¸è¾£</button>
                            <button class="spec-btn unified-spec-btn" data-spicy="å¾®è¾£" onclick="selectUnifiedSpicy('å¾®è¾£')">å¾®è¾£</button>
                            <button class="spec-btn unified-spec-btn" data-spicy="ä¸­è¾£" onclick="selectUnifiedSpicy('ä¸­è¾£')">ä¸­è¾£</button>
                            <button class="spec-btn unified-spec-btn" data-spicy="å¤§è¾£" onclick="selectUnifiedSpicy('å¤§è¾£')">å¤§è¾£</button>
                        </div>
                    </div>

                    <!-- èƒ¡æ¤’é¸æ“‡ -->
                    <div class="pepper-section" style="margin-bottom: 12px;">
                        <div style="font-size: 18px; color: #2D3436; margin-bottom: 8px;">ğŸŒ¶ï¸ èƒ¡æ¤’ï¼š</div>
                        <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                            <button class="spec-btn unified-pepper-btn active" data-pepper="" onclick="selectUnifiedPepper('')">æ­£å¸¸</button>
                            <button class="spec-btn unified-pepper-btn" data-pepper="èƒ¡æ¤’å¤š" onclick="selectUnifiedPepper('èƒ¡æ¤’å¤š')">èƒ¡æ¤’å¤š</button>
                            <button class="spec-btn unified-pepper-btn" data-pepper="èƒ¡æ¤’å°‘" onclick="selectUnifiedPepper('èƒ¡æ¤’å°‘')">èƒ¡æ¤’å°‘</button>
                            <button class="spec-btn unified-pepper-btn" data-pepper="å»èƒ¡æ¤’" onclick="selectUnifiedPepper('å»èƒ¡æ¤’')">å»èƒ¡æ¤’</button>
                        </div>
                    </div>

                    <!-- é†¬é¸æ“‡ -->
                    <div class="sauce-section" style="margin-bottom: 12px;">
                        <div style="font-size: 18px; color: #2D3436; margin-bottom: 8px;">ğŸ¥« é†¬ï¼š</div>
                        <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                            <button class="spec-btn unified-sauce-btn active" data-sauce="" onclick="selectUnifiedSauce('')">æ­£å¸¸</button>
                            <button class="spec-btn unified-sauce-btn" data-sauce="é†¬å¤š" onclick="selectUnifiedSauce('é†¬å¤š')">é†¬å¤š</button>
                            <button class="spec-btn unified-sauce-btn" data-sauce="é†¬å°‘" onclick="selectUnifiedSauce('é†¬å°‘')">é†¬å°‘</button>
                            <button class="spec-btn unified-sauce-btn" data-sauce="å»é†¬" onclick="selectUnifiedSauce('å»é†¬')">å»é†¬</button>
                        </div>
                    </div>

                    <!-- è‡ªè¨‚å‚™è¨» -->
                    <div>
                        <div style="font-size: 18px; color: #2D3436; margin-bottom: 8px;">ğŸ“ è‡ªè¨‚å‚™è¨»ï¼š</div>
                        <input type="text" id="unifiedCustomInput" class="input-field" placeholder="å…¶ä»–ç‰¹æ®Šéœ€æ±‚..." style="width: 100%;" oninput="updateUnifiedCustom()">
                    </div>
                </div>

                <!-- æ‰‹å‹•æŠ˜æ‰£å€å¡Šï¼ˆå·²åœç”¨ï¼Œæ”¹ç”¨å“é …æŠ˜æ‰£ï¼‰ -->
                    <div class="manual-discount-section" style="display: none;">
                        <h4>ğŸ’° æ‰‹å‹•æŠ˜æ‰£</h4>

                        <!-- å¿«é€ŸæŠ˜æ‰£æŒ‰éˆ• -->
                        <div class="quick-discount-buttons">
                            <button class="quick-discount-btn" onclick="applyManualDiscount(10)">æŠ˜$10</button>
                            <button class="quick-discount-btn" onclick="applyManualDiscount(20)">æŠ˜$20</button>
                            <button class="quick-discount-btn" onclick="applyManualDiscount(50)">æŠ˜$50</button>
                        </div>

                        <!-- è‡ªè¨‚é‡‘é¡èˆ‡ç™¾åˆ†æ¯” -->
                        <div style="display: flex; gap: 8px; margin-bottom: 12px;">
                            <div style="flex: 1;">
                                <input type="number" id="manualDiscountInput" class="input-field" placeholder="è‡ªè¨‚é‡‘é¡" style="margin-bottom: 0;">
                            </div>
                            <button class="quick-discount-btn" onclick="applyCustomDiscount()">å¥—ç”¨</button>
                        </div>

                        <!-- ç™¾åˆ†æ¯”æŠ˜æ‰£ -->
                        <div class="percentage-discount" style="display: none;">
                            <button class="percentage-btn" onclick="applyPercentageDiscount(10)">æ‰“9æŠ˜</button>
                            <button class="percentage-btn" onclick="applyPercentageDiscount(20)">æ‰“8æŠ˜</button>
                        </div>

                        <!-- æŠ˜æ‰£åŸå›  -->
                        <div style="margin-top: 12px;">
                            <label style="display: block; margin-bottom: 4px; font-size: 14px;">æŠ˜æ‰£åŸå› </label>
                            <select id="discountReason" class="input-field" onchange="updateDiscountReason()">
                                <option value="">é¸æ“‡åŸå› </option>
                                <option value="æœƒå“¡æŠ˜æ‰£">æœƒå“¡æŠ˜æ‰£</option>
                                <option value="æ´»å‹•å„ªæƒ ">æ´»å‹•å„ªæƒ </option>
                                <option value="æœå‹™è£œå„Ÿ">æœå‹™è£œå„Ÿ</option>
                                <option value="å…¶ä»–">å…¶ä»–</option>
                            </select>
                        </div>

                        <!-- ç›®å‰æ‰‹å‹•æŠ˜æ‰£é¡¯ç¤º -->
                        <div id="manualDiscountDisplay" style="display: none; margin-top: 12px; padding: 8px; background: white; border-radius: 6px;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span>å·²å¥—ç”¨æ‰‹å‹•æŠ˜æ‰£ï¼š</span>
                                <span id="manualDiscountAmount" style="font-weight: 600; color: #D63031;">$0</span>
                            </div>
                            <button onclick="clearManualDiscount()" class="quick-discount-btn" style="width: 100%; margin-top: 8px; background: #D63031;">æ¸…é™¤æ‰‹å‹•æŠ˜æ‰£</button>
                        </div>
                    </div>

                    <!-- ç¸½è¨ˆé¡¯ç¤º -->
                    <div class="order-info" style="margin-bottom: 16px;">
                        <!-- å°è¨ˆ -->
                        <div class="order-info-row">
                            <span style="font-size: 16px; color: #636E72;">å°è¨ˆï¼š</span>
                            <span id="checkoutSubtotal" style="font-size: 16px; color: #636E72;">$0</span>
                        </div>
                        <!-- æŠ˜æ‰£ -->
                        <div class="order-info-row" id="checkoutDiscountRow" style="display: none;">
                            <span style="font-size: 16px; color: #D63031;">æŠ˜æ‰£ï¼š</span>
                            <span id="checkoutDiscount" style="font-size: 16px; color: #D63031;">-$0</span>
                        </div>
                        <!-- ç¸½è¨ˆ -->
                        <div class="order-info-row" style="border-top: 2px solid #DFE6E9; padding-top: 8px; margin-top: 8px;">
                            <span style="font-size: 18px; font-weight: 600;">ç¸½è¨ˆï¼š</span>
                            <span class="cart-total" id="checkoutTotal" style="font-size: 20px;">$0</span>
                        </div>
                    </div>

                    <!-- ç¾é‡‘ä»˜æ¬¾å€å¡Š -->
                    <div class="payment-method" style="margin-bottom: 16px;">
                        <span>ğŸ’µ</span>
                        <span style="font-size: 16px; font-weight: 600;">ç¾é‡‘ä»˜æ¬¾</span>
                    </div>

                    <div class="input-group">
                        <label class="input-label">å¯¦æ”¶é‡‘é¡</label>
                        <input type="number" class="input-field" id="receivedAmount" placeholder="è¼¸å…¥é‡‘é¡" oninput="validateNumberInput(this)" min="0" step="1" pattern="\d*">
                        <div class="quick-amount-buttons">
                            <button class="quick-amount-btn" onclick="addAmount(100)">$100</button>
                            <button class="quick-amount-btn" onclick="addAmount(500)">$500</button>
                            <button class="quick-amount-btn" onclick="addAmount(1000)">$1000</button>
                            <button class="quick-amount-btn" onclick="setFullAmount()" style="background: #FF6B35; color: white; border-color: #FF6B35;">å…¨é¡</button>
                            <button class="quick-amount-btn" onclick="clearAmount()" style="background: #D63031; color: white; border-color: #D63031;">æ­¸é›¶</button>
                        </div>
                    </div>

                    <div class="change-display" id="changeDisplay">
                        æ‰¾é›¶ï¼š$0
                    </div>

                    <div class="modal-actions">
                        <button class="btn btn-secondary" onclick="hideCheckout()">å–æ¶ˆ</button>
                        <button class="btn btn-primary" onclick="completePayment()">ç¢ºèªä»˜æ¬¾</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- è¨­å®šé é¢ -->
    <div class="settings-page" id="settingsPage">
        <div class="settings-header">
            <button class="back-btn" onclick="hideSettings()">â† è¿”å›é»é¤</button>
            <h2>âš™ï¸ ç³»çµ±è¨­å®š</h2>
        </div>

        <div class="settings-content">
            <!-- æŠ˜æ‰£è¦å‰‡è¨­å®š -->
            <div class="settings-section">
                <h3>ğŸ·ï¸ æŠ˜æ‰£è¦å‰‡</h3>
                <p class="section-desc">è¨­å®šè²·å¹¾ä¸²æŠ˜å¤šå°‘çš„å„ªæƒ è¦å‰‡</p>

                <div class="discount-rules-list" id="discountRulesList">
                    <!-- æŠ˜æ‰£è¦å‰‡æœƒç”± JavaScript å‹•æ…‹ç”Ÿæˆ -->
                </div>

                <button class="btn btn-primary" onclick="showAddDiscountModal()" style="width: 100%; margin-top: 16px;">
                    + æ–°å¢æŠ˜æ‰£è¦å‰‡
                </button>
            </div>

            <!-- æ¸¬è©¦è³‡æ–™ï¼ˆé–‹ç™¼ç”¨ï¼‰ -->
            <div class="settings-section" id="testDataSection" style="display: none;">
                <h3>ğŸ§ª æ¸¬è©¦è³‡æ–™</h3>
                <p class="section-desc">ç”Ÿæˆæ¸¬è©¦è³‡æ–™ä»¥é©—è­‰å ±è¡¨æŸ¥è©¢åŠŸèƒ½</p>

                <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                    <button class="btn btn-primary" onclick="generateTestData()" style="flex: 1; min-width: 200px;">
                        ğŸ“Š ç”Ÿæˆæ¸¬è©¦è³‡æ–™
                    </button>
                    <button class="btn btn-secondary" onclick="clearTestData()" style="flex: 1; min-width: 200px; background: #D63031;">
                        ğŸ—‘ï¸ æ¸…é™¤æ¸¬è©¦è³‡æ–™
                    </button>
                </div>

                <div style="display: flex; gap: 12px; flex-wrap: wrap; margin-top: 12px;">
                    <button class="btn btn-secondary" onclick="clearAllLocalStorage()" style="flex: 1; min-width: 200px; background: #636E72;">
                        ğŸ”„ ç³»çµ±é‡ç½®
                    </button>
                </div>

                <div style="margin-top: 12px; padding: 12px; background: #FFF3CD; border-radius: 8px; font-size: 14px; color: #856404;">
                    <strong>èªªæ˜ï¼š</strong><br>
                    â€¢ é»æ“Šã€Œç”Ÿæˆæ¸¬è©¦è³‡æ–™ã€æœƒè‡ªå‹•å»ºç«‹éå»7å¤©çš„æ¨¡æ“¬éŠ·å”®è³‡æ–™<br>
                    â€¢ ç”Ÿæˆçš„è³‡æ–™å¯ç”¨æ–¼æ¸¬è©¦æ—¥å ±è¡¨ã€é€±å ±è¡¨ã€æœˆå ±è¡¨çš„æ­·å²æŸ¥è©¢åŠŸèƒ½<br>
                    â€¢ æ¸¬è©¦å®Œæˆå¾Œå¯é»æ“Šã€Œæ¸…é™¤æ¸¬è©¦è³‡æ–™ã€åˆªé™¤<br>
                    â€¢ <strong>ã€Œç³»çµ±é‡ç½®ã€</strong>æœƒæ¸…é™¤æ‰€æœ‰è³‡æ–™ä¸¦é‡ç½®ç‚ºåˆå§‹ç‹€æ…‹ï¼ˆåŒ…æ‹¬è¨­å®šã€æŠ˜æ‰£è¦å‰‡ã€ç‡Ÿæ¥­è³‡æ–™ç­‰ï¼‰ï¼Œè«‹è¬¹æ…ä½¿ç”¨<br>
                    <strong style="color: #856404;">ğŸ’¡ æç¤ºï¼šæ­¤å€å¡Šåƒ…åœ¨æ¸¬è©¦æ¨¡å¼ä¸‹é¡¯ç¤ºï¼ˆURL åŠ  ?test=trueï¼‰</strong>
                </div>
            </div>
        </div>
    </div>

    <!-- è¦æ ¼é¸æ“‡å½ˆçª— -->
    <div class="modal-overlay" id="specModal">
        <div class="modal" style="max-height: 90vh; display: flex; flex-direction: column;">
            <div class="modal-header" style="flex-shrink: 0;">
                <div class="modal-title">é¸æ“‡è¦æ ¼</div>
                <button class="modal-close" onclick="hideSpecModal()">Ã—</button>
            </div>
            <div class="modal-body" style="flex: 1; overflow-y: auto; padding: 20px;">
                <!-- å“é …è³‡è¨Š -->
                <div class="spec-item-info">
                    <h3 id="specItemName">é›è‚‰ä¸²</h3>
                    <p id="specItemPrice">$50</p>
                </div>

                <!-- è¦æ ¼é¸æ“‡ -->
                <div class="spec-section spicy-section">
                    <!-- è¾£åº¦é¸æ“‡ -->
                    <h4 class="spicy-label">ğŸŒ¶ï¸ è¾£åº¦</h4>
                    <div class="spec-buttons" style="margin-bottom: 16px;">
                        <button class="spec-btn active" data-spicy="ä¸è¾£" onclick="selectSpicy('ä¸è¾£')">ä¸è¾£</button>
                        <button class="spec-btn" data-spicy="å¾®è¾£" onclick="selectSpicy('å¾®è¾£')">å¾®è¾£</button>
                        <button class="spec-btn" data-spicy="ä¸­è¾£" onclick="selectSpicy('ä¸­è¾£')">ä¸­è¾£</button>
                        <button class="spec-btn" data-spicy="å¤§è¾£" onclick="selectSpicy('å¤§è¾£')">å¤§è¾£</button>
                    </div>

                    <!-- é£²æ–™é¡ï¼šå†°/ç†±é¸é … -->
                    <div class="drink-options" style="display: none;">
                        <div class="spec-option-group">
                            <h4>ğŸ§Š æº«åº¦</h4>
                            <div class="spec-buttons spec-buttons-2">
                                <button class="spec-btn temp-btn" data-temp="å†°" onclick="selectDrinkTemp('å†°')">å†°</button>
                                <button class="spec-btn temp-btn" data-temp="ç†±" onclick="selectDrinkTemp('ç†±')">ç†±</button>
                            </div>
                        </div>
                        <div id="iceOptions" class="spec-option-group" style="display: none;">
                            <h4>ğŸ§Š å†°å¡Š</h4>
                            <div class="spec-buttons spec-buttons-3">
                                <button class="spec-btn ice-level-btn" data-ice="æ­£å¸¸å†°" onclick="selectIceLevel('æ­£å¸¸å†°')">æ­£å¸¸</button>
                                <button class="spec-btn ice-level-btn" data-ice="å°‘å†°" onclick="selectIceLevel('å°‘å†°')">å°‘å†°</button>
                                <button class="spec-btn ice-level-btn" data-ice="å»å†°" onclick="selectIceLevel('å»å†°')">å»å†°</button>
                            </div>
                        </div>
                        <div id="sugarOptions" class="spec-option-group">
                            <h4>ğŸ¬ ç”œåº¦</h4>
                            <div class="spec-buttons spec-buttons-5">
                                <button class="spec-btn sugar-level-btn active" data-sugar="å…¨ç³–" onclick="selectSugarLevel('å…¨ç³–')">å…¨ç³–</button>
                                <button class="spec-btn sugar-level-btn" data-sugar="å°‘ç³–" onclick="selectSugarLevel('å°‘ç³–')">å°‘ç³–</button>
                                <button class="spec-btn sugar-level-btn" data-sugar="åŠç³–" onclick="selectSugarLevel('åŠç³–')">åŠç³–</button>
                                <button class="spec-btn sugar-level-btn" data-sugar="å¾®ç³–" onclick="selectSugarLevel('å¾®ç³–')">å¾®ç³–</button>
                                <button class="spec-btn sugar-level-btn" data-sugar="ç„¡ç³–" onclick="selectSugarLevel('ç„¡ç³–')">ç„¡ç³–</button>
                            </div>
                        </div>
                    </div>

                    <!-- å…¶ä»–é¡åˆ¥ï¼šèª¿å‘³é¸é … -->
                    <div class="seasoning-options">
                        <div class="spec-option-group">
                            <h4>ğŸŒ¶ï¸ èƒ¡æ¤’</h4>
                            <div class="spec-buttons">
                                <button class="spec-btn pepper-btn active" data-pepper="" onclick="selectPepper('')">æ­£å¸¸</button>
                                <button class="spec-btn pepper-btn" data-pepper="èƒ¡æ¤’å¤š" onclick="selectPepper('èƒ¡æ¤’å¤š')">èƒ¡æ¤’å¤š</button>
                                <button class="spec-btn pepper-btn" data-pepper="èƒ¡æ¤’å°‘" onclick="selectPepper('èƒ¡æ¤’å°‘')">èƒ¡æ¤’å°‘</button>
                                <button class="spec-btn pepper-btn" data-pepper="å»èƒ¡æ¤’" onclick="selectPepper('å»èƒ¡æ¤’')">å»èƒ¡æ¤’</button>
                            </div>
                        </div>

                        <div class="spec-option-group">
                            <h4>ğŸ¥« é†¬</h4>
                            <div class="spec-buttons">
                                <button class="spec-btn sauce-btn active" data-sauce="" onclick="selectSauce('')">æ­£å¸¸</button>
                                <button class="spec-btn sauce-btn" data-sauce="é†¬å¤š" onclick="selectSauce('é†¬å¤š')">é†¬å¤š</button>
                                <button class="spec-btn sauce-btn" data-sauce="é†¬å°‘" onclick="selectSauce('é†¬å°‘')">é†¬å°‘</button>
                                <button class="spec-btn sauce-btn" data-sauce="å»é†¬" onclick="selectSauce('å»é†¬')">å»é†¬</button>
                            </div>
                        </div>
                    </div>

                    <!-- è‡ªè¨‚å‚™è¨» -->
                    <div class="spec-option-group">
                        <h4>ğŸ“ è‡ªè¨‚å‚™è¨»</h4>
                        <input type="text" id="specCustomInput" class="spec-custom-input" placeholder="å…¶ä»–éœ€æ±‚ï¼ˆé¸å¡«ï¼‰">
                    </div>

                    <!-- å“é …æŠ˜æ‰£ -->
                    <div class="spec-option-group">
                        <h4>ğŸ’° å“é …æŠ˜æ‰£</h4>
                        <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                            <button class="discount-btn" onclick="applyItemDiscount(10)">-$10</button>
                            <button class="discount-btn" onclick="applyItemDiscount(20)">-$20</button>
                            <button class="discount-btn" onclick="applyItemDiscount(50)">-$50</button>
                            <button class="discount-btn" onclick="applyItemDiscount(100)">-$100</button>
                        </div>
                        <div style="display: flex; gap: 8px; margin-top: 8px; align-items: center;">
                            <input type="text" id="itemDiscountInput" class="spec-custom-input" placeholder="è‡ªè¨‚æŠ˜æ‰£" style="flex: 1; margin: 0;" inputmode="numeric" pattern="[0-9]*" oninput="this.value = this.value.replace(/[^0-9]/g, '');" maxlength="4">
                            <button class="btn btn-secondary" onclick="applyCustomItemDiscount()" style="padding: 8px 16px;">å¥—ç”¨</button>
                            <button class="btn btn-secondary" onclick="clearItemDiscount()" style="padding: 8px 16px;">æ¸…é™¤</button>
                        </div>
                        <div id="itemDiscountDisplay" style="display: none; margin-top: 8px; padding: 8px; background: #FFF3CD; border-radius: 4px; color: #856404; font-size: 14px;">
                            å“é …æŠ˜æ‰£ï¼š-$<span id="itemDiscountAmount">0</span>
                        </div>
                    </div>
                </div>

                <!-- æ•¸é‡é¸æ“‡ -->
                <div class="spec-section">
                    <h4>ğŸ”¢ æ•¸é‡</h4>
                    <div class="spec-quantity">
                        <button class="qty-btn" onclick="adjustSpecQty(-1)">-</button>
                        <span class="qty-display" id="specQtyDisplay">1</span>
                        <button class="qty-btn" onclick="adjustSpecQty(1)">+</button>
                    </div>
                </div>

                <!-- ç¢ºèªæŒ‰éˆ• -->
                <div class="modal-actions">
                    <button class="btn btn-secondary" onclick="hideSpecModal()">å–æ¶ˆ</button>
                    <button class="btn btn-primary" onclick="confirmSpec()">ç¢ºèªåŠ å…¥</button>
                </div>
            </div>
        </div>
    </div>

    <!-- æ–°å¢/ç·¨è¼¯æŠ˜æ‰£è¦å‰‡å½ˆçª— -->
    <div class="modal-overlay" id="discountModal">
        <div class="modal" style="max-height: 90vh; display: flex; flex-direction: column;">
            <div class="modal-header" style="flex-shrink: 0;">
                <div class="modal-title" id="discountModalTitle">æ–°å¢æŠ˜æ‰£è¦å‰‡</div>
                <button class="modal-close" onclick="hideDiscountModal()">Ã—</button>
            </div>
            <div class="modal-body" style="flex: 1; overflow-y: auto; padding: 20px;">
                <div class="input-group">
                    <label class="input-label">æŠ˜æ‰£é¡å‹</label>
                    <select class="input-field" id="discountType" onchange="onDiscountTypeChange()">
                        <option value="item">å–®ä¸€å“é …æŠ˜æ‰£</option>
                        <option value="category">åˆ†é¡æŠ˜æ‰£</option>
                        <option value="total">ç¸½æ•¸é‡æŠ˜æ‰£</option>
                    </select>
                    <small style="color: #636E72; display: block; margin-top: 4px;" id="discountTypeDesc">
                        æŒ‡å®šå–®ä¸€å•†å“é”åˆ°æ•¸é‡å¾ŒæŠ˜æ‰£
                    </small>
                </div>

                <!-- å–®ä¸€å“é …é¸æ“‡ -->
                <div class="input-group" id="itemSelectGroup">
                    <label class="input-label">é¸æ“‡å“é …</label>
                    <select class="input-field" id="discountItem">
                        <!-- æœƒç”± JavaScript å‹•æ…‹ç”Ÿæˆ -->
                    </select>
                </div>

                <!-- åˆ†é¡é¸æ“‡ -->
                <div class="input-group" id="categorySelectGroup" style="display: none;">
                    <label class="input-label">é¸æ“‡åˆ†é¡</label>
                    <select class="input-field" id="discountCategory">
                        <option value="beef">ç‰›è‚‰</option>
                        <option value="pork">è±¬è‚‰</option>
                        <option value="chicken">é›è‚‰</option>
                        <option value="vegetable">è”¬èœ</option>
                        <option value="skewer">ä¸²ç‡’</option>
                        <option value="drink">é£²å“</option>
                    </select>
                </div>

                <div class="input-group">
                    <label class="input-label">è³¼è²·æ•¸é‡</label>
                    <input type="number" class="input-field" id="discountQuantity" min="1" value="3" placeholder="ä¾‹å¦‚ï¼š3" oninput="updateDiscountPreview()">
                </div>

                <div class="input-group">
                    <label class="input-label">æŠ˜æ‰£é‡‘é¡</label>
                    <input type="number" class="input-field" id="discountAmount" min="1" value="5" placeholder="ä¾‹å¦‚ï¼š5" oninput="updateDiscountPreview()">
                    <small style="color: #636E72; display: block; margin-top: 4px;">
                        è²·æ»¿æŒ‡å®šæ•¸é‡ï¼Œå¯æŠ˜æ‰£çš„é‡‘é¡
                    </small>
                </div>

                <div class="discount-preview" id="discountPreview">
                    <div class="preview-label">å„ªæƒ èªªæ˜é è¦½</div>
                    <div class="preview-text" id="discountPreviewText">çƒ¤é¦™è‡ è²·3ä¸² æŠ˜$5</div>
                </div>

                <div class="modal-actions">
                    <button class="btn btn-secondary" onclick="hideDiscountModal()">å–æ¶ˆ</button>
                    <button class="btn btn-primary" onclick="saveDiscountRule()">å„²å­˜</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==================== ç‹€æ…‹ç®¡ç†æ¶æ§‹ï¼ˆç‚º Vue 3 è½‰æ›åšæº–å‚™ï¼‰===================

        // çµ±ä¸€çš„æ‡‰ç”¨ç‹€æ…‹ï¼ˆæ•´åˆæ‰€æœ‰å…¨åŸŸè®Šæ•¸ï¼‰
        const appState = {
            // ===== è³‡æ–™é…ç½® =====
            config: {
                menuItems: [
                    { id: 1, name: 'ç‰›äº”èŠ±', category: 'beef', price: 120, icon: 'ğŸ¥©', desc: 'æ¾³æ´²é€²å£ç‰›äº”èŠ±' },
                    { id: 2, name: 'ç‰›å°æ’', category: 'beef', price: 150, icon: 'ğŸ¥©', desc: 'åšåˆ‡ç‰›å°æ’' },
                    { id: 3, name: 'ç‰›èˆŒ', category: 'beef', price: 130, icon: 'ğŸ‘…', desc: 'é¹½çƒ¤ç‰›èˆŒ' },
                    { id: 4, name: 'è±¬è‚‹æ’', category: 'pork', price: 80, icon: 'ğŸ–', desc: 'é†ƒè£½è±¬è‚‹æ’' },
                    { id: 5, name: 'åŸ¹æ ¹æ²', category: 'pork', price: 50, icon: 'ğŸ¥“', desc: 'åŸ¹æ ¹æ²èŠ¦ç­' },
                    { id: 6, name: 'é¦™è…¸', category: 'pork', price: 40, icon: 'ğŸŒ­', desc: 'å°å¼é¦™è…¸' },
                    { id: 7, name: 'é›è‚‰ä¸²', category: 'chicken', price: 50, icon: 'ğŸ¢', desc: 'æ–°é®®é›è…¿è‚‰' },
                    { id: 8, name: 'é›ç¿…', category: 'chicken', price: 60, icon: 'ğŸ—', desc: 'é¹½çƒ¤é›ç¿…' },
                    { id: 9, name: 'çƒ¤ç‰ç±³', category: 'vegetable', price: 40, icon: 'ğŸŒ½', desc: 'ç¢³çƒ¤ç‰ç±³' },
                    { id: 10, name: 'çƒ¤é’æ¤’', category: 'vegetable', price: 30, icon: 'ğŸ«‘', desc: 'é’æ¤’å¡è‚‰' },
                    { id: 11, name: 'ä¸²ç‡’çµ„åˆ', category: 'skewer', price: 100, icon: 'ğŸ¢', desc: 'ç¶œåˆä¸²ç‡’' },
                    { id: 12, name: 'çƒ¤é¦™è‡', category: 'vegetable', price: 35, icon: 'ğŸ„', desc: 'ç¢³çƒ¤é¦™è‡' },
                    { id: 13, name: 'å¯æ¨‚', category: 'drink', price: 30, icon: 'ğŸ¥¤', desc: 'å¯å£å¯æ¨‚' },
                    { id: 14, name: 'å•¤é…’', category: 'drink', price: 60, icon: 'ğŸº', desc: 'å°ç£å•¤é…’' }
                ],
                categoryNames: {
                    beef: 'ç‰›è‚‰',
                    pork: 'è±¬è‚‰',
                    chicken: 'é›è‚‰',
                    vegetable: 'è”¬èœ',
                    skewer: 'ä¸²ç‡’',
                    drink: 'é£²å“'
                },
                discountTypes: {
                    item: { name: 'å–®ä¸€å“é …', desc: 'æŒ‡å®šå–®ä¸€å•†å“é”åˆ°æ•¸é‡å¾ŒæŠ˜æ‰£' },
                    category: { name: 'åˆ†é¡æŠ˜æ‰£', desc: 'åŒåˆ†é¡å•†å“ç¸½æ•¸é”åˆ°æ•¸é‡å¾ŒæŠ˜æ‰£' },
                    total: { name: 'ç¸½æ•¸é‡', desc: 'è³¼ç‰©è»Šç¸½æ•¸é”åˆ°æ•¸é‡å¾ŒæŠ˜æ‰£' }
                }
            },

            // ===== è³¼ç‰©è»Šç‹€æ…‹ =====
            cart: {
                items: [],
                currentCategory: 'all',
                orderCount: 1
            },

            // ===== è¦æ ¼é¸æ“‡ç‹€æ…‹ =====
            spec: {
                currentItem: null,
                qty: 1,
                spicy: 'ä¸è¾£',
                pepper: '',
                sauce: '',
                custom: [],
                drinkTemp: 'å†°',
                iceLevel: 'æ­£å¸¸å†°',
                sugarLevel: 'å…¨ç³–'
            },

            // ===== æ‰‹å‹•æŠ˜æ‰£ç‹€æ…‹ =====
            discount: {
                current: 0,
                reason: '',
                rules: [
                    {
                        id: 1,
                        type: 'item',
                        itemId: 12,
                        itemName: 'çƒ¤é¦™è‡',
                        quantity: 3,
                        discountAmount: 5
                    }
                ],
                editingId: null
            },

            // ===== ç‡Ÿæ¥­æ—¥èˆ‡çµ±è¨ˆç‹€æ…‹ =====
            business: {
                businessDate: new Date().toISOString().split('T')[0],
                dailyStats: {
                    date: '',
                    totalRevenue: 0,
                    totalDiscount: 0,
                    orderCount: 0,
                    orders: [],
                    hourlyData: {
                        '17': 0, '18': 0, '19': 0, '20': 0, '21': 0, '22': 0, '23': 0
                    },
                    itemSales: {},
                    categorySales: {
                        beef: 0,
                        pork: 0,
                        chicken: 0,
                        vegetable: 0,
                        skewer: 0,
                        drink: 0
                    }
                },
                weeklyStats: {
                    dailyData: [],
                    totalRevenue: 0,
                    totalOrders: 0,
                    prevWeekRevenue: 0,
                    prevWeekOrders: 0
                },
                monthlyStats: {
                    dailyData: [],
                    totalRevenue: 0,
                    totalOrders: 0
                }
            },

            // ===== UI ç‹€æ…‹ =====
            ui: {
                pendingCartUpdateFrame: null,
                cartNeedsUpdate: false,
                currentEditIndex: -1  // ç”¨æ–¼è¿½è¹¤ç·¨è¼¯æ¨¡å¼
            }
        };

        // åˆå§‹åŒ–ç‡Ÿæ¥­æ—¥
        appState.business.dailyStats.date = appState.business.businessDate;

        // ==================== å¸¸é‡å®šç¾© ====================
        const CONSTANTS = {
            TOUCH_TAP_THRESHOLD: 800,      // ms - è§¸æ§åˆ¤æ–·ç‚ºé»æ“Šçš„æ™‚é–“é–¾å€¼
            SCROLL_THRESHOLD: 10,          // px - åˆ¤æ–·ç‚ºæ»¾å‹•çš„ç§»å‹•è·é›¢
            VIBRATION_DURATION: 10,        // ms - è§¸è¦ºå›é¥‹éœ‡å‹•æ™‚é–“
            MAX_REPORT_DAYS: 7,            // days - æ¸¬è©¦è³‡æ–™ç”Ÿæˆå¤©æ•¸
            CATEGORY_ALL: 'all'             // å…¨éƒ¨åˆ†é¡çš„æ¨™è­˜
        };

        // ==================== å‘å¾Œå…¼å®¹çš„å¿«æ·å¼•ç”¨ï¼ˆé€æ­¥æ·˜æ±°ï¼‰====================
        // é€™äº›æ˜¯ç‚ºäº†ä¿æŒç¾æœ‰ç¨‹å¼ç¢¼æ­£å¸¸é‹ä½œï¼Œæœªä¾†æœƒé€æ­¥ç§»é™¤
        let cart = appState.cart.items;
        let currentCategory = appState.cart.currentCategory;
        let orderCount = appState.cart.orderCount;
        let currentItem = appState.spec.currentItem;
        let currentSpecQty = appState.spec.qty;
        let currentSpecSpicy = appState.spec.spicy;
        let currentSpecPepper = appState.spec.pepper;
        let currentSpecSauce = appState.spec.sauce;
        let currentSpecCustom = appState.spec.custom;
        let currentDrinkTemp = appState.spec.drinkTemp;
        let currentIceLevel = appState.spec.iceLevel;
        let currentSugarLevel = appState.spec.sugarLevel;
        let currentItemDiscount = 0;  // ç•¶å‰å“é …çš„æŠ˜æ‰£
        let currentManualDiscount = appState.discount.current;
        let currentDiscountReason = appState.discount.reason;
        let businessDate = appState.business.businessDate;
        let dailyStats = appState.business.dailyStats;
        let weeklyStats = appState.business.weeklyStats;
        let monthlyStats = appState.business.monthlyStats;
        let discountRules = appState.discount.rules;
        let editingDiscountId = appState.discount.editingId;
        let pendingCartUpdateFrame = appState.ui.pendingCartUpdateFrame;
        let cartNeedsUpdate = appState.ui.cartNeedsUpdate;
        // ==================== å‘å¾Œå…¼å®¹å±¤ ====================
        // ç”±æ–¼ç¾æœ‰ç¨‹å¼ç¢¼ä½¿ç”¨å…¨åŸŸè®Šæ•¸ï¼Œé€™è£¡å‰µå»ºæŒ‡å‘ appState çš„å¼•ç”¨
        // ä½¿ç”¨ window ç‰©ä»¶é¿å…é‡è¤‡å®£å‘ŠéŒ¯èª¤
        if (typeof window.cart === 'undefined') {
            window.cart = appState.cart.items;
            window.currentCategory = appState.cart.currentCategory;
            window.orderCount = appState.cart.orderCount;
            window.currentItem = appState.spec.currentItem;
            window.currentSpecQty = appState.spec.qty;
            window.currentSpecSpicy = appState.spec.spicy;
            window.currentSpecPepper = appState.spec.pepper;
            window.currentSpecSauce = appState.spec.sauce;
            window.currentSpecCustom = appState.spec.custom;
            window.currentDrinkTemp = appState.spec.drinkTemp;
            window.currentIceLevel = appState.spec.iceLevel;
            window.currentSugarLevel = appState.spec.sugarLevel;
            window.currentManualDiscount = appState.discount.current;
            window.currentDiscountReason = appState.discount.reason;
            window.menuItems = appState.config.menuItems;
            window.categoryNames = appState.config.categoryNames;
            window.discountTypes = appState.config.discountTypes;
            window.businessDate = appState.business.businessDate;
            window.dailyStats = appState.business.dailyStats;
            window.weeklyStats = appState.business.weeklyStats;
            window.monthlyStats = appState.business.monthlyStats;
            window.discountRules = appState.discount.rules;
            window.editingDiscountId = appState.discount.editingId;
            window.pendingCartUpdateFrame = appState.ui.pendingCartUpdateFrame;
            window.cartNeedsUpdate = appState.ui.cartNeedsUpdate;
            window.currentEditIndex = appState.ui.currentEditIndex;
        }

        // ==================== æ¥­å‹™é‚è¼¯å±¤ ====================
        // æ³¨æ„ï¼šweeklyStats, monthlyStats, discountRules, editingDiscountId å·²åœ¨ appState ä¸­å®šç¾©

        // ç‹€æ…‹ç®¡ç†å·¥å…·å‡½æ•¸
        const StateManager = {
            // å–å¾—ç‹€æ…‹çš„å€¼
            get(path) {
                return path.split('.').reduce((obj, key) => obj?.[key], appState);
            },

            // è¨­å®šç‹€æ…‹çš„å€¼
            set(path, value) {
                const keys = path.split('.');
                const lastKey = keys.pop();
                const target = keys.reduce((obj, key) => obj[key], appState);
                target[lastKey] = value;
            },

            // æ›´æ–°é™£åˆ—ç‹€æ…‹
            push(path, item) {
                const array = this.get(path);
                if (Array.isArray(array)) {
                    array.push(item);
                }
            },

            // å¾é™£åˆ—ç§»é™¤
            removeFrom(path, index) {
                const array = this.get(path);
                if (Array.isArray(array) && index >= 0 && index < array.length) {
                    array.splice(index, 1);
                }
            }
        };

        // æ•´åˆç‹€æ…‹çš„å·¥å…·å‡½æ•¸ï¼ˆæœªä¾†è½‰æ›æˆ Vue 3 æ™‚ä½¿ç”¨ï¼‰
        const Utils = {
            // æ ¼å¼åŒ–é‡‘é¡
            formatCurrency(amount) {
                return `$${amount.toLocaleString()}`;
            },

            // æ ¼å¼åŒ–æ—¥æœŸ
            formatDate(date) {
                return date.replace(/-/g, '');
            },

            // ç”Ÿæˆè¨‚å–®ç·¨è™Ÿ
            generateOrderNumber(businessDate, orderCount) {
                const dateStr = businessDate.replace(/-/g, '');
                return `#${dateStr}${String(orderCount).padStart(3, '0')}`;
            },

            // è¨ˆç®—è³¼ç‰©è»Šç¸½æ•¸
            getCartTotal(cart) {
                return cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            },

            // è¨ˆç®—è³¼ç‰©è»Šç¸½æ•¸é‡
            getCartTotalCount(cart) {
                return cart.reduce((sum, item) => sum + item.quantity, 0);
            }
        };

        // åˆå§‹åŒ–é¸å–®
        function initMenu() {
            const menuGrid = document.getElementById('menuGrid');
            menuGrid.innerHTML = '';

            const filteredItems = currentCategory === 'all'
                ? menuItems
                : menuItems.filter(item => item.category === currentCategory);

            filteredItems.forEach(item => {
                const menuItem = document.createElement('div');
                menuItem.className = 'menu-item';
                menuItem.innerHTML = `
                    <div class="menu-item-info">
                        <div class="menu-item-name">${item.name}</div>
                        <div class="menu-item-price">$${item.price}</div>
                    </div>
                `;

                // å„ªåŒ–è§¸æ§éŸ¿æ‡‰ - å€åˆ†é»æ“Šå’Œæ»¾å‹•
                let touchStartTime = 0;
                let touchStartX = 0;
                let touchStartY = 0;
                let hasMoved = false;

                menuItem.addEventListener('touchstart', function(e) {
                    touchStartTime = Date.now();
                    touchStartX = e.touches[0].clientX;
                    touchStartY = e.touches[0].clientY;
                    hasMoved = false;

                    // æ·»åŠ è¦–è¦ºå›é¥‹
                    this.classList.add('pressed');

                    // è§¸è¦ºå›é¥‹
                    if (navigator.vibrate) {
                        navigator.vibrate(10);
                    }
                }, { passive: true });

                menuItem.addEventListener('touchmove', function(e) {
                    const touch = e.touches[0];
                    const moveX = Math.abs(touch.clientX - touchStartX);
                    const moveY = Math.abs(touch.clientY - touchStartY);

                    // å¦‚æœç§»å‹•è¶…é 10pxï¼Œè¦–ç‚ºæ»¾å‹•
                    if (moveX > 10 || moveY > 10) {
                        hasMoved = true;
                        this.classList.remove('pressed');
                    }
                }, { passive: true });

                menuItem.addEventListener('touchend', function(e) {
                    const touchDuration = Date.now() - touchStartTime;

                    // ç§»é™¤è¦–è¦ºå›é¥‹
                    this.classList.remove('pressed');

                    // åªæœ‰åœ¨æ²’æœ‰ç§»å‹•ä¸”è§¸æ§æ™‚é–“çŸ­æ–¼ 500ms æ™‚æ‰è§¸ç™¼é»æ“Š
                    if (!hasMoved && touchDuration < 800) {
                        // é˜»æ­¢ default é˜²æ­¢é›™æ“Šæ”¾å¤§ç­‰å¹²æ“¾
                        e.preventDefault();
                        // é€™æ˜¯é»æ“Šï¼Œä¸æ˜¯æ»¾å‹•
                        addToCart(item);
                    }
                }, { passive: false });

                // è§¸æ§å–æ¶ˆæ™‚ä¹Ÿè¦ç§»é™¤è¦–è¦ºå›é¥‹
                menuItem.addEventListener('touchcancel', function(e) {
                    this.classList.remove('pressed');
                }, { passive: true });

                // ä¿ç•™ click ä½œç‚ºå‚™ç”¨ï¼ˆéè§¸æ§è¨­å‚™ï¼‰
                menuItem.onclick = (e) => {
                    // å¦‚æœå·²ç¶“è¢« touchstart è™•ç†éï¼Œå‰‡ä¸é‡è¤‡åŸ·è¡Œ
                    if (!e.defaultPrevented) {
                        addToCart(item);
                    }
                };

                menuGrid.appendChild(menuItem);
            });
        }

        // åˆå§‹åŒ–åˆ†é¡æ¨™ç±¤
        function initCategoryTabs() {
            const tabs = document.querySelectorAll('.category-tab');
            tabs.forEach(tab => {
                tab.onclick = () => {
                    tabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    currentCategory = tab.dataset.category;
                    initMenu();
                };
            });
        }

        // å„ªåŒ–è¦æ ¼æŒ‰éˆ•çš„è§¸æ§éŸ¿æ‡‰
        function initSpecButtons() {
            const specButtons = document.querySelectorAll('.spec-btn');

            specButtons.forEach(btn => {
                let touchStartTime = 0;
                let touchStartX = 0;
                let touchStartY = 0;
                let hasMoved = false;
                let handler = null;

                // æ ¹æ“šæŒ‰éˆ•çš„ class å’Œ data å±¬æ€§æ±ºå®šè™•ç†å™¨
                const isUnified = btn.classList.contains('unified-spec-btn') ||
                                btn.classList.contains('unified-pepper-btn') ||
                                btn.classList.contains('unified-sauce-btn');

                if (isUnified) {
                    // çµ±ä¸€è¦æ ¼æŒ‰éˆ•
                    if (btn.dataset.spicy) {
                        handler = () => selectUnifiedSpicy(btn.dataset.spicy);
                    } else if (btn.dataset.pepper) {
                        handler = () => selectUnifiedPepper(btn.dataset.pepper);
                    } else if (btn.dataset.sauce) {
                        handler = () => selectUnifiedSauce(btn.dataset.sauce);
                    }
                } else {
                    // è¦æ ¼é¸æ“‡å½ˆçª—æŒ‰éˆ•
                    if (btn.dataset.spicy) {
                        handler = () => selectSpicy(btn.dataset.spicy);
                    } else if (btn.dataset.pepper) {
                        handler = () => selectPepper(btn.dataset.pepper);
                    } else if (btn.dataset.sauce) {
                        handler = () => selectSauce(btn.dataset.sauce);
                    } else if (btn.dataset.temp) {
                        handler = () => selectDrinkTemp(btn.dataset.temp);
                    } else if (btn.dataset.ice) {
                        handler = () => selectIceLevel(btn.dataset.ice);
                    } else if (btn.dataset.sugar) {
                        handler = () => selectSugarLevel(btn.dataset.sugar);
                    }
                }

                if (!handler) return; // æ²’æœ‰è™•ç†å™¨ï¼Œè·³é

                // ç§»é™¤åŸä¾†çš„ inline onclick
                btn.onclick = null;

                btn.addEventListener('touchstart', function(e) {
                    touchStartTime = Date.now();
                    touchStartX = e.touches[0].clientX;
                    touchStartY = e.touches[0].clientY;
                    hasMoved = false;

                    // æ·»åŠ è¦–è¦ºå›é¥‹
                    this.classList.add('pressed');

                    // è§¸è¦ºå›é¥‹
                    if (navigator.vibrate) {
                        navigator.vibrate(10);
                    }
                }, { passive: true });

                btn.addEventListener('touchmove', function(e) {
                    const touch = e.touches[0];
                    const moveX = Math.abs(touch.clientX - touchStartX);
                    const moveY = Math.abs(touch.clientY - touchStartY);

                    // å¦‚æœç§»å‹•è¶…é 10pxï¼Œè¦–ç‚ºæ»¾å‹•
                    if (moveX > 10 || moveY > 10) {
                        hasMoved = true;
                        this.classList.remove('pressed');
                    }
                }, { passive: true });

                btn.addEventListener('touchend', function(e) {
                    const touchDuration = Date.now() - touchStartTime;

                    // ç§»é™¤è¦–è¦ºå›é¥‹
                    this.classList.remove('pressed');

                    // åªæœ‰åœ¨æ²’æœ‰ç§»å‹•ä¸”è§¸æ§æ™‚é–“çŸ­æ–¼ 800ms æ™‚æ‰è§¸ç™¼é»æ“Š
                    if (!hasMoved && touchDuration < 800) {
                        e.preventDefault();
                        if (handler) handler.call(this);
                    }
                }, { passive: false });

                // è§¸æ§å–æ¶ˆæ™‚ä¹Ÿè¦ç§»é™¤è¦–è¦ºå›é¥‹
                btn.addEventListener('touchcancel', function(e) {
                    this.classList.remove('pressed');
                }, { passive: true });

                // ä¿ç•™ click ä½œç‚ºå‚™ç”¨ï¼ˆéè§¸æ§è¨­å‚™ï¼‰
                btn.onclick = (e) => {
                    if (!e.defaultPrevented && handler) {
                        handler.call(this);
                    }
                };
            });
        }

        // æ–°å¢åˆ°è³¼ç‰©è»Šï¼ˆå…ˆé¸æ“‡è¦æ ¼ï¼‰
        function addToCart(item) {
            // è¨­ç½®ç•¶å‰å“é …
            currentItem = item;

            // æ ¹æ“šå“é …é¡åˆ¥ä½¿ç”¨ä¸åŒçš„é è¨­è¦æ ¼
            if (item.category === 'drink') {
                // é£²æ–™é¡åˆ¥
                currentSpecQty = 1;
                currentSpecSpicy = '';
                currentSpecPepper = '';
                currentSpecSauce = '';
                currentSpecCustom = [];
                currentDrinkTemp = 'å†°';
                currentIceLevel = 'æ­£å¸¸å†°';
                currentSugarLevel = 'å…¨ç³–';
            } else {
                // ç‡’çƒ¤é¡åˆ¥
                currentSpecQty = 1;
                currentSpecSpicy = 'ä¸è¾£';
                currentSpecPepper = '';
                currentSpecSauce = '';
                currentSpecCustom = [];
                currentDrinkTemp = '';
                currentIceLevel = '';
                currentSugarLevel = '';
            }

            // è¨­å®š UI
            document.getElementById('specItemName').textContent = item.name;
            document.getElementById('specItemPrice').textContent = `$${item.price}`;
            document.getElementById('specQtyDisplay').textContent = currentSpecQty;

            // è¨­å®šè¾£åº¦æŒ‰éˆ•
            document.querySelectorAll('#specModal .spec-btn[data-spicy]').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.spicy === currentSpecSpicy) {
                    btn.classList.add('active');
                }
            });

            // è¨­å®šèª¿å‘³æŒ‰éˆ•ï¼ˆè”¥ã€è’œã€é†¬ï¼‰
            document.querySelectorAll('#specModal .pepper-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            const pepperBtn = document.querySelector(`#specModal .pepper-btn[data-pepper="${currentSpecPepper}"]`);
            if (pepperBtn) pepperBtn.classList.add('active');

            document.querySelectorAll('#specModal .sauce-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            const sauceBtn = document.querySelector(`#specModal .sauce-btn[data-sauce="${currentSpecSauce}"]`);
            if (sauceBtn) sauceBtn.classList.add('active');

            // è¨­å®šæº«åº¦æŒ‰éˆ•ï¼ˆé£²æ–™é¡åˆ¥ï¼‰
            if (item.category === 'drink') {
                document.querySelectorAll('.temp-btn').forEach(btn => {
                    btn.classList.remove('active');
                    if (btn.dataset.temp === currentDrinkTemp) {
                        btn.classList.add('active');
                    }
                });

                // è¨­å®šå†°å¡ŠæŒ‰éˆ•
                const iceSection = document.getElementById('iceOptions');
                const sugarSection = document.getElementById('sugarOptions');
                if (currentDrinkTemp === 'å†°') {
                    iceSection.style.display = 'block';
                    sugarSection.style.display = 'block';

                    document.querySelectorAll('.ice-level-btn').forEach(btn => {
                        btn.classList.remove('active');
                        if (btn.dataset.ice === currentIceLevel) {
                            btn.classList.add('active');
                        }
                    });

                    document.querySelectorAll('.sugar-level-btn').forEach(btn => {
                        btn.classList.remove('active');
                        if (btn.dataset.sugar === currentSugarLevel) {
                            btn.classList.add('active');
                        }
                    });
                } else {
                    iceSection.style.display = 'none';
                    sugarSection.style.display = 'none';
                }
            } else {
                // éé£²æ–™é¡åˆ¥ï¼Œéš±è—å†°å¡Šå’Œç”œåº¦é¸é …
                document.getElementById('iceOptions').style.display = 'none';
                document.getElementById('sugarOptions').style.display = 'none';
            }

            // è¨­å®šè‡ªè¨‚å‚™è¨»
            currentSpecCustom = [];
            document.getElementById('specCustomInput').value = '';

            // ç¢ºä¿ä¸æ˜¯ç·¨è¼¯æ¨¡å¼ï¼ˆå¾èœå–®é»æ“Šæ–°å¢ï¼‰
            currentEditIndex = -1;

            // æ ¹æ“šå“é …é¡åˆ¥é¡¯ç¤º/éš±è—å°æ‡‰çš„é¸é …å€å¡Š
            const modalBody = document.querySelector('#specModal .modal-body');
            const spicySection = modalBody.querySelector('.spicy-section');
            const seasoningOptions = modalBody.querySelector('.seasoning-options');
            const drinkOptions = modalBody.querySelector('.drink-options');
            const quantitySection = modalBody.querySelector('.spec-quantity')?.closest('.spec-section');
            const customInput = document.getElementById('specCustomInput');

            if (item.category === 'drink') {
                // é£²æ–™é¡ï¼šéš±è—è¾£åº¦å’Œèª¿å‘³é¸é …ï¼Œé¡¯ç¤ºé£²æ–™é¸é …
                // ä¸è¦éš±è—æ•´å€‹ spicySectionï¼Œå› ç‚º drinkOptions åœ¨è£¡é¢
                if (spicySection) {
                    // éš±è—è¾£åº¦ label å’ŒæŒ‰éˆ•
                    const spicyLabel = spicySection.querySelector('.spicy-label');
                    if (spicyLabel) spicyLabel.style.display = 'none';
                    const spicyButtons = spicySection.querySelector('.spec-buttons');
                    if (spicyButtons) spicyButtons.style.display = 'none';
                }
                if (seasoningOptions) seasoningOptions.style.display = 'none';
                if (customInput) customInput.style.display = 'block';  // é¡¯ç¤ºè‡ªè¨‚è¼¸å…¥
                if (drinkOptions) drinkOptions.style.display = 'block';
                if (quantitySection) quantitySection.style.display = 'block';  // é¡¯ç¤ºæ•¸é‡é¸æ“‡
            } else {
                // ç‡’çƒ¤é¡ï¼šé¡¯ç¤ºè¾£åº¦å’Œèª¿å‘³é¸é …ï¼Œéš±è—é£²æ–™é¸é …
                if (spicySection) {
                    // é¡¯ç¤ºè¾£åº¦ label å’ŒæŒ‰éˆ•
                    const spicyLabel = spicySection.querySelector('.spicy-label');
                    if (spicyLabel) spicyLabel.style.display = 'block';
                    const spicyButtons = spicySection.querySelector('.spec-buttons');
                    if (spicyButtons) spicyButtons.style.display = 'grid';
                }
                if (seasoningOptions) seasoningOptions.style.display = 'block';
                if (customInput) customInput.style.display = 'block';
                if (drinkOptions) drinkOptions.style.display = 'none';
                if (quantitySection) quantitySection.style.display = 'block';
            }

            // åˆå§‹åŒ–å“é …æŠ˜æ‰£
            currentItemDiscount = 0;
            document.getElementById('itemDiscountInput').value = '';
            updateItemDiscountDisplay();

            // é¡¯ç¤ºè¦æ ¼é¸æ“‡å½ˆçª—
            document.getElementById('specModal').classList.add('active');
        }

        // è¨ˆç®—æŠ˜æ‰£ç¸½é¡
        function calculateDiscounts() {
            let totalDiscount = 0;
            const appliedDiscounts = [];

            discountRules.forEach(rule => {
                if (rule.type === 'item') {
                    // å–®ä¸€å“é …æŠ˜æ‰£
                    const cartItem = cart.find(item => item.id === rule.itemId);
                    if (cartItem && cartItem.quantity >= rule.quantity) {
                        const times = Math.floor(cartItem.quantity / rule.quantity);
                        const discount = times * rule.discountAmount;
                        totalDiscount += discount;
                        appliedDiscounts.push({
                            type: 'item',
                            itemName: rule.itemName,
                            quantity: rule.quantity,
                            times: times,
                            discount: discount,
                            description: `${rule.itemName} è²·${rule.quantity}ä¸²æŠ˜$${rule.discountAmount}`
                        });
                    }
                } else if (rule.type === 'category') {
                    // åˆ†é¡æŠ˜æ‰£
                    const categoryItems = cart.filter(item => item.category === rule.categoryId);
                    const totalQuantity = categoryItems.reduce((sum, item) => sum + item.quantity, 0);

                    if (totalQuantity >= rule.quantity) {
                        const times = Math.floor(totalQuantity / rule.quantity);
                        const discount = times * rule.discountAmount;
                        totalDiscount += discount;
                        appliedDiscounts.push({
                            type: 'category',
                            itemName: `${categoryNames[rule.categoryId]}é¡`,
                            quantity: rule.quantity,
                            times: times,
                            discount: discount,
                            description: `${categoryNames[rule.categoryId]} è²·${rule.quantity}ä¸²æŠ˜$${rule.discountAmount} (å…±${totalQuantity}ä¸²)`
                        });
                    }
                } else if (rule.type === 'total') {
                    // ç¸½æ•¸é‡æŠ˜æ‰£
                    const totalQuantity = cart.reduce((sum, item) => sum + item.quantity, 0);

                    if (totalQuantity >= rule.quantity) {
                        const times = Math.floor(totalQuantity / rule.quantity);
                        const discount = times * rule.discountAmount;
                        totalDiscount += discount;
                        appliedDiscounts.push({
                            type: 'total',
                            itemName: 'å…¨é¤¨å•†å“',
                            quantity: rule.quantity,
                            times: times,
                            discount: discount,
                            description: `å…¨é¤¨ è²·${rule.quantity}ä¸²æŠ˜$${rule.discountAmount} (å…±${totalQuantity}ä¸²)`
                        });
                    }
                }
            });

            return { totalDiscount, appliedDiscounts };
        }

        // æ›´æ–°è³¼ç‰©è»Šé¡¯ç¤ºï¼ˆæ³¨æ„ï¼špendingCartUpdateFrame å’Œ cartNeedsUpdate å·²åœ¨å‰é¢å®£å‘Šï¼‰
        function updateCart() {
            // æ¨™è¨˜éœ€è¦æ›´æ–°
            cartNeedsUpdate = true;

            // å¦‚æœå·²æœ‰å¾…è™•ç†çš„æ›´æ–°ï¼Œä¸é‡è¤‡æ’ç¨‹
            if (!pendingCartUpdateFrame) {
                pendingCartUpdateFrame = requestAnimationFrame(() => {
                    // åªæœ‰åœ¨ç¢ºå¯¦éœ€è¦æ›´æ–°æ™‚æ‰æ¸²æŸ“
                    if (cartNeedsUpdate) {
                        renderCart();
                        cartNeedsUpdate = false;
                    }
                    pendingCartUpdateFrame = null;
                });
            }
        }

        // å¯¦éš›åŸ·è¡Œè³¼ç‰©è»Šæ¸²æŸ“
        function renderCart() {
            const cartItemsContainer = document.getElementById('cartItems');
            const totalItemsEl = document.getElementById('totalItems');
            const cartTotalEl = document.getElementById('cartTotal');

            if (cart.length === 0) {
                cartItemsContainer.innerHTML = `
                    <div class="empty-cart">
                        <div class="empty-cart-icon">ğŸ›’</div>
                        <p>å°šæœªé»é¸ä»»ä½•å•†å“</p>
                    </div>
                `;
                totalItemsEl.textContent = '0';
                cartTotalEl.textContent = '$0';
                return;
            }

            cartItemsContainer.innerHTML = '';
            let subtotal = 0;
            let totalQuantity = 0;

            cart.forEach(item => {
                const itemDiscount = item.discount || 0;
                const itemTotal = (item.price * item.quantity) - itemDiscount;
                subtotal += itemTotal + itemDiscount;  // åŸåƒ¹å°è¨ˆ
                totalQuantity += item.quantity;

                const cartItem = document.createElement('div');
                cartItem.className = 'cart-item';

                // å»ºç«‹è¦æ ¼è³‡è¨Š HTMLï¼ˆåªä½¿ç”¨ custom æ¬„ä½ï¼‰
                let specsHtml = '';
                if (item.custom && item.custom.trim()) {
                    specsHtml += `<span class="spec-tag">ğŸ“ ${item.custom}</span>`;
                }

                // å¦‚æœæœ‰æŠ˜æ‰£ï¼Œé¡¯ç¤ºæŠ˜æ‰£æ¨™ç±¤
                if (itemDiscount > 0) {
                    specsHtml += `<span class="spec-tag discount-tag">ğŸ’° -$${itemDiscount}</span>`;
                }

                cartItem.innerHTML = `
                    <div class="cart-item-info">
                        <div class="cart-item-name">${item.name}</div>
                        ${specsHtml ? `<div class="cart-item-specs">${specsHtml}</div>` : ''}
                    </div>
                    <div class="cart-item-bottom">
                        <div class="cart-item-actions">
                            <button class="quantity-btn" onclick="updateQuantity(${item.id}, -1)">-</button>
                            <div class="quantity-display">${item.quantity}</div>
                            <button class="quantity-btn" onclick="updateQuantity(${item.id}, 1)">+</button>
                            <button class="delete-btn" onclick="removeFromCart(${item.id})">åˆªé™¤</button>
                        </div>
                        <div class="cart-item-total-price">
                            ${itemDiscount > 0 ? `<div style="text-decoration: line-through; color: #999; font-size: 12px;">$${item.price} Ã— ${item.quantity} = $${item.price * item.quantity}</div>` : `<div style="color: #636E72; font-size: 12px;">$${item.price} Ã— ${item.quantity}</div>`}
                            <div style="${itemDiscount > 0 ? 'color: #D63031;' : ''} font-size: 16px; font-weight: 600;">
                                ${`$${itemTotal}`}
                            </div>
                        </div>
                    </div>
                `;
                cartItemsContainer.appendChild(cartItem);
            });

            // è¨ˆç®—æŠ˜æ‰£
            const { totalDiscount: autoDiscount, appliedDiscounts } = calculateDiscounts();

            // è¨ˆç®—å“é …æŠ˜æ‰£ç¸½è¨ˆ
            const itemDiscounts = cart.reduce((sum, item) => sum + (item.discount || 0), 0);

            // ç¸½æŠ˜æ‰£ = å“é …æŠ˜æ‰£ + è‡ªå‹•æŠ˜æ‰£
            const totalDiscount = itemDiscounts + autoDiscount;

            // é¡¯ç¤ºè‡ªå‹•æŠ˜æ‰£è³‡è¨Š
            if (autoDiscount > 0) {
                const discountDiv = document.createElement('div');
                discountDiv.className = 'cart-discount';
                discountDiv.innerHTML = `
                    <div class="discount-label">ğŸ·ï¸ è‡ªå‹•æŠ˜æ‰£</div>
                    <div class="discount-value">-$${autoDiscount}</div>
                `;
                cartItemsContainer.appendChild(discountDiv);

                // é¡¯ç¤ºæŠ˜æ‰£èªªæ˜
                appliedDiscounts.forEach(discount => {
                    const discountInfo = document.createElement('div');
                    discountInfo.style.cssText = 'padding: 8px 12px; font-size: 12px; color: #636E72; background: #FFF3CD; border-radius: 4px; margin-top: 4px;';
                    discountInfo.textContent = discount.description;
                    cartItemsContainer.appendChild(discountInfo);
                });
            }

            // é¡¯ç¤ºå“é …æŠ˜æ‰£è³‡è¨Š
            // if (itemDiscounts > 0) {
            //     const itemDiscountDiv = document.createElement('div');
            //     itemDiscountDiv.className = 'cart-discount';
            //     itemDiscountDiv.style.cssText = 'background: #FFE0E0; padding: 12px; border-radius: 8px; margin-top: 8px; display: flex; justify-content: space-between; align-items: center;';
            //     itemDiscountDiv.innerHTML = `
            //         <div class="discount-label">ğŸ’° å“é …æŠ˜æ‰£</div>
            //         <div class="discount-value">-$${itemDiscounts}</div>
            //     `;
            //     cartItemsContainer.appendChild(itemDiscountDiv);
            // }

            const total = subtotal - totalDiscount;
            totalItemsEl.textContent = totalQuantity;
            cartTotalEl.textContent = `$${total}`;
        }

        // æ›´æ–°æ•¸é‡
        function updateQuantity(id, change) {
            // æ‰¾åˆ°ç¬¬ä¸€å€‹åŒ¹é…çš„é …ç›®ï¼ˆè€ƒæ…®åˆ°å¯èƒ½æœ‰ç›¸åŒIDä½†ä¸åŒè¦æ ¼çš„é …ç›®ï¼‰
            const itemIndex = cart.findIndex(i => i.id === id);
            if (itemIndex >= 0) {
                cart[itemIndex].quantity += change;
                if (cart[itemIndex].quantity <= 0) {
                    cart.splice(itemIndex, 1);
                }
                updateCart();
            }
        }

        // å¾è³¼ç‰©è»Šç§»é™¤
        function removeFromCart(id) {
            // ç§»é™¤ç¬¬ä¸€å€‹åŒ¹é…çš„é …ç›®
            const itemIndex = cart.findIndex(i => i.id === id);
            if (itemIndex >= 0) {
                cart.splice(itemIndex, 1);
                updateCart();
            }
        }

        // æ¸…ç©ºè³¼ç‰©è»Š
        function clearCart() {
            if (confirm('ç¢ºå®šè¦æ¸…ç©ºè¨‚å–®å—ï¼Ÿ')) {
                cart = [];
                updateCart();
            }
        }

        // é¡¯ç¤ºçµå¸³å½ˆçª—
        function showCheckout() {
            if (cart.length === 0) {
                alert('è«‹å…ˆé»é¸å•†å“');
                return;
            }

            const modal = document.getElementById('checkoutModal');
            const checkoutItems = document.getElementById('checkoutItems');
            const checkoutTotal = document.getElementById('checkoutTotal');
            const orderNumber = document.getElementById('orderNumber');
            const orderTime = document.getElementById('orderTime');

            // æ›´æ–°è¨‚å–®è™Ÿå’Œæ™‚é–“ï¼ˆä½¿ç”¨ç‡Ÿæ¥­æ—¥ä½œç‚ºè¨‚å–®è™Ÿæ—¥æœŸéƒ¨åˆ†ï¼‰
            const now = new Date();
            const dateStr = businessDate.replace(/-/g, ''); // ä½¿ç”¨ç‡Ÿæ¥­æ—¥
            const timeStr = now.toTimeString().slice(0, 5);
            orderNumber.textContent = `#${dateStr}${String(orderCount).padStart(3, '0')}`;
            orderTime.textContent = `${dateStr.slice(0, 4)}-${dateStr.slice(4, 6)}-${dateStr.slice(6, 8)} ${timeStr}`;

            // åˆå§‹åŒ–æ‰‹å‹•æŠ˜æ‰£
            currentManualDiscount = 0;
            currentDiscountReason = '';
            document.getElementById('discountReason').value = '';
            document.getElementById('manualDiscountAmount').value = '';
            updateManualDiscountDisplay();

            // åˆå§‹åŒ–çµ±ä¸€è¦æ ¼é¸æ“‡
            initUnifiedSpec();

            // ä½¿ç”¨çµ±ä¸€å‡½æ•¸æ¸²æŸ“è¨‚å–®é …ç›®ï¼ˆé€™æœƒè¨ˆç®— subtotalï¼‰
            renderCheckoutItems();

            // é‡ç½®è¼¸å…¥
            document.getElementById('receivedAmount').value = '';
            document.getElementById('changeDisplay').textContent = 'æ‰¾é›¶ï¼š$0';

            modal.classList.add('active');
        }

        // éš±è—çµå¸³å½ˆçª—
        function hideCheckout() {
            document.getElementById('checkoutModal').classList.remove('active');
        }

        // ==================== è¨‚å–®åˆ—è¡¨å½ˆçª—åŠŸèƒ½ ====================

        // å„²å­˜ç•¶å‰é¡¯ç¤ºçš„æ‰€æœ‰è¨‚å–®ï¼ˆç”¨æ–¼æœå°‹éæ¿¾ï¼‰
        let currentDisplayOrders = [];

        // é¡¯ç¤ºè¨‚å–®åˆ—è¡¨å½ˆçª—
        function showOrderListModal() {
            const startDate = document.getElementById('dailyStartDateSelector').value;
            const endDate = document.getElementById('dailyEndDateSelector').value;

            if (!startDate || !endDate) {
                alert('è«‹å…ˆé¸æ“‡æ—¥æœŸå€é–“ï¼');
                return;
            }

            let orders = [];
            let displayDate = '';

            // è¨ˆç®—æ—¥æœŸå€é–“å…§çš„æ‰€æœ‰æ—¥æœŸ
            const dates = [];
            let currentDate = new Date(startDate);
            const endDateObj = new Date(endDate);

            while (currentDate <= endDateObj) {
                dates.push(currentDate.toISOString().split('T')[0]);
                currentDate.setDate(currentDate.getDate() + 1);
            }

            // å¾å„ç‡Ÿæ¥­æ—¥è³‡æ–™æ”¶é›†è¨‚å–®
            dates.forEach(date => {
                let dayData;

                if (date === businessDate) {
                    // ç•¶å‰ç‡Ÿæ¥­æ—¥ä½¿ç”¨è¨˜æ†¶é«”ä¸­çš„å³æ™‚è³‡æ–™
                    dayData = dailyStats;
                } else {
                    // å¾ localStorage è®€å–è©²ç‡Ÿæ¥­æ—¥çš„è³‡æ–™
                    const saved = localStorage.getItem(`businessData_${date}`);
                    if (saved) {
                        dayData = JSON.parse(saved);
                    }
                }

                if (dayData && dayData.orders) {
                    orders.push(...dayData.orders);
                }
            });

            if (orders.length === 0) {
                alert('è©²æ—¥æœŸå€é–“å°šç„¡è¨‚å–®è¨˜éŒ„ï¼');
                return;
            }

            // å„²å­˜åˆ°å…¨åŸŸè®Šæ•¸ä¾›æœå°‹ä½¿ç”¨
            currentDisplayOrders = orders;

            // æ¸…ç©ºæœå°‹æ¡†
            document.getElementById('orderSearchInput').value = '';

            // æ›´æ–°å½ˆçª—å…§å®¹
            document.getElementById('orderListModalTitle').textContent = 'è¨‚å–®æ˜ç´°';
            displayDate = startDate === endDate
                ? startDate
                : `${startDate} ~ ${endDate}`;
            document.getElementById('orderListDate').textContent = displayDate;

            // ä¾è¨‚å–®ç·¨è™Ÿéæ¸›æ’åºï¼ˆæœ€æ–°çš„åœ¨ä¸Šé¢ï¼‰
            orders.sort((a, b) => b.orderNumber.localeCompare(a.orderNumber));

            // é¡¯ç¤ºæ‰€æœ‰è¨‚å–®
            renderOrderList(orders);

            // é¡¯ç¤ºå½ˆçª—
            document.getElementById('orderListModal').classList.add('active');
        }

        // æ¸²æŸ“è¨‚å–®åˆ—è¡¨
        function renderOrderList(orders) {
            const container = document.getElementById('orderListContainer');

            if (orders.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #636E72;">
                        <div style="font-size: 48px; margin-bottom: 12px;">ğŸ”</div>
                        <div style="font-size: 16px;">æ²’æœ‰æ‰¾åˆ°ç¬¦åˆçš„è¨‚å–®</div>
                    </div>
                `;
                return;
            }

            container.innerHTML = orders.map(order => {
                // è™•ç†æŠ˜æ‰£æ˜ç´°
                let discountDetails = '';
                if (order.discount > 0) {
                    const details = [];

                    // è™•ç†å“é …æŠ˜æ‰£
                    const itemDiscounts = order.items.filter(item => item.discount && item.discount > 0);
                    if (itemDiscounts.length > 0) {
                        const totalItemDiscount = itemDiscounts.reduce((sum, item) => sum + item.discount, 0);
                        const itemNames = itemDiscounts.map(item => item.name).join('ã€');
                        details.push(`ğŸ’° å“é …æŠ˜æ‰£: ${itemNames} (-$${totalItemDiscount})`);
                    }

                    // è™•ç†æ‰‹å‹•æŠ˜æ‰£
                    if (order.manualDiscount > 0) {
                        details.push(`âœ‹ æ‰‹å‹•æŠ˜æ‰£: ${order.manualDiscountReason || 'æ‰‹å‹•æŠ˜æ‰£'} (-$${order.manualDiscount})`);
                    }

                    // è™•ç†è‡ªå‹•æŠ˜æ‰£
                    if (order.appliedDiscounts && order.appliedDiscounts.length > 0) {
                        // å…¼å®¹å…©ç¨®æ ¼å¼ï¼šæ¸¬è©¦è³‡æ–™æ ¼å¼ï¼ˆ{type, name, amount}ï¼‰å’Œ calculateDiscounts æ ¼å¼ï¼ˆ{type, description, discount, times}ï¼‰
                        const autoDiscounts = order.appliedDiscounts.map(d => {
                            // æ¸¬è©¦è³‡æ–™æ ¼å¼ï¼ˆèˆŠæ ¼å¼ï¼‰
                            if (d.name && d.amount) {
                                // æ’é™¤æ‰‹å‹•æŠ˜æ‰£ï¼ˆå·²åœ¨ä¸Šé¢è™•ç†ï¼‰
                                if (d.type === 'æ‰‹å‹•æŠ˜æ‰£') return null;
                                // æª¢æŸ¥æ˜¯å¦æœ‰ä½¿ç”¨æ¬¡æ•¸
                                const timesText = d.times > 1 ? ` x${d.times}` : '';
                                return `${d.type}: ${d.name}${timesText} (-$${d.amount})`;
                            }
                            // calculateDiscounts æ ¼å¼ï¼ˆæ–°æ ¼å¼ï¼‰
                            const typeMap = { 'item': 'å–®ä¸€å“é …', 'category': 'åˆ†é¡æŠ˜æ‰£', 'total': 'ç¸½æ•¸é‡æŠ˜æ‰£' };
                            const timesText = d.times > 1 ? ` x${d.times}` : '';
                            return `${typeMap[d.type] || d.type}: ${d.description}${timesText} (-$${d.discount})`;
                        }).filter(d => d !== null);

                        if (autoDiscounts.length > 0) {
                            details.push(...autoDiscounts);
                        }
                    }

                    // å¦‚æœæ²’æœ‰ä»»ä½•æ˜ç´°ä½†æœ‰æŠ˜æ‰£ï¼Œé¡¯ç¤ºé€šç”¨è¨Šæ¯
                    if (details.length === 0) {
                        details.push(`æŠ˜æ‰£: -$${order.discount}`);
                    }

                    discountDetails = '<div style="background: #FFF0F0; padding: 12px; border-radius: 10px; margin-bottom: 12px; border: 1px solid #FFD0D0;">' +
                        '<div style="font-size: 13px; color: #636E72; line-height: 1.8;">' +
                        details.join('<br/>') +
                        '</div></div>';
                }

                // è¨ˆç®—å£å‘³å‚™è¨»å€å¡Šï¼ˆåƒ…é¡¯ç¤ºéé£²æ–™é¡çš„å‚™è¨»ï¼‰
                const allSpecs = [];
                // å…¼å®¹èˆŠè³‡æ–™ï¼šéæ¿¾å‡ºéé£²æ–™é¡å“é …
                const nonDrinkItems = order.items.filter(item => {
                    if (item.category) {
                        return item.category !== 'drink';
                    }
                });

                if (nonDrinkItems.length > 0) {
                    // æ”¶é›†éé£²æ–™é¡çš„çµ±ä¸€å£å‘³æ¨™ç±¤
                    const unifiedSpecTags = [];

                    // æª¢æŸ¥è¾£åº¦æ˜¯å¦çµ±ä¸€ä¸”ä¸æ˜¯ã€Œä¸è¾£ã€
                    const spicyValues = nonDrinkItems.map(item => item.spicy).filter(s => s && s !== 'ä¸è¾£');
                    if (spicyValues.length > 0 && spicyValues.every(v => v === spicyValues[0])) {
                        unifiedSpecTags.push(`<span style="display: inline-block; padding: 5px 12px; background: #FFEAA7; color: #D63031; border-radius: 6px; font-size: 13px; margin-right: 6px; margin-bottom: 6px; font-weight: 500;">${spicyValues[0]}</span>`);
                    }

                    // æª¢æŸ¥èƒ¡æ¤’æ˜¯å¦çµ±ä¸€
                    const pepperValues = nonDrinkItems.map(item => item.pepper).filter(p => p);
                    if (pepperValues.length > 0 && pepperValues.every(v => v === pepperValues[0])) {
                        unifiedSpecTags.push(`<span style="display: inline-block; padding: 5px 12px; background: #FFE0D6; color: #E17055; border-radius: 6px; font-size: 13px; margin-right: 6px; margin-bottom: 6px; font-weight: 500;">${pepperValues[0]}</span>`);
                    }

                    // æª¢æŸ¥é†¬æ˜¯å¦çµ±ä¸€
                    const sauceValues = nonDrinkItems.map(item => item.sauce).filter(s => s);
                    if (sauceValues.length > 0 && sauceValues.every(v => v === sauceValues[0])) {
                        unifiedSpecTags.push(`<span style="display: inline-block; padding: 5px 12px; background: #F5E6D3; color: #A0522D; border-radius: 6px; font-size: 13px; margin-right: 6px; margin-bottom: 6px; font-weight: 500;">${sauceValues[0]}</span>`);
                    }

                    // åˆä½µçµ±ä¸€å£å‘³æ¨™ç±¤
                    if (unifiedSpecTags.length > 0) {
                        allSpecs.push(`<div style="font-size: 13px; line-height: 1.9; margin-bottom: 6px;">${unifiedSpecTags.join('')}</div>`);
                    }

                    // è‡ªè¨‚å‚™è¨»ï¼ˆéé£²æ–™é¡åªé¡¯ç¤ºä¸€æ¬¡ï¼‰
                    // const customNote = nonDrinkItems.find(item => item.custom && item.custom.trim());
                    // if (customNote) {
                    //     allSpecs.push(`<div style="font-size: 12px; line-height: 1.6; margin-bottom: 6px;"><span style="display: inline-block; padding: 2px 8px; background: #FFE0D6; color: #E17055; border-radius: 4px; font-size: 11px;">ğŸ“ ${customNote.custom}</span></div>`);
                    // }
                }

                const tasteNotesHTML = allSpecs.length > 0 ? `
                    <div style="background: #FFF9F0; padding: 14px; border-radius: 10px; margin-top: 12px; border: 1px solid #FFEAA7;">
                        <div style="font-size: 15px; font-weight: 600; color: #2D3436; margin-bottom: 10px; display: flex; align-items: center;">
                            <span style="margin-right: 6px;">ğŸ“</span>
                            <span>å£å‘³å‚™è¨»</span>
                        </div>
                        ${allSpecs.join('')}
                    </div>
                ` : '';

                const orderId = `order-${order.orderNumber.replace(/[^a-zA-Z0-9]/g, '-')}`;

                return `
                    <div class="order-card" style="background: #F8F9FA; border-radius: 8px; margin-bottom: 12px; overflow: hidden;">
                        <!-- è¨‚å–®æ¨™é¡Œï¼ˆå¯é»æ“Šå±•é–‹ï¼‰ -->
                        <div class="order-header" style="display: flex; justify-content: space-between; align-items: center; padding: 16px; cursor: pointer;" onclick="toggleOrderDetails('${orderId}')">
                            <div style="display: flex; align-items: center; gap: 12px; flex: 1;">
                                <span class="expand-arrow" style="font-size: 20px; color: #636E72; transition: transform 0.2s;">â–¶</span>
                                <div>
                                    <div style="font-weight: 600; font-size: 16px; color: #2D3436;">${order.orderNumber}</div>
                                    <div style="color: #636E72; font-size: 14px;">
                                        ğŸ“… ${order.businessDate || businessDate} ${order.time}
                                    </div>
                                </div>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-weight: 600; font-size: 18px; color: #2D3436;">$${order.total.toLocaleString()}</div>
                                ${order.totalDiscount > 0 ? `<div style="color: #D63031; font-size: 12px;">æŠ˜æ‰£ -$${order.totalDiscount}</div>` : ''}
                            </div>
                        </div>

                        <!-- è¨‚å–®æ˜ç´°ï¼ˆå¯æŠ˜ç–Šï¼‰ -->
                        <div id="${orderId}" class="order-details" style="display: none; padding: 0 16px 16px 16px;">
                            <!-- æŠ˜æ‰£æ˜ç´° -->
                            ${discountDetails}

                            <!-- å“é …æ˜ç´° -->
                            <div style="margin-top: 0;">
                                <div style="margin-bottom: 12px; font-size: 15px; font-weight: 600; color: #2D3436; display: flex; align-items: center;">
                                    <span style="width: 4px; height: 16px; background: #FF6B35; border-radius: 2px; margin-right: 8px;"></span>
                                    å“é …æ˜ç´°
                                </div>
                                ${order.items.map(item => {
                                // æ”¶é›†è©²å“é …çš„è¦æ ¼å‚™è¨»ï¼ˆåƒ…é£²æ–™é¡é¡¯ç¤ºåœ¨å“é …æ˜ç´°ä¸‹æ–¹ï¼‰
                                const specTags = [];
                                // å…¼å®¹èˆŠè³‡æ–™ï¼šå¦‚æœæ²’æœ‰ category å±¬æ€§ï¼Œé€éå“é …åç¨±åˆ¤æ–·
                                const isDrink = item.category === 'drink' ||
                                    (!item.category && ['çç å¥¶èŒ¶', 'æ³¡æ³¡ç¶ ', 'å¯æ¨‚', 'å•¤é…’'].includes(item.name));

                                if (isDrink) {
                                    // é£²æ–™ï¼šåªé¡¯ç¤ºè‡ªè¨‚å‚™è¨»åœ¨å“é …ä¸‹æ–¹
                                    if (item.custom && item.custom.trim()) {
                                        specTags.push(`<span style="display: inline-block; padding: 5px 12px; background: #FFF4E6; color: #E17055; border-radius: 6px; font-size: 13px; margin-right: 6px; margin-bottom: 6px; font-weight: 500;">${item.custom}</span>`);
                                    }
                                }
                                // éé£²æ–™å“é …ä¸åœ¨å“é …æ˜ç´°ä¸‹æ–¹é¡¯ç¤ºå‚™è¨»ï¼ˆæ”¹åœ¨ã€Œå£å‘³å‚™è¨»ã€å€å¡Šçµ±ä¸€é¡¯ç¤ºï¼‰


                                return `
                                    <div style="padding: 14px 16px; background: #F8F9FA; border-radius: 10px; margin-bottom: 10px; border: 1px solid #ECF0F1;">
                                        <div style="display: grid; grid-template-columns: 1fr auto; gap: 12px; align-items: start; margin-bottom: 12px;">
                                            <div style="min-width: 0;">
                                                <div style="font-weight: 600; color: #2D3436; font-size: 16px; line-height: 1.4;">
                                                    ${item.name}
                                                    ${(item.discount || 0) > 0 ? '<span style="margin-left: 6px; color: #D63031; font-size: 13px;">ğŸ’°</span>' : ''}
                                                </div>
                                                ${specTags.length > 0 ? `
                                                    <div style="margin-top: 8px; line-height: 1.9;">
                                                        ${specTags.join('')}
                                                    </div>
                                                ` : ''}
                                            </div>
                                            <div style="text-align: right;">
                                                <div style="font-size: 19px; font-weight: 600; color: #636E72; white-space: nowrap; margin-bottom: ${(item.discount || 0) > 0 ? '8px' : '0'};">$${item.price} Ã— ${item.quantity}</div>
                                            </div>
                                        </div>
                                        ${(item.discount || 0) > 0 ? `
                                            <div style="border-top: 1px dashed #DFE6E9; padding-top: 10px; margin-top: 8px;">
                                                <div style="display: flex; justify-content: space-between; font-size: 13px; margin-bottom: 4px;">
                                                    <span style="color: #B2BEC3; text-decoration: line-through;">åŸåƒ¹</span>
                                                    <span style="color: #B2BEC3; text-decoration: line-through;">$${(item.price * item.quantity).toLocaleString()}</span>
                                                </div>
                                                <div style="display: flex; justify-content: space-between; font-size: 13px; margin-bottom: 6px;">
                                                    <span style="color: #D63031;">ğŸ’° å“é …æŠ˜æ‰£</span>
                                                    <span style="color: #D63031; font-weight: 600;">-$${item.discount.toLocaleString()}</span>
                                                </div>
                                                <div style="display: flex; justify-content: space-between; font-size: 18px; font-weight: 700;">
                                                    <span style="color: #D63031;">å°è¨ˆ</span>
                                                    <span style="color: #D63031;">$${((item.price * item.quantity) - item.discount).toLocaleString()}</span>
                                                </div>
                                            </div>
                                        ` : `
                                            <div style="border-top: 1px dashed #DFE6E9; padding-top: 10px; margin-top: 8px;">
                                                <div style="display: flex; justify-content: space-between; font-size: 18px; font-weight: 700;">
                                                    <span style="color: #2D3436;">å°è¨ˆ</span>
                                                    <span style="color: #2D3436;">$${(item.price * item.quantity).toLocaleString()}</span>
                                                </div>
                                            </div>
                                        `}
                                    </div>
                                `;
                            }).join('')}
                        </div>

                        <!-- å£å‘³å‚™è¨»å€å¡Šï¼ˆæ•´å€‹è¨‚å–®çµ±ä¸€é¡¯ç¤ºï¼‰ -->
                        ${tasteNotesHTML}

                        <!-- åƒ¹æ ¼æ˜ç´° -->
                        <div style="background: #F8F9FA; border-radius: 10px; padding: 14px; margin-top: 12px; border: 1px solid #ECF0F1;">
                            <div style="display: flex; justify-content: space-between; font-size: 14px; margin-bottom: 6px;">
                                <span style="color: #636E72; font-weight: 500;">å°è¨ˆ</span>
                                <span style="color: #2D3436; font-weight: 600;">$${order.subtotal.toLocaleString()}</span>
                            </div>
                            ${order.discount > 0 ? `
                                <div style="display: flex; justify-content: space-between; font-size: 14px; margin-bottom: 6px;">
                                    <span style="color: #636E72; font-weight: 500;">æŠ˜æ‰£</span>
                                    <span style="color: #D63031; font-weight: 600;">-$${order.discount.toLocaleString()}</span>
                                </div>
                            ` : ''}
                            <div style="display: flex; justify-content: space-between; font-size: 17px; font-weight: 700; margin-top: 10px; padding-top: 10px; border-top: 1px dashed #DFE6E9;">
                                <span style="color: #2D3436;">ç¸½è¨ˆ</span>
                                <span style="color: #00B894;">$${order.total.toLocaleString()}</span>
                            </div>
                        </div>
                        </div><!-- å…³é—­ order-details -->
                    </div><!-- å…³é—­ order-card -->
                `;
            }).join('');
        }

        // åˆ‡æ›è¨‚å–®æ˜ç´°é¡¯ç¤º/éš±è—ï¼ˆå„ªåŒ–ç‰ˆæœ¬ï¼‰
        function toggleOrderDetails(orderId) {
            const details = document.getElementById(orderId);
            if (!details) return;

            const header = details.previousElementSibling;
            const arrow = header?.querySelector('.expand-arrow');
            const isHidden = details.style.display === 'none' || details.style.display === '';

            // ä½¿ç”¨ classList ä¾†ç®¡ç†ç‹€æ…‹ï¼Œæ•ˆèƒ½æ›´å¥½
            if (isHidden) {
                // å±•é–‹
                details.style.display = 'block';
                if (arrow) {
                    arrow.style.transform = 'rotate(90deg)';
                    arrow.textContent = 'â–¼';
                }
            } else {
                // æ”¶èµ·
                details.style.display = 'none';
                if (arrow) {
                    arrow.style.transform = 'rotate(0deg)';
                    arrow.textContent = 'â–¶';
                }
            }
        }

        // å±•é–‹æ‰€æœ‰è¨‚å–®ï¼ˆå„ªåŒ–ç‰ˆæœ¬ï¼‰
        function expandAllOrders() {
            const allDetails = document.querySelectorAll('.order-details');
            const allArrows = document.querySelectorAll('.expand-arrow');

            // ä½¿ç”¨ requestAnimationFrame ç¢ºä¿æµæš¢
            requestAnimationFrame(() => {
                allDetails.forEach(details => {
                    details.style.display = 'block';
                });

                allArrows.forEach(arrow => {
                    arrow.style.transform = 'rotate(90deg)';
                    arrow.textContent = 'â–¼';
                });
            });
        }

        // æ”¶èµ·æ‰€æœ‰è¨‚å–®ï¼ˆå„ªåŒ–ç‰ˆæœ¬ï¼‰
        function collapseAllOrders() {
            const allDetails = document.querySelectorAll('.order-details');
            const allArrows = document.querySelectorAll('.expand-arrow');

            // ä½¿ç”¨ requestAnimationFrame ç¢ºä¿æµæš¢
            requestAnimationFrame(() => {
                allDetails.forEach(details => {
                    details.style.display = 'none';
                });

                allArrows.forEach(arrow => {
                    arrow.style.transform = 'rotate(0deg)';
                    arrow.textContent = 'â–¶';
                });
            });
        }

        // éæ¿¾è¨‚å–®åˆ—è¡¨ï¼ˆæ ¹æ“šè¨‚å–®ç·¨è™Ÿæœå°‹ï¼‰
        function filterOrderList() {
            const searchValue = document.getElementById('orderSearchInput').value.trim().toUpperCase();

            if (!searchValue) {
                // å¦‚æœæœå°‹æ¡†ç‚ºç©ºï¼Œé¡¯ç¤ºæ‰€æœ‰è¨‚å–®
                renderOrderList(currentDisplayOrders);
                return;
            }

            // éæ¿¾ç¬¦åˆæœå°‹æ¢ä»¶çš„è¨‚å–®
            const filteredOrders = currentDisplayOrders.filter(order => {
                return order.orderNumber.toUpperCase().includes(searchValue);
            });

            renderOrderList(filteredOrders);
        }

        // éš±è—è¨‚å–®åˆ—è¡¨å½ˆçª—
        function hideOrderListModal() {
            document.getElementById('orderListModal').classList.remove('active');
        }

        // è¨­å®šå¿«é€Ÿé‡‘é¡ï¼ˆç›´æ¥è¨­å®šï¼‰
        function setAmount(amount) {
            document.getElementById('receivedAmount').value = amount;
            calculateChange();
        }

        // ç´¯åŠ é‡‘é¡ï¼ˆæŒ‰éˆ•å¯ç´¯åŠ ï¼‰
        function addAmount(amount) {
            const input = document.getElementById('receivedAmount');
            const current = parseInt(input.value) || 0;
            const newValue = current + amount;
            input.value = newValue;

            // ç›´æ¥è¨ˆç®—æ‰¾é›¶ï¼Œé¿å…é‡è¤‡è¨ˆç®—å°è¨ˆå’ŒæŠ˜æ‰£
            const receivedInput = document.getElementById('receivedAmount');
            const changeDisplay = document.getElementById('changeDisplay');
            const received = parseInt(receivedInput.value) || 0;

            // å¾å…¨åŸŸè®Šæ•¸æˆ–è¨ˆç®—ç¸½é¡ï¼ˆåŒ…å«æ‰‹å‹•æŠ˜æ‰£ï¼‰
            const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const { totalDiscount: autoDiscount } = calculateDiscounts();
            const total = Math.max(0, subtotal - autoDiscount - currentManualDiscount);

            const change = received - total;
            if (change >= 0) {
                changeDisplay.textContent = `æ‰¾é›¶ï¼š$${change}`;
                changeDisplay.style.background = '#00B894';
            } else {
                changeDisplay.textContent = `é‡‘é¡ä¸è¶³ï¼šå·® $${Math.abs(change)}`;
                changeDisplay.style.background = '#D63031';
            }
        }

        // æ”¶å…¨é¡
        function setFullAmount() {
            // è¨ˆç®—å°è¨ˆå’Œæ‰€æœ‰æŠ˜æ‰£ï¼ˆåŒ…å«æ‰‹å‹•æŠ˜æ‰£ï¼‰
            const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const { totalDiscount: autoDiscount } = calculateDiscounts();
            const total = Math.max(0, subtotal - autoDiscount - currentManualDiscount);

            // å››æ¨äº”å…¥åˆ°æ•´æ•¸
            const fullAmount = Math.round(total);
            const input = document.getElementById('receivedAmount');
            input.value = fullAmount;

            // ç«‹å³æ›´æ–°æ‰¾é›¶é¡¯ç¤º
            const changeDisplay = document.getElementById('changeDisplay');
            changeDisplay.textContent = 'æ‰¾é›¶ï¼š$0';
            changeDisplay.style.background = '#00B894';
        }

        // æ¸…é™¤é‡‘é¡ï¼ˆæ­¸é›¶ï¼‰
        function clearAmount() {
            const input = document.getElementById('receivedAmount');
            input.value = '';

            // ç«‹å³é‡ç½®æ‰¾é›¶é¡¯ç¤º
            const changeDisplay = document.getElementById('changeDisplay');
            const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const { totalDiscount: autoDiscount } = calculateDiscounts();
            const total = Math.max(0, subtotal - autoDiscount - currentManualDiscount);

            changeDisplay.textContent = `é‡‘é¡ä¸è¶³ï¼šå·® $${total}`;
            changeDisplay.style.background = '#D63031';
        }

        // é©—è­‰æ•¸å­—è¼¸å…¥
        function validateNumberInput(input) {
            // ç§»é™¤éæ•¸å­—å­—å…ƒï¼ˆå…è¨±ç©ºå­—ä¸²ä»¥ä¾¿æ¸…é™¤ï¼‰
            const value = input.value.replace(/[^\d]/g, '');
            input.value = value;
            calculateChange();
        }

        // è¨ˆç®—æ‰¾é›¶
        function calculateChange() {
            const receivedInput = document.getElementById('receivedAmount');
            const changeDisplay = document.getElementById('changeDisplay');

            // è¨ˆç®—å“é …æŠ˜æ‰£å¾Œçš„å°è¨ˆ
            const subtotal = cart.reduce((sum, item) => {
                const itemTotal = item.price * item.quantity;
                const itemDiscount = item.discount || 0;
                return sum + (itemTotal - itemDiscount);
            }, 0);

            const { totalDiscount: autoDiscount } = calculateDiscounts();
            const total = Math.max(0, subtotal - autoDiscount - currentManualDiscount);  // ç¸½è¨ˆ = æŠ˜æ‰£å¾Œå°è¨ˆ - è‡ªå‹•æŠ˜æ‰£ - æ‰‹å‹•æŠ˜æ‰£

            const received = parseInt(receivedInput.value) || 0;

            const change = received - total;
            if (change >= 0) {
                changeDisplay.textContent = `æ‰¾é›¶ï¼š$${change}`;
                changeDisplay.style.background = '#00B894';
            } else {
                changeDisplay.textContent = `é‡‘é¡ä¸è¶³ï¼šå·® $${Math.abs(change)}`;
                changeDisplay.style.background = '#D63031';
            }
        }

        // å®Œæˆä»˜æ¬¾
        function completePayment() {
            // è¨ˆç®—åŸåƒ¹å°è¨ˆï¼ˆç”¨æ–¼çµ±è¨ˆï¼‰
            const originalSubtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);

            // è¨ˆç®—å“é …æŠ˜æ‰£å¾Œçš„å°è¨ˆï¼ˆç”¨æ–¼è¨‚å–®æ˜ç´°é¡¯ç¤ºï¼‰
            const subtotal = cart.reduce((sum, item) => {
                const itemTotal = item.price * item.quantity;
                const itemDiscount = item.discount || 0;
                return sum + (itemTotal - itemDiscount);
            }, 0);

            const { totalDiscount: autoDiscount, appliedDiscounts } = calculateDiscounts();

            // è¨ˆç®—å“é …æŠ˜æ‰£ç¸½å’Œ
            const itemDiscounts = cart.reduce((sum, item) => sum + (item.discount || 0), 0);

            // ç¸½æŠ˜æ‰£ = å“é …æŠ˜æ‰£ + è‡ªå‹•æŠ˜æ‰£ + æ‰‹å‹•æŠ˜æ‰£
            const totalDiscount = itemDiscounts + autoDiscount + currentManualDiscount;
            const total = subtotal - autoDiscount - currentManualDiscount;  // ç¸½è¨ˆ = æŠ˜æ‰£å¾Œå°è¨ˆ - è‡ªå‹•æŠ˜æ‰£ - æ‰‹å‹•æŠ˜æ‰£

            const received = parseInt(document.getElementById('receivedAmount').value) || 0;

            if (received < total) {
                alert('å¯¦æ”¶é‡‘é¡ä¸è¶³ï¼');
                return;
            }

            // è¨˜éŒ„è¨‚å–®åˆ°çµ±è¨ˆè³‡æ–™
            const now = new Date();
            const hour = now.getHours().toString();

            // ä½¿ç”¨ç‡Ÿæ¥­æ—¥ï¼Œä¸åˆ¤æ–·æ–°çš„ä¸€å¤©ï¼ˆç‡Ÿæ¥­æ—¥åªåœ¨é—œå¸³æ™‚æ›´æ–°ï¼‰

            // æ›´æ–°çµ±è¨ˆï¼ˆtotalRevenue è¨˜éŒ„åŸåƒ¹ï¼ŒtotalDiscount è¨˜éŒ„æŠ˜æ‰£ï¼‰
            dailyStats.totalRevenue += originalSubtotal;
            dailyStats.totalDiscount += totalDiscount; // åŒ…å«å“é …æŠ˜æ‰£ã€è‡ªå‹•æŠ˜æ‰£å’Œæ‰‹å‹•æŠ˜æ‰£
            dailyStats.orderCount++;

            // æ›´æ–°æ™‚æ®µè³‡æ–™ï¼ˆä½¿ç”¨åŸåƒ¹ï¼‰
            if (dailyStats.hourlyData.hasOwnProperty(hour)) {
                dailyStats.hourlyData[hour] += originalSubtotal;
            }

            // æ›´æ–°å•†å“éŠ·å”®çµ±è¨ˆå’Œåˆ†é¡çµ±è¨ˆ
            cart.forEach(item => {
                const itemTotal = item.price * item.quantity;
                const itemDiscount = item.discount || 0;  // ç›´æ¥ä½¿ç”¨å“é …æŠ˜æ‰£

                // å•†å“çµ±è¨ˆ
                if (!dailyStats.itemSales[item.id]) {
                    dailyStats.itemSales[item.id] = {
                        name: item.name,
                        quantity: 0,
                        revenue: 0,
                        discount: 0
                    };
                }
                dailyStats.itemSales[item.id].quantity += item.quantity;
                dailyStats.itemSales[item.id].revenue += itemTotal;
                dailyStats.itemSales[item.id].discount += itemDiscount;

                // åˆ†é¡çµ±è¨ˆ
                if (dailyStats.categorySales.hasOwnProperty(item.category)) {
                    dailyStats.categorySales[item.category] += itemTotal;
                }
            });

            // è¨˜éŒ„è¨‚å–®ï¼ˆåŒ…å«å®Œæ•´è³‡æ–™ï¼‰
            dailyStats.orders.push({
                orderNumber: document.getElementById('orderNumber').textContent,
                businessDate: businessDate,  // è¨˜éŒ„ç‡Ÿæ¥­æ—¥
                time: now.toTimeString().slice(0, 8),
                items: cart.map(i => ({
                    name: i.name,
                    quantity: i.quantity,
                    price: i.price,
                    discount: i.discount || 0,  // å“é …æŠ˜æ‰£
                    category: i.category || null,
                    spicy: i.spicy || null,
                    pepper: i.pepper || null,
                    sauce: i.sauce || null,
                    custom: i.custom || null
                })),
                subtotal: subtotal,  // å“é …æŠ˜æ‰£å¾Œçš„å°è¨ˆ
                discount: autoDiscount + currentManualDiscount,  // è‡ªå‹•æŠ˜æ‰£ + æ‰‹å‹•æŠ˜æ‰£ï¼ˆä¸å«å“é …æŠ˜æ‰£ï¼‰
                totalDiscount: totalDiscount,  // å®Œæ•´æŠ˜æ‰£ï¼ˆå“é …æŠ˜æ‰£ + è‡ªå‹•æŠ˜æ‰£ + æ‰‹å‹•æŠ˜æ‰£ï¼‰
                total: total,  // æœ€çµ‚ç¸½è¨ˆ
                manualDiscount: currentManualDiscount,
                manualDiscountReason: currentManualDiscount > 0 ? (currentDiscountReason.trim() || 'æ‰‹å‹•æŠ˜æ‰£') : null,
                appliedDiscounts: appliedDiscounts
            });

            // ç«‹å³å„²å­˜ç•¶å‰ç‡Ÿæ¥­æ—¥è³‡æ–™åˆ° localStorage
            localStorage.setItem(`businessData_${businessDate}`, JSON.stringify(dailyStats));
            localStorage.setItem('currentBusinessDate', businessDate);

            // é¡¯ç¤ºå®Œæˆè¨Šæ¯
            alert(`âœ… ä»˜æ¬¾å®Œæˆï¼\n\nè¨‚å–®å·²è‡ªå‹•åˆ—å°å»šæˆ¿å–®å’Œå®¢æˆ¶å°ç¥¨`);

            // æ¸…ç©ºè³¼ç‰©è»Š
            cart = [];
            orderCount++;
            updateCart();

            // é—œé–‰å½ˆçª—
            hideCheckout();
        }

        // ==================== æ¯å¤©çµå¸³æ¢åŠŸèƒ½ ====================

        // è¼‰å…¥çµå¸³å ±è¡¨
        function loadCheckoutReport() {
            // çµ±è¨ˆå¡ç‰‡
            const totalRevenue = dailyStats.totalRevenue || 0;
            const totalDiscount = dailyStats.totalDiscount || 0;
            const actualRevenue = totalRevenue - totalDiscount;
            const profit = actualRevenue; // åˆ©æ½¤ = å¯¦æ”¶é‡‘é¡

            document.getElementById('checkoutRevenue').textContent = `$${totalRevenue.toLocaleString()}`;
            document.getElementById('checkoutDiscount').textContent = `-$${totalDiscount.toLocaleString()}`;
            document.getElementById('checkoutActual').textContent = `$${actualRevenue.toLocaleString()}`;
            document.getElementById('checkoutProfit').textContent = `$${profit.toLocaleString()}`;

            // è¨‚å–®æ˜ç´°åˆ—è¡¨
            const orderList = document.getElementById('checkoutOrderList');
            if (dailyStats.orders && dailyStats.orders.length > 0) {
                orderList.innerHTML = dailyStats.orders.map(order => `
                    <tr style="border-bottom: 1px solid #DFE6E9;">
                        <td style="padding: 12px;">${order.orderNumber}</td>
                        <td style="padding: 12px;">ğŸ“… ${order.businessDate || businessDate} ${order.time}</td>
                        <td style="padding: 12px; text-align: right;">$${order.subtotal.toLocaleString()}</td>
                        <td style="padding: 12px; text-align: right; color: #D63031;">-$${order.discount.toLocaleString()}</td>
                        <td style="padding: 12px; text-align: right; font-weight: bold;">$${order.total.toLocaleString()}</td>
                    </tr>
                `).join('');
            } else {
                orderList.innerHTML = '<tr><td colspan="5" style="padding: 20px; text-align: center; color: #636E72;">ä»Šæ—¥å°šç„¡è¨‚å–®è¨˜éŒ„</td></tr>';
            }
        }

        // åŒ¯å‡ºçµå¸³æ˜ç´°ï¼ˆæ”¯æ´æ—¥æœŸå€é–“åŒ¯å‡ºï¼‰
        function exportDailyReport() {
            const startDate = document.getElementById('dailyStartDateSelector').value;
            const endDate = document.getElementById('dailyEndDateSelector').value;

            if (!startDate || !endDate) {
                alert('è«‹å…ˆé¸æ“‡æ—¥æœŸå€é–“ï¼');
                return;
            }

            // è¨ˆç®—æ—¥æœŸå€é–“å…§çš„æ‰€æœ‰æ—¥æœŸ
            const dates = [];
            let currentDate = new Date(startDate);
            const endDateObj = new Date(endDate);

            while (currentDate <= endDateObj) {
                dates.push(currentDate.toISOString().split('T')[0]);
                currentDate.setDate(currentDate.getDate() + 1);
            }

            // æ”¶é›†å€é–“å…§æ‰€æœ‰è¨‚å–®
            let allOrders = [];
            let totalRevenue = 0;
            let totalDiscount = 0;
            let totalOrderCount = 0;

            dates.forEach(date => {
                let dayData;

                if (date === businessDate) {
                    // ç•¶å‰ç‡Ÿæ¥­æ—¥ä½¿ç”¨è¨˜æ†¶é«”ä¸­çš„å³æ™‚è³‡æ–™
                    dayData = dailyStats;
                } else {
                    // å¾ localStorage è®€å–è©²ç‡Ÿæ¥­æ—¥çš„è³‡æ–™
                    const saved = localStorage.getItem(`businessData_${date}`);
                    if (saved) {
                        dayData = JSON.parse(saved);
                    }
                }

                if (dayData && dayData.orders && dayData.orders.length > 0) {
                    allOrders.push(...dayData.orders);
                    totalRevenue += dayData.totalRevenue || 0;
                    totalDiscount += dayData.totalDiscount || 0;
                    totalOrderCount += dayData.orderCount || 0;
                }
            });

            if (allOrders.length === 0) {
                alert('é¸æ“‡çš„æ—¥æœŸå€é–“å…§æ²’æœ‰è¨‚å–®è¨˜éŒ„ï¼');
                return;
            }

            const actualRevenue = totalRevenue - totalDiscount;

            // ç”¢ç”Ÿ CSV å…§å®¹
            let csv = '\uFEFF'; // UTF-8 BOM
            csv += 'å¤¯è‚‰ HANGROU - çµå¸³æ˜ç´°\n';
            csv += `åŒ¯å‡ºæ™‚é–“,${new Date().toLocaleString('zh-TW')}\n`;
            csv += `æ—¥æœŸå€é–“,${startDate} è‡³ ${endDate} (${dates.length} å¤©)\n`;
            csv += `\n`;
            csv += 'ç‡Ÿæ¥­çµ±è¨ˆ\n';
            csv += `åŸåƒ¹ç‡Ÿæ¥­é¡,${totalRevenue}\n`;
            csv += `ç¸½æŠ˜æ‰£,-${totalDiscount}\n`;
            csv += `å¯¦æ”¶é‡‘é¡,${actualRevenue}\n`;
            csv += `è¨‚å–®æ•¸,${totalOrderCount}\n`;
            csv += `\n`;
            csv += 'è¨‚å–®æ˜ç´°\n';
            csv += 'è¨‚å–®è™Ÿ,ç‡Ÿæ¥­æ—¥,æ™‚é–“,å“é …,æ•¸é‡,å–®åƒ¹,å°è¨ˆ,å“é …æŠ˜æ‰£,è¨‚å–®æŠ˜æ‰£,ç¸½æŠ˜æ‰£,å¯¦æ”¶\n';

            // ä¾æ—¥æœŸå’Œè¨‚å–®è™Ÿæ’åº
            allOrders.sort((a, b) => {
                const dateA = a.businessDate || businessDate;
                const dateB = b.businessDate || businessDate;
                if (dateA !== dateB) return dateA.localeCompare(dateB);
                return a.orderNumber.localeCompare(b.orderNumber);
            });

            allOrders.forEach(order => {
                const orderDate = order.businessDate || businessDate;
                order.items.forEach(item => {
                    const itemSubtotal = item.quantity * item.price;
                    // å“é …æœ¬èº«çš„æŠ˜æ‰£
                    const itemOwnDiscount = item.discount || 0;
                    // è¨‚å–®å±¤ç´šçš„æŠ˜æ‰£ï¼ˆè‡ªå‹•æŠ˜æ‰£ + æ‰‹å‹•æŠ˜æ‰£ï¼‰å¹³å‡åˆ†é…åˆ°æ¯å€‹å“é …
                    const orderDiscountPerItem = Math.round((order.discount || 0) / order.items.length);
                    // è©²å“é …çš„ç¸½æŠ˜æ‰£ = å“é …æŠ˜æ‰£ + å¹³å‡åˆ†é…çš„è¨‚å–®æŠ˜æ‰£
                    const totalItemDiscount = itemOwnDiscount + orderDiscountPerItem;
                    const itemTotal = itemSubtotal - totalItemDiscount;

                    csv += `${order.orderNumber},${orderDate},${order.time},${item.name},${item.quantity},${item.price},${itemSubtotal},${itemOwnDiscount},${orderDiscountPerItem},${totalItemDiscount},${itemTotal}\n`;
                });
            });

            // ä¸‹è¼‰ CSV æª”æ¡ˆ
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);

            // æª”åä½¿ç”¨æ—¥æœŸå€é–“
            const filename = startDate === endDate
                ? `çµå¸³æ˜ç´°_${startDate}.csv`
                : `çµå¸³æ˜ç´°_${startDate}_è‡³_${endDate}.csv`;

            link.download = filename;
            link.click();

            alert(`âœ… å·²åŒ¯å‡º ${dates.length} å¤©çš„çµå¸³æ˜ç´°ï¼\n\n` +
                `æ—¥æœŸå€é–“ï¼š${startDate} è‡³ ${endDate}\n` +
                `è¨‚å–®æ•¸ï¼š${totalOrderCount} ç­†\n` +
                `åŸåƒ¹ç‡Ÿæ¥­é¡ï¼š$${totalRevenue.toLocaleString()}\n` +
                `å¯¦æ”¶é‡‘é¡ï¼š$${actualRevenue.toLocaleString()}\n\n` +
                `æª”åï¼š${filename}`);
        }

        // ç¢ºèªæ¯æ—¥çµå¸³ï¼ˆåªä¿å­˜ï¼Œä¸æ¸…ç©ºï¼‰
        function confirmDailyCheckout() {
            if (!dailyStats.orders || dailyStats.orders.length === 0) {
                alert('ä»Šæ—¥å°šç„¡è¨‚å–®è¨˜éŒ„ï¼');
                return;
            }

            const totalRevenue = dailyStats.totalRevenue || 0;
            const totalDiscount = dailyStats.totalDiscount || 0;
            const actualRevenue = totalRevenue - totalDiscount;

            const message = `ğŸ“Š æ¯æ—¥çµå¸³ç¢ºèª\n\n` +
                `ç‡Ÿæ¥­æ—¥ï¼š${dailyStats.date}\n` +
                `è¨‚å–®æ•¸ï¼š${dailyStats.orderCount} ç­†\n` +
                `åŸåƒ¹ç‡Ÿæ¥­é¡ï¼š$${totalRevenue.toLocaleString()}\n` +
                `ç¸½æŠ˜æ‰£ï¼š-$${totalDiscount.toLocaleString()}\n` +
                `å¯¦æ”¶é‡‘é¡ï¼š$${actualRevenue.toLocaleString()}\n\n` +
                `æ³¨æ„ï¼šè³‡æ–™å·²è‡ªå‹•å„²å­˜ï¼Œæ­¤ç¢ºèªåŠŸèƒ½åƒ…ä¾›æé†’ä½¿ç”¨ã€‚`;

            alert(message);
        }

        // åŸ·è¡Œæ¯æ—¥é—œå¸³ï¼ˆæ›æ—¥ï¼‰
        function performDailyCloseout() {
            if (!dailyStats.orders || dailyStats.orders.length === 0) {
                alert('ä»Šæ—¥å°šç„¡è¨‚å–®è¨˜éŒ„ï¼');
                return;
            }

            const totalRevenue = dailyStats.totalRevenue || 0;
            const totalDiscount = dailyStats.totalDiscount || 0;
            const actualRevenue = totalRevenue - totalDiscount;

            const message = `ğŸ”’ æ¯æ—¥é—œå¸³ï¼ˆæ›æ—¥ï¼‰\n\n` +
                `âš ï¸ æ­¤æ“ä½œå°‡åŸ·è¡Œä»¥ä¸‹å‹•ä½œï¼š\n` +
                `1. ä¿å­˜ä»Šæ—¥ç‡Ÿæ¥­è³‡æ–™åˆ°æ­·å²è¨˜éŒ„\n` +
                `2. æ¸…ç©ºä»Šæ—¥çµ±è¨ˆè³‡æ–™\n` +
                `3. é‡ç½®è¨‚å–®ç·¨è™Ÿï¼ˆæ˜æ—¥å¾ #æ–°æ—¥æœŸ-001 é–‹å§‹ï¼‰\n\n` +
                `æ—¥æœŸï¼š${dailyStats.date}\n` +
                `è¨‚å–®æ•¸ï¼š${dailyStats.orderCount} ç­†\n` +
                `åŸåƒ¹ç‡Ÿæ¥­é¡ï¼š$${totalRevenue.toLocaleString()}\n` +
                `ç¸½æŠ˜æ‰£ï¼š-$${totalDiscount.toLocaleString()}\n` +
                `å¯¦æ”¶é‡‘é¡ï¼š$${actualRevenue.toLocaleString()}\n\n` +
                `âš ï¸ ç¢ºèªè¦é—œå¸³å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸï¼`;

            if (confirm(message)) {
                // ç¬¬äºŒæ¬¡ç¢ºèª
                if (!confirm('âš ï¸ æœ€å¾Œç¢ºèªï¼šçœŸçš„è¦é—œå¸³å—ï¼Ÿ\n\né—œå¸³å¾Œä»Šæ—¥æ‰€æœ‰çµ±è¨ˆè³‡æ–™å°‡è¢«æ¸…ç©ºï¼Œ\nè¨‚å–®ç·¨è™Ÿå°‡é‡æ–°é–‹å§‹è¨ˆç®—ã€‚')) {
                    return;
                }

                // é—œå¸³ï¼šè³‡æ–™å·²åœ¨æ¯æ¬¡ä»˜æ¬¾å¾Œå„²å­˜åˆ° localStorageï¼Œæ­¤è™•åªéœ€æ›´æ–°ç‡Ÿæ¥­æ—¥
                // æ›´æ–°ç‡Ÿæ¥­æ—¥åˆ°ä¸‹ä¸€å¤©
                const nextBusinessDate = new Date(businessDate);
                nextBusinessDate.setDate(nextBusinessDate.getDate() + 1);
                businessDate = nextBusinessDate.toISOString().split('T')[0];
                dailyStats.date = businessDate;

                // æ¸…ç©ºçµ±è¨ˆè³‡æ–™
                dailyStats = {
                    date: businessDate,
                    totalRevenue: 0,
                    totalDiscount: 0,
                    orderCount: 0,
                    orders: [],
                    hourlyData: {
                        '17': 0, '18': 0, '19': 0, '20': 0, '21': 0, '22': 0, '23': 0
                    },
                    itemSales: {},
                    categorySales: {
                        beef: 0,
                        pork: 0,
                        chicken: 0,
                        vegetable: 0,
                        skewer: 0,
                        drink: 0
                    }
                };

                // å„²å­˜ç•¶å‰ç‡Ÿæ¥­æ—¥ï¼ˆå·²æ›´æ–°ï¼‰
                localStorage.setItem('currentBusinessDate', businessDate);

                // å„²å­˜æ–°ç‡Ÿæ¥­æ—¥çš„åˆå§‹è³‡æ–™
                localStorage.setItem(`businessData_${businessDate}`, JSON.stringify(dailyStats));

                // é‡ç½®è¨‚å–®ç·¨è™Ÿ
                orderCount = 1;

                // æ¸…ç©ºè³¼ç‰©è»Š
                cart = [];
                updateCart();

                // æ›´æ–°è¨‚å–®ç·¨è™Ÿé¡¯ç¤ºï¼ˆå¦‚æœçµå¸³å½ˆçª—é–‹å•Ÿï¼‰
                const orderNumberEl = document.getElementById('orderNumber');
                if (orderNumberEl) {
                    updateOrderNumber();
                }

                // æ›´æ–°ä¸»ç•«é¢ç‡Ÿæ¥­æ—¥é¡¯ç¤º
                updateHeaderBusinessDate();

                // é‡æ–°è¼‰å…¥å ±è¡¨
                loadDailyReport();

                alert('âœ… é—œå¸³å®Œæˆï¼\n\n' +
                    `â€¢ ç‡Ÿæ¥­æ—¥å·²æ›´æ–°ç‚º ${businessDate}\n` +
                    `â€¢ çµ±è¨ˆè³‡æ–™å·²æ¸…ç©º\n` +
                    `â€¢ è¨‚å–®ç·¨è™Ÿå·²é‡ç½®\n\n` +
                    'ğŸŒŸ æ˜æ—¥ç‡Ÿæ¥­æº–å‚™å°±ç·’ï¼');
            }
        }

        // æ›´æ–°è¨‚å–®ç·¨è™Ÿé¡¯ç¤º
        function updateOrderNumber() {
            const orderNumberEl = document.getElementById('orderNumber');
            if (orderNumberEl) {
                const dateStr = businessDate.replace(/-/g, ''); // ä½¿ç”¨ç‡Ÿæ¥­æ—¥
                orderNumberEl.textContent = `#${dateStr}${String(orderCount).padStart(3, '0')}`;
            }
        }

        // æ›´æ–° header é¡¯ç¤ºçš„ç‡Ÿæ¥­æ—¥
        function updateHeaderBusinessDate() {
            const headerBusinessDateEl = document.getElementById('headerBusinessDate');
            if (headerBusinessDateEl) {
                headerBusinessDateEl.textContent = businessDate;
            }
        }

        // ==================== æ¸¬è©¦è³‡æ–™ç”ŸæˆåŠŸèƒ½ ====================

        // ç”Ÿæˆæ¸¬è©¦è³‡æ–™ï¼ˆé–‹ç™¼ç”¨ï¼‰
        function generateTestData() {
            // éš¨æ©Ÿç”Ÿæˆå£å‘³è¼”åŠ©å‡½æ•¸
            const generateRandomSpec = (item) => {
                if (item.category === 'drink') {
                    // é£²æ–™é¡ï¼šéš¨æ©Ÿç”Ÿæˆæº«åº¦ã€å†°å¡Šã€ç”œåº¦
                    const temps = ['å†°', 'å†°', 'å†°', 'ç†±']; // å†°çš„æ©Ÿç‡è¼ƒé«˜
                    const iceLevels = ['æ­£å¸¸å†°', 'å°‘å†°', 'å»å†°'];
                    const sugarLevels = ['å…¨ç³–', 'å…¨ç³–', 'å°‘ç³–', 'åŠç³–', 'å¾®ç³–', 'ç„¡ç³–'];

                    const temp = temps[Math.floor(Math.random() * temps.length)];
                    const custom = [];

                    if (temp === 'ç†±') {
                        custom.push('ç†±');
                        // ç†±é£²éš¨æ©Ÿç”œåº¦ï¼ˆå•¤é…’é™¤å¤–ï¼‰
                        if (item.name !== 'å•¤é…’') {
                            const sugar = sugarLevels[Math.floor(Math.random() * sugarLevels.length)];
                            if (sugar !== 'å…¨ç³–') {
                                custom.push(sugar);
                            }
                        }
                    } else {
                        // å†°é£²éš¨æ©Ÿå†°å¡Šï¼ˆæ­£å¸¸å†°ä¸é¡¯ç¤ºï¼‰
                        const ice = iceLevels[Math.floor(Math.random() * iceLevels.length)];
                        if (ice !== 'æ­£å¸¸å†°') {
                            custom.push(ice);
                        }
                        // éš¨æ©Ÿç”œåº¦ï¼ˆå•¤é…’é™¤å¤–ï¼Œå…¨ç³–ä¸é¡¯ç¤ºï¼‰
                        if (item.name !== 'å•¤é…’') {
                            const sugar = sugarLevels[Math.floor(Math.random() * sugarLevels.length)];
                            if (sugar !== 'å…¨ç³–') {
                                custom.push(sugar);
                            }
                        }
                    }

                    return {
                        custom: custom.length > 0 ? custom.join('ã€') : ''
                    };
                } else {
                    // éé£²æ–™é¡ï¼šéš¨æ©Ÿç”Ÿæˆè¾£åº¦ã€èƒ¡æ¤’ã€é†¬
                    const spicyLevels = ['ä¸è¾£', 'ä¸è¾£', 'ä¸è¾£', 'å¾®è¾£', 'å¾®è¾£', 'ä¸­è¾£', 'å¤§è¾£'];
                    const pepperOptions = ['', '', 'èƒ¡æ¤’å¤š', 'èƒ¡æ¤’å°‘', 'å»èƒ¡æ¤’'];
                    const sauceOptions = ['', '', 'é†¬å¤š', 'é†¬å°‘', 'å»é†¬'];

                    const spicy = spicyLevels[Math.floor(Math.random() * spicyLevels.length)];
                    const pepper = pepperOptions[Math.floor(Math.random() * pepperOptions.length)];
                    const sauce = sauceOptions[Math.floor(Math.random() * sauceOptions.length)];

                    const custom = [];
                    if (pepper) custom.push(pepper);
                    if (sauce) custom.push(sauce);

                    return {
                        spicy: spicy,
                        custom: custom.length > 0 ? custom.join('ã€') : ''
                    };
                }
            };

            // èˆ‡å¯¦éš›é¸å–®å°æ‡‰çš„å“é …ï¼ˆä½¿ç”¨å¯¦éš› IDï¼‰
            const testMenuItems = [
                { id: 12, name: 'çƒ¤é¦™è‡', price: 35, category: 'vegetable' }, // å–®ä¸€å“é …æŠ˜æ‰£ç›®æ¨™
                { id: 1, name: 'ç‰›äº”èŠ±', price: 120, category: 'beef' },
                { id: 2, name: 'ç‰›å°æ’', price: 150, category: 'beef' },
                { id: 3, name: 'ç‰›èˆŒ', price: 130, category: 'beef' },
                { id: 4, name: 'è±¬è‚‹æ’', price: 80, category: 'pork' },
                { id: 5, name: 'åŸ¹æ ¹æ²', price: 50, category: 'pork' },
                { id: 6, name: 'é¦™è…¸', price: 40, category: 'pork' },
                { id: 7, name: 'é›è‚‰ä¸²', price: 50, category: 'chicken' },
                { id: 8, name: 'é›ç¿…', price: 60, category: 'chicken' },
                { id: 11, name: 'ä¸²ç‡’çµ„åˆ', price: 100, category: 'skewer' },
                { id: 13, name: 'å¯æ¨‚', price: 30, category: 'drink' },
                { id: 14, name: 'å•¤é…’', price: 60, category: 'drink' }
            ];

            // æ¸¬è©¦ç”¨çš„æŠ˜æ‰£è¦å‰‡ï¼ˆå°æ‡‰å¯¦éš›è¦å‰‡ï¼‰
            const testDiscountRules = [
                { type: 'item', itemId: 12, itemName: 'çƒ¤é¦™è‡', quantity: 3, discountAmount: 5 },
                { type: 'category', categoryId: 'chicken', categoryName: 'é›è‚‰', quantity: 3, discountAmount: 5 },
                { type: 'total', quantity: 5, discountAmount: 20 }
            ];

            const testData = [];

            // ç”Ÿæˆéå»7å¤©çš„è³‡æ–™
            for (let daysAgo = 7; daysAgo >= 1; daysAgo--) {
                const date = new Date();
                date.setDate(date.getDate() - daysAgo);
                const dateStr = date.toISOString().split('T')[0];

                // éš¨æ©Ÿç”Ÿæˆè©²å¤©çš„è¨‚å–®æ•¸ï¼ˆ25-50ç­†ï¼‰
                const orderCount = Math.floor(Math.random() * 25) + 25;
                const orders = [];
                let totalRevenue = 0;
                let totalDiscount = 0;
                const itemSales = {};
                const categorySales = { beef: 0, pork: 0, chicken: 0, vegetable: 0, skewer: 0, drink: 0 };

                for (let i = 0; i < orderCount; i++) {
                    // æ±ºå®šé€™ç­†è¨‚å–®çš„é¡å‹ï¼ˆæ“´å±•æ”¯æ´æ‰‹å‹•æŠ˜æ‰£ã€å®¢è£½åŒ–å£å‘³ã€å¤šæ¬¡æŠ˜æ‰£æ‡‰ç”¨ï¼‰
                    // 0-1: ç„¡æŠ˜æ‰£, 2-3: å–®ä¸€æŠ˜æ‰£, 4-5: é›™é‡æŠ˜æ‰£, 6-7: ä¸‰é‡æŠ˜æ‰£
                    // 8-9: æ‰‹å‹•æŠ˜æ‰£, 10-11: å«å®¢è£½åŒ–å£å‘³, 12-13: åŒä¸€æŠ˜æ‰£å¤šæ¬¡æ‡‰ç”¨
                    const orderType = Math.floor(Math.random() * 14);

                    let orderItems = [];
                    let orderSubtotal = 0;
                    let manualDiscount = 0;
                    let manualDiscountReason = '';

                    // ç‚ºé€™ç­†è¨‚å–®ç”Ÿæˆçµ±ä¸€çš„ç‡’çƒ¤å£å‘³
                    const unifiedSpicyLevels = ['ä¸è¾£', 'ä¸è¾£', 'ä¸è¾£', 'å¾®è¾£', 'å¾®è¾£', 'ä¸­è¾£', 'å¤§è¾£'];
                    const unifiedPepperOptions = ['', '', 'èƒ¡æ¤’å¤š', 'èƒ¡æ¤’å°‘', 'å»èƒ¡æ¤’'];
                    const unifiedSauceOptions = ['', '', 'é†¬å¤š', 'é†¬å°‘', 'å»é†¬'];

                    const orderUnifiedSpicy = unifiedSpicyLevels[Math.floor(Math.random() * unifiedSpicyLevels.length)];
                    const orderUnifiedPepper = unifiedPepperOptions[Math.floor(Math.random() * unifiedPepperOptions.length)];
                    const orderUnifiedSauce = unifiedSauceOptions[Math.floor(Math.random() * unifiedSauceOptions.length)];

                    const orderUnifiedCustom = [];
                    if (orderUnifiedPepper) orderUnifiedCustom.push(orderUnifiedPepper);
                    if (orderUnifiedSauce) orderUnifiedCustom.push(orderUnifiedSauce);
                    const orderUnifiedCustomStr = orderUnifiedCustom.length > 0 ? orderUnifiedCustom.join('ã€') : '';

                    // æ ¹æ“šè¨‚å–®é¡å‹ç”Ÿæˆå“é …
                    switch (orderType) {
                        case 0: // ç„¡æŠ˜æ‰£ - ç°¡å–®è¨‚å–®
                        case 1:
                            orderItems = [
                                { name: 'ç‰›äº”èŠ±', quantity: 1, price: 120 },
                                { name: 'å¯æ¨‚', quantity: 1, price: 30 }
                            ];
                            break;

                        case 2: // å–®ä¸€å“é …æŠ˜æ‰£ï¼ˆçƒ¤é¦™è‡è²·3ä¸²ï¼‰
                            orderItems = [
                                { name: 'çƒ¤é¦™è‡', quantity: 3, price: 35 },
                                { name: 'å¯æ¨‚', quantity: 1, price: 30 }
                            ];
                            break;

                        case 3: // åˆ†é¡æŠ˜æ‰£ï¼ˆé›è‚‰è²·3ä¸²ï¼‰
                            orderItems = [
                                { name: 'é›è‚‰ä¸²', quantity: 2, price: 50 },
                                { name: 'é›ç¿…', quantity: 1, price: 60 },
                                { name: 'å•¤é…’', quantity: 1, price: 60 }
                            ];
                            break;

                        case 4: // é›™é‡æŠ˜æ‰£ï¼ˆçƒ¤é¦™è‡ + é›è‚‰ï¼‰
                            orderItems = [
                                { name: 'çƒ¤é¦™è‡', quantity: 3, price: 35 },
                                { name: 'é›è‚‰ä¸²', quantity: 2, price: 50 },
                                { name: 'é›ç¿…', quantity: 1, price: 60 },
                                { name: 'å¯æ¨‚', quantity: 1, price: 30 }
                            ];
                            break;

                        case 5: // é›™é‡æŠ˜æ‰£ï¼ˆé›è‚‰ + æ»¿5ä»¶ï¼‰
                            orderItems = [
                                { name: 'é›è‚‰ä¸²', quantity: 2, price: 50 },
                                { name: 'é›ç¿…', quantity: 1, price: 60 },
                                { name: 'ç‰›äº”èŠ±', quantity: 1, price: 120 },
                                { name: 'å•¤é…’', quantity: 1, price: 60 }
                            ];
                            break;

                        case 6: // ä¸‰é‡æŠ˜æ‰£ï¼ˆçƒ¤é¦™è‡ + é›è‚‰ + æ»¿5ä»¶ï¼‰
                        case 7:
                            orderItems = [
                                { name: 'çƒ¤é¦™è‡', quantity: 3, price: 35 },
                                { name: 'é›è‚‰ä¸²', quantity: 2, price: 50 },
                                { name: 'é›ç¿…', quantity: 1, price: 60 },
                                { name: 'åŸ¹æ ¹æ²', quantity: 1, price: 50 },
                                { name: 'å¯æ¨‚', quantity: 1, price: 30 }
                            ];
                            break;

                        case 8: // æ‰‹å‹•æŠ˜æ‰£ - æœƒå“¡æŠ˜æ‰£
                        case 9:
                            orderItems = [
                                { name: 'ç‰›äº”èŠ±', quantity: 2, price: 120 },
                                { name: 'è±¬è‚‹æ’', quantity: 1, price: 80 },
                                { name: 'å¯æ¨‚', quantity: 2, price: 30 },
                                { name: 'å•¤é…’', quantity: 1, price: 60 }
                            ];
                            manualDiscount = orderType === 8 ? 50 : 30;
                            manualDiscountReason = 'æœƒå“¡æŠ˜æ‰£';
                            break;

                        case 10: // å«å®¢è£½åŒ–å£å‘³ - é›è‚‰ä¸²ï¼ˆè¾£åº¦+å‚™è¨»ï¼‰
                        case 11:
                            orderItems = [
                                {
                                    name: 'é›è‚‰ä¸²',
                                    quantity: 2,
                                    price: 50,
                                    spicy: 'ä¸­è¾£',
                                    pepper: 'èƒ¡æ¤’å¤š',
                                    sauce: '',
                                    custom: 'èƒ¡æ¤’å¤š'
                                },
                                {
                                    name: 'çƒ¤é¦™è‡',
                                    quantity: 3,
                                    price: 35,
                                    spicy: 'ä¸è¾£',
                                    pepper: '',
                                    sauce: '',
                                    custom: ''
                                },
                                {
                                    name: 'å¯æ¨‚',
                                    quantity: 1,
                                    price: 30,
                                    custom: 'å°‘å†°ã€åŠç³–'
                                }
                            ];
                            break;

                        case 12: // å–®ä¸€å“é …æŠ˜æ‰£å¤šæ¬¡ä½¿ç”¨ï¼ˆçƒ¤é¦™è‡6ä¸² = æŠ˜$10ï¼‰
                            orderItems = [
                                { name: 'çƒ¤é¦™è‡', quantity: 6, price: 35 },
                                { name: 'å¯æ¨‚', quantity: 1, price: 30 },
                                { name: 'å•¤é…’', quantity: 1, price: 60 }
                            ];
                            break;

                        case 13: // åˆ†é¡æŠ˜æ‰£å¤šæ¬¡ä½¿ç”¨ï¼ˆé›è‚‰6ä¸² = æŠ˜$10ï¼‰
                            orderItems = [
                                { name: 'é›è‚‰ä¸²', quantity: 3, price: 50 },
                                { name: 'é›ç¿…', quantity: 3, price: 60 },
                                { name: 'å¯æ¨‚', quantity: 1, price: 30 }
                            ];
                            break;
                    }

                    // è£œå…… category å±¬æ€§åˆ° orderItemsï¼ˆå¾ testMenuItems æŸ¥æ‰¾ï¼‰
                    // ä¸¦ç”Ÿæˆå£å‘³ï¼ˆç‡’çƒ¤é¡ä½¿ç”¨çµ±ä¸€å£å‘³ï¼Œé£²æ–™é¡å„è‡ªéš¨æ©Ÿï¼‰
                    orderItems = orderItems.map(item => {
                        const menuItem = testMenuItems.find(m => m.name === item.name);
                        const category = menuItem ? menuItem.category : 'other';

                        // å¦‚æœå·²ç¶“æœ‰å®šç¾© spicy æˆ– customï¼Œä¿ç•™åŸå€¼ï¼ˆcase 10/11 çš„æ¸¬è©¦è³‡æ–™ï¼‰
                        if (item.spicy || item.custom) {
                            return {
                                ...item,
                                category: category
                            };
                        }

                        // é£²æ–™é¡ï¼šå„è‡ªéš¨æ©Ÿç”Ÿæˆå£å‘³
                        if (category === 'drink') {
                            const randomSpec = generateRandomSpec({ name: item.name, category: category });
                            return {
                                ...item,
                                category: category,
                                custom: randomSpec.custom
                            };
                        }

                        // ç‡’çƒ¤é¡ï¼šä½¿ç”¨çµ±ä¸€çš„å£å‘³ï¼ˆåˆ†åˆ¥å­˜å„²å„æ¬„ä½ï¼‰
                        return {
                            ...item,
                            category: category,
                            spicy: orderUnifiedSpicy,
                            pepper: orderUnifiedPepper,
                            sauce: orderUnifiedSauce,
                            custom: orderUnifiedCustomStr
                        };
                    });

                    // è¨ˆç®—å°è¨ˆå’ŒæŠ˜æ‰£
                    orderItems.forEach(item => {
                        const itemTotal = item.price * item.quantity;
                        orderSubtotal += itemTotal;

                        // çµ±è¨ˆå•†å“éŠ·å”®
                        if (!itemSales[item.name]) {
                            itemSales[item.name] = {
                                name: item.name,
                                quantity: 0,
                                revenue: 0,
                                discount: 0
                            };
                        }
                        itemSales[item.name].quantity += item.quantity;
                        itemSales[item.name].revenue += itemTotal;

                        // çµ±è¨ˆåˆ†é¡éŠ·å”®
                        if (item.category && categorySales.hasOwnProperty(item.category)) {
                            categorySales[item.category] += itemTotal;
                        }
                    });

                    // è¨ˆç®—å¤šå€‹æŠ˜æ‰£
                    let orderDiscount = 0;
                    let appliedDiscounts = [];

                    // å°è‡ªå‹•æŠ˜æ‰£é¡å‹ï¼ˆ0-7, 10-13ï¼‰è¨ˆç®—è‡ªå‹•æŠ˜æ‰£
                    // cases 8-9 ç‚ºæ‰‹å‹•æŠ˜æ‰£ï¼Œä¸è¨ˆç®—è‡ªå‹•æŠ˜æ‰£
                    if (orderType <= 7 || orderType >= 10) {
                        // æª¢æŸ¥å–®ä¸€å“é …æŠ˜æ‰£ï¼šçƒ¤é¦™è‡è²·3ä¸²æŠ˜$5
                        const mushroomQty = orderItems.filter(i => i.name === 'çƒ¤é¦™è‡').reduce((sum, i) => sum + i.quantity, 0);
                        if (mushroomQty >= 3) {
                            const times = Math.floor(mushroomQty / 3);
                            const discount = times * 5;
                            orderDiscount += discount;
                            appliedDiscounts.push({ type: 'å–®ä¸€å“é …', name: 'çƒ¤é¦™è‡è²·3ä¸²æŠ˜$5', amount: discount, times: times });
                        }

                        // æª¢æŸ¥åˆ†é¡æŠ˜æ‰£ï¼šé›è‚‰è²·3ä¸²æŠ˜$5
                        const chickenQty = orderItems.filter(i => ['é›è‚‰ä¸²', 'é›ç¿…', 'é›å¿ƒ'].includes(i.name))
                            .reduce((sum, i) => sum + i.quantity, 0);
                        if (chickenQty >= 3) {
                            const times = Math.floor(chickenQty / 3);
                            const discount = times * 5;
                            orderDiscount += discount;
                            appliedDiscounts.push({ type: 'åˆ†é¡æŠ˜æ‰£', name: 'é›è‚‰é¡è²·3ä¸²æŠ˜$5', amount: discount, times: times });
                        }

                        // æª¢æŸ¥ç¸½æ•¸é‡æŠ˜æ‰£ï¼šæ»¿5ä»¶æŠ˜$20
                        const totalQty = orderItems.reduce((sum, i) => sum + i.quantity, 0);
                        if (totalQty >= 5) {
                            const times = Math.floor(totalQty / 5);
                            const discount = times * 20;
                            orderDiscount += discount;
                            appliedDiscounts.push({ type: 'ç¸½æ•¸é‡æŠ˜æ‰£', name: 'æ»¿5ä»¶æŠ˜$20', amount: discount, times: times });
                        }
                    }

                    // æ‰‹å‹•æŠ˜æ‰£
                    if (manualDiscount > 0) {
                        orderDiscount += manualDiscount;
                        appliedDiscounts.push({ type: 'æ‰‹å‹•æŠ˜æ‰£', name: manualDiscountReason, amount: manualDiscount });
                    }

                    const orderTotal = orderSubtotal - orderDiscount;
                    totalRevenue += orderSubtotal;
                    totalDiscount += orderDiscount;

                    orders.push({
                        orderNumber: `#${dateStr.replace(/-/g, '')}${String(i + 1).padStart(3, '0')}`,
                        time: `${String(17 + Math.floor(Math.random() * 6)).padStart(2, '0')}:${String(Math.floor(Math.random() * 60)).padStart(2, '0')}`,
                        items: orderItems,
                        subtotal: orderSubtotal,
                        discount: orderDiscount,
                        total: orderTotal,
                        manualDiscount: manualDiscount,
                        manualDiscountReason: manualDiscountReason,
                        appliedDiscounts: appliedDiscounts
                    });
                }

                // æ™‚æ®µè³‡æ–™
                const hourlyData = {
                    '17': Math.floor(Math.random() * 2000) + 500,
                    '18': Math.floor(Math.random() * 3000) + 1000,
                    '19': Math.floor(Math.random() * 4000) + 2000,
                    '20': Math.floor(Math.random() * 3500) + 1500,
                    '21': Math.floor(Math.random() * 2500) + 1000,
                    '22': Math.floor(Math.random() * 1500) + 500,
                    '23': Math.floor(Math.random() * 1000) + 300
                };

                const dayData = {
                    date: dateStr,
                    checkoutTime: new Date(date).toISOString(),
                    totalRevenue: totalRevenue,
                    totalDiscount: totalDiscount,
                    actualRevenue: totalRevenue - totalDiscount,
                    orderCount: orderCount,
                    orders: orders,
                    hourlyData: hourlyData,
                    itemSales: itemSales,
                    categorySales: categorySales,
                    confirmed: true
                };

                testData.push(dayData);
            }

            // å„²å­˜åˆ° localStorageï¼ˆä½¿ç”¨ businessData_${date} æ ¼å¼ï¼‰
            const testDates = [];
            testData.forEach(dayData => {
                localStorage.setItem(`businessData_${dayData.date}`, JSON.stringify(dayData));
                testDates.push(dayData.date);
            });

            // å„²å­˜æ¸¬è©¦è³‡æ–™æ—¥æœŸåˆ—è¡¨
            localStorage.setItem('testDataDates', JSON.stringify(testDates));

            // è‡ªå‹•å•Ÿç”¨æ¸¬è©¦æ¨¡å¼
            localStorage.setItem('testMode', 'true');
            checkTestMode();

            // è‡ªå‹•è¨­å®šæ—¥å ±è¡¨æ—¥æœŸé¸æ“‡å™¨ä¸¦è¼‰å…¥å ±è¡¨
            const firstDate = testDates[0];
            const lastDate = testDates[testDates.length - 1];
            document.getElementById('dailyStartDateSelector').value = firstDate;
            document.getElementById('dailyEndDateSelector').value = lastDate;

            // é¡¯ç¤ºå ±è¡¨é é¢ä¸¦è¼‰å…¥æ¸¬è©¦è³‡æ–™
            document.getElementById('mainPage').style.display = 'none';
            document.getElementById('settingsPage').classList.remove('active');
            document.getElementById('reportsPage').classList.add('active');
            switchReport('daily');
            loadDailyReportByDateRange();

            // çµ±è¨ˆæŠ˜æ‰£è³‡è¨Š
            const totalOrders = testData.reduce((sum, d) => sum + d.orderCount, 0);
            const discountOrders = testData.reduce((sum, d) => sum + d.orders.filter(o => o.discount > 0).length, 0);

            // çµ±è¨ˆå„ç¨®æŠ˜æ‰£çµ„åˆçš„ä½¿ç”¨æ¬¡æ•¸
            let singleDiscount = 0;
            let doubleDiscount = 0;
            let tripleDiscount = 0;
            let manualDiscountCount = 0;
            let customSpecCount = 0;

            testData.forEach(day => {
                day.orders.forEach(order => {
                    if (order.appliedDiscounts) {
                        if (order.appliedDiscounts.length === 1) {
                            if (order.appliedDiscounts[0].type === 'æ‰‹å‹•æŠ˜æ‰£') {
                                manualDiscountCount++;
                            } else {
                                singleDiscount++;
                            }
                        }
                        else if (order.appliedDiscounts.length === 2) doubleDiscount++;
                        else if (order.appliedDiscounts.length === 3) tripleDiscount++;
                    }

                    // çµ±è¨ˆå«å®¢è£½åŒ–å£å‘³çš„è¨‚å–®
                    const hasCustomSpec = order.items.some(item => item.spicy || item.custom);
                    if (hasCustomSpec) {
                        customSpecCount++;
                    }
                });
            });

            const totalDiscountAmount = testData.reduce((sum, d) => sum + d.totalDiscount, 0);

            alert(`âœ… å·²ç”Ÿæˆ ${testData.length} å¤©çš„æ¸¬è©¦è³‡æ–™ï¼\n\n` +
                `æ—¥æœŸç¯„åœï¼š${testData[0].date} è‡³ ${testData[testData.length - 1].date}\n` +
                `ç¸½è¨‚å–®æ•¸ï¼š${totalOrders} ç­†\n` +
                `æœ‰æŠ˜æ‰£è¨‚å–®ï¼š${discountOrders} ç­† (${Math.round(discountOrders / totalOrders * 100)}%)\n\n` +
                `æŠ˜æ‰£çµ„åˆï¼š\n` +
                `â€¢ å–®ä¸€è‡ªå‹•æŠ˜æ‰£ï¼š${singleDiscount} ç­†\n` +
                `â€¢ é›™é‡è‡ªå‹•æŠ˜æ‰£ï¼š${doubleDiscount} ç­†\n` +
                `â€¢ ä¸‰é‡è‡ªå‹•æŠ˜æ‰£ï¼š${tripleDiscount} ç­†\n` +
                `â€¢ æ‰‹å‹•æŠ˜æ‰£ï¼š${manualDiscountCount} ç­†\n\n` +
                `å®¢è£½åŒ–å£å‘³ï¼š${customSpecCount} ç­†è¨‚å–®ï¼ˆè¾£åº¦/å‚™è¨»ï¼‰\n\n` +
                `ç¸½æŠ˜æ‰£é‡‘é¡ï¼š$${totalDiscountAmount.toLocaleString()}\n\n` +
                `æŠ˜æ‰£è¦å‰‡ï¼š\n` +
                `â€¢ çƒ¤é¦™è‡è²·3ä¸²æŠ˜$5ï¼ˆå–®ä¸€å“é …ï¼‰\n` +
                `â€¢ é›è‚‰é¡è²·3ä¸²æŠ˜$5ï¼ˆåˆ†é¡æŠ˜æ‰£ï¼‰\n` +
                `â€¢ æ»¿5ä»¶æŠ˜$20ï¼ˆç¸½æ•¸é‡æŠ˜æ‰£ï¼‰\n` +
                `â€¢ æœƒå“¡æŠ˜æ‰£ç­‰æ‰‹å‹•æŠ˜æ‰£\n\n` +
                `âœ¨ å ±è¡¨å·²è‡ªå‹•è¼‰å…¥ï¼Œå¯ç«‹å³æŸ¥çœ‹æ¸¬è©¦è³‡æ–™ï¼`);
        }

        // æ¸…é™¤æ¸¬è©¦è³‡æ–™
        function clearTestData() {
            if (confirm('ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰æ¸¬è©¦è³‡æ–™ï¼Ÿ')) {
                // è®€å–æ¸¬è©¦è³‡æ–™çš„æ—¥æœŸåˆ—è¡¨
                const testDates = JSON.parse(localStorage.getItem('testDataDates') || '[]');

                // åˆªé™¤æ‰€æœ‰æ¸¬è©¦æ—¥æœŸçš„è³‡æ–™
                testDates.forEach(date => {
                    localStorage.removeItem(`businessData_${date}`);
                });

                // æ¸…é™¤æ¸¬è©¦æ—¥æœŸè¨˜éŒ„
                localStorage.removeItem('testDataDates');

                // é—œé–‰æ¸¬è©¦æ¨¡å¼
                localStorage.removeItem('testMode');

                alert(`âœ… å·²æ¸…é™¤ ${testDates.length} å¤©çš„æ¸¬è©¦è³‡æ–™ï¼`);
                checkTestMode();
            }
        }

        // æ¸…é™¤æ‰€æœ‰ localStorage è³‡æ–™ï¼ˆç³»çµ±é‡ç½®ï¼‰
        function clearAllLocalStorage() {
            if (confirm('âš ï¸ è­¦å‘Šï¼šæ­¤æ“ä½œå°‡åŸ·è¡Œç³»çµ±é‡ç½®ï¼\n\næœƒæ¸…é™¤ï¼š\nâ€¢ æŠ˜æ‰£è¦å‰‡è¨­å®š\nâ€¢ æ‰€æœ‰ç‡Ÿæ¥­è³‡æ–™\nâ€¢ æ¸¬è©¦è³‡æ–™\nâ€¢ æ‰€æœ‰å…¶ä»–è¨­å®š\n\nç³»çµ±å°‡æ¢å¾©ç‚ºåˆå§‹ç‹€æ…‹ã€‚\n\nç¢ºå®šè¦åŸ·è¡Œç³»çµ±é‡ç½®å—ï¼Ÿ')) {
                // æ¸…é™¤æ‰€æœ‰ localStorage
                localStorage.clear();

                alert('âœ… ç³»çµ±é‡ç½®å®Œæˆï¼\n\nç³»çµ±å°‡é‡æ–°è¼‰å…¥ä¸¦æ¢å¾©ç‚ºåˆå§‹ç‹€æ…‹ã€‚');

                // é‡æ–°è¼‰å…¥é é¢
                location.reload();
            }
        }


        // é¡¯ç¤ºå ±è¡¨é é¢
        function showReports() {
            document.getElementById('mainPage').style.display = 'none';
            document.getElementById('settingsPage').classList.remove('active');
            document.getElementById('reportsPage').classList.add('active');
            // éš±è—åˆ†é¡æ¨™ç±¤
            document.getElementById('categoryTabs').classList.add('hidden');
            // é è¨­é¡¯ç¤ºæ—¥å ±è¡¨
            updateDailyReport();
        }

        // åˆ‡æ›å ±è¡¨é¡å‹
        function switchReport(type) {
            // ç§»é™¤æ‰€æœ‰ active
            document.querySelectorAll('.report-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.report-content').forEach(content => {
                content.classList.remove('active');
            });

            // è¨­å®š active
            document.querySelector(`.report-tab[data-report="${type}"]`).classList.add('active');
            document.getElementById(`${type}Report`).classList.add('active');

            // æ›´æ–°å°æ‡‰å ±è¡¨è³‡æ–™
            if (type === 'daily') {
                // è¨­å®šé è¨­æ—¥æœŸç‚ºç‡Ÿæ¥­æ—¥
                document.getElementById('dailyStartDateSelector').value = businessDate;
                document.getElementById('dailyEndDateSelector').value = businessDate;
                updateDailyReport();
            } else if (type === 'weekly') {
                // è¨­å®šé è¨­é€±ç‚ºæœ¬é€±
                const today = new Date();
                const weekNum = getWeekNumber(today);
                const year = today.getFullYear();
                document.getElementById('weeklyDateSelector').value = `${year}-W${weekNum.toString().padStart(2, '0')}`;
                updateWeeklyReport();
            } else if (type === 'monthly') {
                // è¨­å®šé è¨­æœˆä»½ç‚ºæœ¬æœˆ
                const today = new Date();
                const yearMonth = today.toISOString().slice(0, 7);
                document.getElementById('monthlyDateSelector').value = yearMonth;
                updateMonthlyReport();
            }
        }

        // å–å¾—é€±æ•¸
        function getWeekNumber(date) {
            const d = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));
            const dayNum = d.getUTCDay() || 7;
            d.setUTCDate(d.getUTCDate() + 4 - dayNum);
            const yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));
            return Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
        }

        // æ›´æ–°æ—¥å ±è¡¨
        function updateDailyReport() {
            // é¡¯ç¤ºé—œå¸³åŠŸèƒ½ï¼ˆæŸ¥çœ‹ç•¶å‰ç‡Ÿæ¥­æ—¥æ™‚ï¼‰
            const checkoutSection = document.getElementById('dailyCheckoutSection');
            const checkoutTitle = document.getElementById('checkoutTitle');
            const closeoutButton = document.getElementById('closeoutButton');

            if (checkoutSection) {
                checkoutSection.style.display = 'block';
            }
            if (checkoutTitle) {
                checkoutTitle.textContent = 'ğŸ”’ ç‡Ÿæ¥­æ—¥çµå¸³æ“ä½œ';
            }
            if (closeoutButton) {
                closeoutButton.style.display = 'inline-flex';
            }

            // é‡ç½®æ¨™ç±¤ç‚ºä»Šæ—¥
            document.getElementById('revenueLabel').textContent = 'ä»Šæ—¥ç‡Ÿæ¥­é¡';
            document.getElementById('discountLabel').textContent = 'ä»Šæ—¥ç¸½æŠ˜æ‰£';
            document.getElementById('profitLabel').textContent = 'ä»Šæ—¥åˆ©æ½¤';

            // çµ±è¨ˆå¡ç‰‡
            document.getElementById('todayRevenue').textContent = `$${dailyStats.totalRevenue.toLocaleString()}`;
            document.getElementById('todayOrders').textContent = dailyStats.orderCount;
            document.getElementById('todayDiscount').textContent = `-$${dailyStats.totalDiscount.toLocaleString()}`;

            // ä»Šæ—¥åˆ©æ½¤ = åŸåƒ¹ç‡Ÿæ¥­é¡ - ç¸½æŠ˜æ‰£
            const profit = dailyStats.totalRevenue - dailyStats.totalDiscount;
            document.getElementById('todayProfit').textContent = `$${profit.toLocaleString()}`;

            // åˆ†é¡éŠ·å”®å æ¯”
            const totalCategoryRevenue = Object.values(dailyStats.categorySales).reduce((sum, val) => sum + val, 0) || 1;
            const categoryLabels = {
                beef: 'ğŸ‚ ç‰›è‚‰',
                pork: 'ğŸ– è±¬è‚‰',
                chicken: 'ğŸ” é›è‚‰',
                vegetable: 'ğŸ¥¬ è”¬èœ'
            };

            const categoryStatsEl = document.getElementById('categoryStats');
            categoryStatsEl.innerHTML = '';

            Object.entries(categoryLabels).forEach(([key, label]) => {
                const revenue = dailyStats.categorySales[key] || 0;
                const percentage = (revenue / totalCategoryRevenue) * 100;

                const item = document.createElement('div');
                item.className = 'category-stat-item';
                item.innerHTML = `
                    <div class="category-label">${label}</div>
                    <div class="category-bar-bg">
                        <div class="category-bar-fill" style="width: ${percentage}%"></div>
                    </div>
                    <div class="category-value">$${revenue}</div>
                `;
                categoryStatsEl.appendChild(item);
            });

            // æ™‚æ®µåˆ†å¸ƒ
            const maxHourlyRevenue = Math.max(...Object.values(dailyStats.hourlyData), 1);
            const hourlyBarsEl = document.getElementById('hourlyBars');
            hourlyBarsEl.innerHTML = '';

            for (let hour = 17; hour <= 22; hour++) {
                const revenue = dailyStats.hourlyData[hour.toString()] || 0;
                const percentage = (revenue / maxHourlyRevenue) * 100;

                const bar = document.createElement('div');
                bar.className = 'hourly-bar';
                bar.innerHTML = `
                    <div class="hourly-label">${hour}:00</div>
                    <div class="hourly-bar-bg">
                        <div class="hourly-bar-fill" style="width: ${percentage}%"></div>
                    </div>
                    <div class="hourly-value">$${revenue}</div>
                `;
                hourlyBarsEl.appendChild(bar);
            }

            // ç†±éŠ·å•†å“ TOP 10
            const topItemsListEl = document.getElementById('topItemsList');
            topItemsListEl.innerHTML = '';

            const sortedItems = Object.values(dailyStats.itemSales)
                .sort((a, b) => b.revenue - a.revenue)
                .slice(0, 10);

            if (sortedItems.length === 0) {
                topItemsListEl.innerHTML = '<li style="text-align: center; padding: 20px; color: #636E72;">ä»Šæ—¥å°šç„¡éŠ·å”®è¨˜éŒ„</li>';
            } else {
                sortedItems.forEach((item, index) => {
                    const li = document.createElement('li');
                    li.className = 'top-item';

                    li.innerHTML = `
                        <div class="top-item-rank">${index + 1}</div>
                        <div class="top-item-info">
                            <div class="top-item-name">${item.name}</div>
                            <div class="top-item-qty">${item.quantity} ä»½</div>
                        </div>
                        <div class="top-item-revenue">
                            <div style="font-size: 16px; font-weight: 600; color: #2D3436;">$${item.revenue.toLocaleString()}</div>
                        </div>
                    `;
                    topItemsListEl.appendChild(li);
                });
            }

            // æŠ˜æ‰£æ˜ç´°
            updateDiscountDetails();
        }

        // æ›´æ–°æŠ˜æ‰£æ˜ç´°
        function updateDiscountDetails() {
            const discountDetailsEl = document.getElementById('discountDetails');
            discountDetailsEl.innerHTML = '';

            if (dailyStats.totalDiscount === 0) {
                discountDetailsEl.innerHTML = '<div style="text-align: center; padding: 20px; color: #636E72;">ä»Šæ—¥å°šç„¡æŠ˜æ‰£è¨˜éŒ„</div>';
                return;
            }

            // çµ±è¨ˆå“é …æŠ˜æ‰£ã€è‡ªå‹•æŠ˜æ‰£å’Œæ‰‹å‹•æŠ˜æ‰£
            const discountStats = {};

            if (dailyStats.orders && dailyStats.orders.length > 0) {
                dailyStats.orders.forEach(order => {
                    // æª¢æŸ¥å“é …æŠ˜æ‰£ï¼ˆğŸ’°ï¼‰
                    if (order.items && order.items.length > 0) {
                        order.items.forEach(item => {
                            if (item.discount && item.discount > 0) {
                                const name = `ğŸ’° ${item.name}å“é …æŠ˜æ‰£`;
                                if (!discountStats[name]) {
                                    discountStats[name] = { count: 0, amount: 0, isManual: false, isItem: true };
                                }
                                discountStats[name].count++;
                                discountStats[name].amount += item.discount;
                            }
                        });
                    }

                    // æª¢æŸ¥è‡ªå‹•æŠ˜æ‰£å’Œæ‰‹å‹•æŠ˜æ‰£ï¼ˆä½¿ç”¨ totalDiscount ç¢ºä¿åŒ…å«æ‰€æœ‰æŠ˜æ‰£ï¼‰
                    if (order.totalDiscount > 0) {
                        // æª¢æŸ¥æ‰‹å‹•æŠ˜æ‰£ï¼ˆå„ªå…ˆè™•ç†ï¼‰
                        if (order.manualDiscount > 0) {
                            const name = `âœ‹ ${order.manualDiscountReason || 'æ‰‹å‹•æŠ˜æ‰£'}`;
                            if (!discountStats[name]) {
                                discountStats[name] = { count: 0, amount: 0, isManual: true };
                            }
                            discountStats[name].count++;
                            discountStats[name].amount += order.manualDiscount;
                        }

                        // æª¢æŸ¥è‡ªå‹•æŠ˜æ‰£
                        if (order.appliedDiscounts && order.appliedDiscounts.length > 0) {
                            order.appliedDiscounts.forEach(d => {
                                let name, amount;

                                if (d.name && d.amount) {
                                    // èˆŠæ ¼å¼ï¼ˆæ¸¬è©¦è³‡æ–™ï¼‰
                                    // æ’é™¤æ‰‹å‹•æŠ˜æ‰£
                                    if (d.type === 'æ‰‹å‹•æŠ˜æ‰£') return;
                                    name = d.name;
                                    amount = d.amount;
                                } else if (d.description && d.discount) {
                                    // æ–°æ ¼å¼
                                    name = d.description;
                                    amount = d.discount;
                                }

                                if (name && amount) {
                                    if (!discountStats[name]) {
                                        discountStats[name] = { count: 0, amount: 0, isManual: false };
                                    }
                                    discountStats[name].count++;
                                    discountStats[name].amount += amount;
                                }
                            });
                        } else if (order.manualDiscount === 0 && order.discount > 0) {
                            // æ²’æœ‰è©³ç´°è³‡æ–™ä¸”éæ‰‹å‹•æŠ˜æ‰£çš„ï¼Œæ­¸é¡ç‚ºã€Œå…¶ä»–æŠ˜æ‰£ã€
                            if (!discountStats['å…¶ä»–æŠ˜æ‰£']) {
                                discountStats['å…¶ä»–æŠ˜æ‰£'] = { count: 0, amount: 0, isManual: false };
                            }
                            discountStats['å…¶ä»–æŠ˜æ‰£'].count++;
                            discountStats['å…¶ä»–æŠ˜æ‰£'].amount += order.discount;
                        }
                    }
                });
            }

            const discountList = Object.entries(discountStats)
                .filter(([name, data]) => data.count > 0)
                .map(([name, data]) => ({ name, ...data }))
                .sort((a, b) => b.amount - a.amount);

            if (discountList.length === 0) {
                discountDetailsEl.innerHTML = '<div style="text-align: center; padding: 20px; color: #636E72;">ç„¡æŠ˜æ‰£è¨˜éŒ„</div>';
            } else {
                discountDetailsEl.innerHTML = discountList.map(d => `
                    <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #DFE6E9;">
                        <span style="flex: 1;">${d.name}</span>
                        <span style="color: ${d.isItem ? '#E17055' : d.isManual ? '#D63031' : '#0984E3'}; margin-left: 12px;">ä½¿ç”¨ ${d.count} æ¬¡ï¼ŒæŠ˜ $${d.amount.toLocaleString()}</span>
                    </div>
                `).join('');
            }
        }

        // æ›´æ–°é€±å ±è¡¨
        function updateWeeklyReport() {
            // çµåˆä»Šæ—¥è³‡æ–™è¨ˆç®—é€±çµ±è¨ˆ
            const weekRevenue = dailyStats.totalRevenue + 54320; // æ¨¡æ“¬å‰6å¤©
            const weekOrders = dailyStats.orderCount + 248; // æ¨¡æ“¬å‰6å¤©

            document.getElementById('weekRevenue').textContent = `$${weekRevenue.toLocaleString()}`;
            document.getElementById('weekOrders').textContent = weekOrders;

            const weekAvg = Math.round(weekRevenue / 7);
            document.getElementById('weekAvg').textContent = `$${weekAvg.toLocaleString()}`;

            // 7å¤©è¶¨å‹¢åœ–
            const weekTrendChartEl = document.getElementById('weekTrendChart');
            weekTrendChartEl.innerHTML = '';

            const days = ['é€±ä¸€', 'é€±äºŒ', 'é€±ä¸‰', 'é€±å››', 'é€±äº”', 'é€±å…­', 'é€±æ—¥'];
            const trendData = [7500, 8200, 7800, 8500, 9100, 8800, dailyStats.totalRevenue || 8500];
            const maxTrend = Math.max(...trendData);

            days.forEach((day, index) => {
                const height = (trendData[index] / maxTrend) * 150;

                const bar = document.createElement('div');
                bar.className = 'trend-bar';
                bar.innerHTML = `
                    <div class="trend-bar-value">$${(trendData[index] / 1000).toFixed(1)}k</div>
                    <div class="trend-bar-fill" style="height: ${height}px"></div>
                    <div class="trend-bar-label">${day}</div>
                `;
                weekTrendChartEl.appendChild(bar);
            });
        }

        // æ›´æ–°æœˆå ±è¡¨
        function updateMonthlyReport() {
            // æ¨¡æ“¬æœˆçµ±è¨ˆ
            const monthRevenue = dailyStats.totalRevenue + 245600;
            const monthOrders = dailyStats.orderCount + 1156;

            document.getElementById('monthRevenue').textContent = `$${monthRevenue.toLocaleString()}`;
            document.getElementById('monthOrders').textContent = monthOrders;

            const daysInMonth = new Date(new Date().getFullYear(), new Date().getMonth() + 1, 0).getDate();
            const monthAvg = Math.round(monthRevenue / daysInMonth);
            document.getElementById('monthAvg').textContent = `$${monthAvg.toLocaleString()}`;

            // æœˆåº¦è¶¨å‹¢åœ–ï¼ˆé¡¯ç¤ºå‰15å¤©ï¼‰
            const monthTrendChartEl = document.getElementById('monthTrendChart');
            monthTrendChartEl.innerHTML = '';

            for (let day = 1; day <= 15; day++) {
                const revenue = 7000 + Math.random() * 4000; // æ¨¡æ“¬è³‡æ–™
                const height = (revenue / 12000) * 150;

                const bar = document.createElement('div');
                bar.className = 'trend-bar';
                bar.innerHTML = `
                    <div class="trend-bar-value">$${Math.round(revenue / 1000)}k</div>
                    <div class="trend-bar-fill" style="height: ${height}px"></div>
                    <div class="trend-bar-label">${day}</div>
                `;
                monthTrendChartEl.appendChild(bar);
            }
        }

        // ==================== æ—¥æœŸæŸ¥è©¢åŠŸèƒ½ ====================

        // ä¾æ—¥æœŸå€é–“è¼‰å…¥æ—¥å ±è¡¨
        function loadDailyReportByDateRange() {
            const startDate = document.getElementById('dailyStartDateSelector').value;
            const endDate = document.getElementById('dailyEndDateSelector').value;
            const today = new Date().toISOString().split('T')[0];

            if (!startDate || !endDate) {
                alert('è«‹é¸æ“‡é–‹å§‹æ—¥æœŸå’ŒçµæŸæ—¥æœŸï¼');
                return;
            }

            if (startDate > endDate) {
                alert('é–‹å§‹æ—¥æœŸä¸èƒ½æ™šæ–¼çµæŸæ—¥æœŸï¼');
                return;
            }

            // å¦‚æœæŸ¥è©¢ç•¶å‰ç‡Ÿæ¥­æ—¥ä¸”æ˜¯å–®æ—¥æŸ¥è©¢ï¼Œä½¿ç”¨å³æ™‚è³‡æ–™
            if (startDate === endDate && startDate === businessDate) {
                updateDailyReport();
                return;
            }

            // è¨ˆç®—æ—¥æœŸå€é–“å…§çš„æ‰€æœ‰æ—¥æœŸ
            const dates = [];
            let currentDate = new Date(startDate);
            const endDateObj = new Date(endDate);

            while (currentDate <= endDateObj) {
                dates.push(currentDate.toISOString().split('T')[0]);
                currentDate.setDate(currentDate.getDate() + 1);
            }

            // èšåˆå€é–“å…§çš„æ‰€æœ‰è³‡æ–™
            let aggregatedData = {
                totalRevenue: 0,
                totalDiscount: 0,
                orderCount: 0,
                orders: [],
                hourlyData: { '17': 0, '18': 0, '19': 0, '20': 0, '21': 0, '22': 0, '23': 0 },
                itemSales: {},
                categorySales: { beef: 0, pork: 0, chicken: 0, vegetable: 0, skewer: 0, drink: 0 }
            };

            dates.forEach(date => {
                let dayData;

                if (date === businessDate) {
                    // ç•¶å‰ç‡Ÿæ¥­æ—¥ä½¿ç”¨è¨˜æ†¶é«”ä¸­çš„å³æ™‚è³‡æ–™
                    dayData = dailyStats;
                } else {
                    // å¾ localStorage è®€å–è©²ç‡Ÿæ¥­æ—¥çš„è³‡æ–™
                    const saved = localStorage.getItem(`businessData_${date}`);
                    if (saved) {
                        dayData = JSON.parse(saved);
                    }
                }

                if (dayData) {
                    aggregatedData.totalRevenue += dayData.totalRevenue || 0;
                    aggregatedData.totalDiscount += dayData.totalDiscount || 0;
                    aggregatedData.orderCount += dayData.orderCount || 0;
                    aggregatedData.orders.push(...(dayData.orders || []));

                    // åˆä½µæ™‚æ®µè³‡æ–™
                    Object.keys(aggregatedData.hourlyData).forEach(hour => {
                        aggregatedData.hourlyData[hour] += dayData.hourlyData?.[hour] || 0;
                    });

                    // åˆä½µå•†å“éŠ·å”®
                    Object.entries(dayData.itemSales || {}).forEach(([id, data]) => {
                        if (!aggregatedData.itemSales[id]) {
                            aggregatedData.itemSales[id] = { name: data.name, quantity: 0, revenue: 0, discount: 0 };
                        }
                        aggregatedData.itemSales[id].quantity += data.quantity;
                        aggregatedData.itemSales[id].revenue += data.revenue;
                        aggregatedData.itemSales[id].discount += data.discount || 0;
                    });

                    // åˆä½µåˆ†é¡éŠ·å”®
                    Object.keys(aggregatedData.categorySales).forEach(category => {
                        aggregatedData.categorySales[category] += dayData.categorySales?.[category] || 0;
                    });
                }
            });

            // æ›´æ–°é¡¯ç¤ºæ¨™é¡Œ
            const dateRangeText = startDate === endDate
                ? startDate
                : `${startDate} ~ ${endDate} (${dates.length} å¤©)`;

            // æ›´æ–°å ±è¡¨
            updateDailyReportWithData(aggregatedData, dateRangeText);
        }

        // ç”¨æŒ‡å®šè³‡æ–™æ›´æ–°æ—¥å ±è¡¨
        function updateDailyReportWithData(data, dateRangeText = null) {
            // æ ¹æ“šæ˜¯å¦ç‚ºæ—¥æœŸå€é–“æŸ¥è©¢ä¾†é¡¯ç¤º/éš±è—é—œå¸³æŒ‰éˆ•
            const checkoutSection = document.getElementById('dailyCheckoutSection');
            const checkoutTitle = document.getElementById('checkoutTitle');
            const closeoutButton = document.getElementById('closeoutButton');

            if (checkoutSection) {
                checkoutSection.style.display = 'block'; // å§‹çµ‚é¡¯ç¤ºå€å¡Š
            }

            if (dateRangeText) {
                // æŸ¥è©¢æ­·å²è³‡æ–™æ™‚ï¼šéš±è—é—œå¸³æŒ‰éˆ•ï¼Œæ›´æ–°æ¨™é¡Œ
                if (checkoutTitle) {
                    checkoutTitle.textContent = 'ğŸ“Š è³‡æ–™åŒ¯å‡º';
                }
                if (closeoutButton) {
                    closeoutButton.style.display = 'none'; // éš±è—é—œå¸³æŒ‰éˆ•
                }
            } else {
                // æŸ¥çœ‹ç•¶å‰ç‡Ÿæ¥­æ—¥æ™‚ï¼šé¡¯ç¤ºé—œå¸³æŒ‰éˆ•ï¼Œä¿æŒåŸæ¨™é¡Œ
                if (checkoutTitle) {
                    checkoutTitle.textContent = 'ğŸ”’ ç‡Ÿæ¥­æ—¥çµå¸³æ“ä½œ';
                }
                if (closeoutButton) {
                    closeoutButton.style.display = 'inline-flex'; // é¡¯ç¤ºé—œå¸³æŒ‰éˆ•
                }
            }

            // æ›´æ–°æ¨™ç±¤ï¼ˆå¦‚æœæ˜¯æ—¥æœŸå€é–“æŸ¥è©¢ï¼‰
            if (dateRangeText) {
                document.getElementById('revenueLabel').textContent = `${dateRangeText} ç‡Ÿæ¥­é¡`;
                document.getElementById('discountLabel').textContent = `${dateRangeText} ç¸½æŠ˜æ‰£`;
                document.getElementById('profitLabel').textContent = `${dateRangeText} åˆ©æ½¤`;
            } else {
                document.getElementById('revenueLabel').textContent = 'ä»Šæ—¥ç‡Ÿæ¥­é¡';
                document.getElementById('discountLabel').textContent = 'ä»Šæ—¥ç¸½æŠ˜æ‰£';
                document.getElementById('profitLabel').textContent = 'ä»Šæ—¥åˆ©æ½¤';
            }

            document.getElementById('todayRevenue').textContent = `$${(data.totalRevenue || 0).toLocaleString()}`;
            document.getElementById('todayOrders').textContent = data.orderCount || 0;
            document.getElementById('todayDiscount').textContent = `-$${(data.totalDiscount || 0).toLocaleString()}`;

            const profit = (data.totalRevenue || 0) - (data.totalDiscount || 0);
            document.getElementById('todayProfit').textContent = `$${profit.toLocaleString()}`;

            // åˆ†é¡éŠ·å”®å æ¯”
            const totalCategoryRevenue = Object.values(data.categorySales || {}).reduce((sum, val) => sum + val, 0) || 1;
            const categoryLabels = {
                beef: 'ğŸ‚ ç‰›è‚‰',
                pork: 'ğŸ– è±¬è‚‰',
                chicken: 'ğŸ” é›è‚‰',
                vegetable: 'ğŸ¥¬ è”¬èœ'
            };

            const categoryStatsEl = document.getElementById('categoryStats');
            categoryStatsEl.innerHTML = '';

            Object.entries(data.categorySales || {}).forEach(([category, revenue]) => {
                if (categoryLabels[category]) {
                    const percentage = totalCategoryRevenue > 0 ? Math.round((revenue / totalCategoryRevenue) * 100) : 0;
                    const item = document.createElement('div');
                    item.className = 'category-stat-item';
                    item.innerHTML = `
                        <div class="category-stat-info">
                            <span class="category-stat-name">${categoryLabels[category]}</span>
                            <span class="category-stat-amount">$${revenue.toLocaleString()}</span>
                        </div>
                        <div class="category-stat-bar">
                            <div class="category-stat-fill" style="width: ${percentage}%"></div>
                        </div>
                        <div class="category-stat-percent">${percentage}%</div>
                    `;
                    categoryStatsEl.appendChild(item);
                }
            });

            // æ™‚æ®µåˆ†æ
            const hourlyBarsEl = document.getElementById('hourlyBars');
            if (hourlyBarsEl) {
                hourlyBarsEl.innerHTML = '';

                const maxHourlyRevenue = Math.max(...Object.values(data.hourlyData || {}), 1);
                const hours = ['17', '18', '19', '20', '21', '22'];

                hours.forEach(hour => {
                    const revenue = data.hourlyData?.[hour] || 0;
                    const width = maxHourlyRevenue > 0 ? (revenue / maxHourlyRevenue) * 100 : 0;

                    const bar = document.createElement('div');
                    bar.className = 'hourly-bar';
                    bar.innerHTML = `
                        <div class="hourly-label">${hour}:00</div>
                        <div class="hourly-bar-bg">
                            <div class="hourly-bar-fill" style="width: ${width}%"></div>
                        </div>
                        <div class="hourly-value">$${revenue.toLocaleString()}</div>
                    `;
                    hourlyBarsEl.appendChild(bar);
                });
            }

            // ç†±éŠ·å•†å“ TOP 10
            const topItemsEl = document.getElementById('topItemsList');

            // è™•ç† itemSalesï¼ˆæ”¯æ´å…©ç¨®æ ¼å¼ï¼‰
            let itemsArray = [];
            if (data.itemSales) {
                // æ ¼å¼1: { itemId: { name, quantity, revenue } }
                // æ ¼å¼2: { itemName: { name, quantity, revenue } }
                itemsArray = Object.values(data.itemSales);
            }

            const sortedItems = itemsArray
                .sort((a, b) => b.quantity - a.quantity)
                .slice(0, 10);

            if (topItemsEl) {
                topItemsEl.innerHTML = '';

                if (sortedItems.length === 0 || sortedItems.every(item => item.quantity === 0)) {
                    topItemsEl.innerHTML = '<li style="text-align: center; padding: 20px; color: #636E72;">æš«ç„¡éŠ·å”®è³‡æ–™</li>';
                } else {
                    sortedItems.forEach((item, index) => {
                        if (item.quantity > 0) {
                            const li = document.createElement('li');
                            li.className = 'top-item';
                            li.innerHTML = `
                                <div class="top-item-rank">${index + 1}</div>
                                <div class="top-item-info">
                                    <div class="top-item-name">${item.name}</div>
                                    <div class="top-item-qty">${item.quantity} ä»¶</div>
                                </div>
                                <div class="top-item-revenue">$${item.revenue.toLocaleString()}</div>
                            `;
                            topItemsEl.appendChild(li);
                        }
                    });
                }
            }

            // æŠ˜æ‰£æ˜ç´° - å¾è¨‚å–®ä¸­è¨ˆç®—
            const discountDetailsEl = document.getElementById('discountDetails');

            // çµ±è¨ˆå“é …æŠ˜æ‰£ã€è‡ªå‹•æŠ˜æ‰£å’Œæ‰‹å‹•æŠ˜æ‰£
            const discountStats = {};

            if (data.orders && data.orders.length > 0) {
                data.orders.forEach(order => {
                    // æª¢æŸ¥å“é …æŠ˜æ‰£ï¼ˆğŸ’°ï¼‰
                    if (order.items && order.items.length > 0) {
                        order.items.forEach(item => {
                            if (item.discount && item.discount > 0) {
                                const name = `ğŸ’° ${item.name}å“é …æŠ˜æ‰£`;
                                if (!discountStats[name]) {
                                    discountStats[name] = { count: 0, amount: 0, isManual: false, isItem: true };
                                }
                                discountStats[name].count++;
                                discountStats[name].amount += item.discount;
                            }
                        });
                    }

                    // æª¢æŸ¥è‡ªå‹•æŠ˜æ‰£å’Œæ‰‹å‹•æŠ˜æ‰£ï¼ˆä½¿ç”¨ totalDiscount ç¢ºä¿åŒ…å«æ‰€æœ‰æŠ˜æ‰£ï¼‰
                    if (order.totalDiscount > 0) {
                        // æª¢æŸ¥æ‰‹å‹•æŠ˜æ‰£ï¼ˆå„ªå…ˆè™•ç†ï¼‰
                        if (order.manualDiscount > 0) {
                            const name = `âœ‹ ${order.manualDiscountReason || 'æ‰‹å‹•æŠ˜æ‰£'}`;
                            if (!discountStats[name]) {
                                discountStats[name] = { count: 0, amount: 0, isManual: true };
                            }
                            discountStats[name].count++;
                            discountStats[name].amount += order.manualDiscount;
                        }

                        // æª¢æŸ¥è‡ªå‹•æŠ˜æ‰£
                        if (order.appliedDiscounts && order.appliedDiscounts.length > 0) {
                            order.appliedDiscounts.forEach(d => {
                                let name, amount;

                                if (d.name && d.amount) {
                                    // èˆŠæ ¼å¼ï¼ˆæ¸¬è©¦è³‡æ–™ï¼‰
                                    // æ’é™¤æ‰‹å‹•æŠ˜æ‰£
                                    if (d.type === 'æ‰‹å‹•æŠ˜æ‰£') return;
                                    name = d.name;
                                    amount = d.amount;
                                } else if (d.description && d.discount) {
                                    // æ–°æ ¼å¼
                                    name = d.description;
                                    amount = d.discount;
                                }

                                if (name && amount) {
                                    if (!discountStats[name]) {
                                        discountStats[name] = { count: 0, amount: 0, isManual: false };
                                    }
                                    discountStats[name].count++;
                                    discountStats[name].amount += amount;
                                }
                            });
                        } else if (order.manualDiscount === 0 && order.discount > 0) {
                            // æ²’æœ‰è©³ç´°è³‡æ–™ä¸”éæ‰‹å‹•æŠ˜æ‰£çš„ï¼Œæ­¸é¡ç‚ºã€Œå…¶ä»–æŠ˜æ‰£ã€
                            if (!discountStats['å…¶ä»–æŠ˜æ‰£']) {
                                discountStats['å…¶ä»–æŠ˜æ‰£'] = { count: 0, amount: 0, isManual: false };
                            }
                            discountStats['å…¶ä»–æŠ˜æ‰£'].count++;
                            discountStats['å…¶ä»–æŠ˜æ‰£'].amount += order.discount;
                        }
                    }
                });
            }

            const discountList = Object.entries(discountStats)
                .filter(([name, data]) => data.count > 0)
                .map(([name, data]) => ({ name, ...data }))
                .sort((a, b) => b.amount - a.amount);

            if (discountList.length === 0) {
                discountDetailsEl.innerHTML = '<div style="text-align: center; padding: 20px; color: #636E72;">ç„¡æŠ˜æ‰£è¨˜éŒ„</div>';
            } else {
                discountDetailsEl.innerHTML = discountList.map(d => `
                    <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #DFE6E9;">
                        <span style="flex: 1;">${d.name}</span>
                        <span style="color: ${d.isItem ? '#E17055' : d.isManual ? '#D63031' : '#0984E3'}; margin-left: 12px;">ä½¿ç”¨ ${d.count} æ¬¡ï¼ŒæŠ˜ $${d.amount.toLocaleString()}</span>
                    </div>
                `).join('');
            }
        }

        // è¼‰å…¥ä»Šæ—¥å ±è¡¨
        function loadTodayReport() {
            document.getElementById('dailyStartDateSelector').value = businessDate;
            document.getElementById('dailyEndDateSelector').value = businessDate;
            updateDailyReport();
        }

        // è¼‰å…¥æ˜¨æ—¥å ±è¡¨
        function loadYesterdayReport() {
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            const yesterdayStr = yesterday.toISOString().split('T')[0];
            document.getElementById('dailyStartDateSelector').value = yesterdayStr;
            document.getElementById('dailyEndDateSelector').value = yesterdayStr;
            loadDailyReportByDateRange();
        }

        // ä¾é€±è¼‰å…¥é€±å ±è¡¨
        function loadWeeklyReportByWeek() {
            const selectedWeek = document.getElementById('weeklyDateSelector').value;
            if (!selectedWeek) {
                alert('è«‹é¸æ“‡é€±ï¼');
                return;
            }

            // è§£æé€±æ•¸ (æ ¼å¼: YYYY-Www)
            const [year, weekStr] = selectedWeek.split('-W');
            const weekNum = parseInt(weekStr);

            // è¨ˆç®—è©²é€±çš„æ—¥æœŸç¯„åœ
            const startDate = getWeekStartDate(year, weekNum);
            const endDate = new Date(startDate);
            endDate.setDate(endDate.getDate() + 6);

            // å¾ localStorage è®€å–è©²é€±çš„æ‰€æœ‰è³‡æ–™
            const history = JSON.parse(localStorage.getItem('checkoutHistory') || '[]');
            const weekData = history.filter(h => {
                const date = new Date(h.date);
                return date >= startDate && date <= endDate;
            });

            // è¨ˆç®—è©²é€±ç¸½è¨ˆ
            const weekRevenue = weekData.reduce((sum, d) => sum + (d.totalRevenue || 0), 0);
            const weekOrders = weekData.reduce((sum, d) => sum + (d.orderCount || 0), 0);
            const daysInWeek = weekData.length || 1;

            document.getElementById('weekRevenue').textContent = `$${weekRevenue.toLocaleString()}`;
            document.getElementById('weekOrders').textContent = weekOrders;

            const weekAvg = Math.round(weekRevenue / daysInWeek);
            document.getElementById('weekAvg').textContent = `$${weekAvg.toLocaleString()}`;

            // é€±è¶¨å‹¢åœ–
            const weekTrendChartEl = document.getElementById('weekTrendChart');
            weekTrendChartEl.innerHTML = '';

            for (let i = 0; i < 7; i++) {
                const date = new Date(startDate);
                date.setDate(date.getDate() + i);
                const dateStr = date.toISOString().split('T')[0];
                const dayData = weekData.find(d => d.date === dateStr);
                const revenue = dayData ? dayData.totalRevenue : 0;

                const height = (revenue / 15000) * 150;

                const bar = document.createElement('div');
                bar.className = 'trend-bar';
                bar.innerHTML = `
                    <div class="trend-bar-value">$${Math.round(revenue / 1000)}k</div>
                    <div class="trend-bar-fill" style="height: ${height}px"></div>
                    <div class="trend-bar-label">${date.toLocaleDateString('zh-TW', { weekday: 'short' })}</div>
                `;
                weekTrendChartEl.appendChild(bar);
            }
        }

        // å–å¾—é€±é–‹å§‹æ—¥æœŸï¼ˆé€±ä¸€ï¼‰
        function getWeekStartDate(year, weekNum) {
            const date = new Date(year, 0, 1 + (weekNum - 1) * 7);
            const day = date.getDay();
            const diff = date.getDate() - day + (day === 0 ? -6 : 1);
            return new Date(date.setDate(diff));
        }

        // è¼‰å…¥æœ¬é€±å ±è¡¨
        function loadThisWeekReport() {
            const today = new Date();
            const weekNum = getWeekNumber(today);
            const year = today.getFullYear();
            document.getElementById('weeklyDateSelector').value = `${year}-W${weekNum.toString().padStart(2, '0')}`;
            loadWeeklyReportByWeek();
        }

        // è¼‰å…¥ä¸Šé€±å ±è¡¨
        function loadLastWeekReport() {
            const date = new Date();
            date.setDate(date.getDate() - 7);
            const weekNum = getWeekNumber(date);
            const year = date.getFullYear();
            document.getElementById('weeklyDateSelector').value = `${year}-W${weekNum.toString().padStart(2, '0')}`;
            loadWeeklyReportByWeek();
        }

        // ä¾æœˆä»½è¼‰å…¥æœˆå ±è¡¨
        function loadMonthlyReportByMonth() {
            const selectedMonth = document.getElementById('monthlyDateSelector').value;
            if (!selectedMonth) {
                alert('è«‹é¸æ“‡æœˆä»½ï¼');
                return;
            }

            // å¾ localStorage è®€å–è©²æœˆæ‰€æœ‰è³‡æ–™
            const history = JSON.parse(localStorage.getItem('checkoutHistory') || '[]');
            const monthData = history.filter(h => h.date.startsWith(selectedMonth));

            const monthRevenue = monthData.reduce((sum, d) => sum + (d.totalRevenue || 0), 0);
            const monthOrders = monthData.reduce((sum, d) => sum + (d.orderCount || 0), 0);

            document.getElementById('monthRevenue').textContent = `$${monthRevenue.toLocaleString()}`;
            document.getElementById('monthOrders').textContent = monthOrders;

            // è¨ˆç®—ç•¶æœˆå¤©æ•¸
            const [year, month] = selectedMonth.split('-').map(Number);
            const daysInMonth = new Date(year, month, 0).getDate();
            const daysWithData = monthData.length || 1;
            const monthAvg = Math.round(monthRevenue / daysWithData);
            document.getElementById('monthAvg').textContent = `$${monthAvg.toLocaleString()}`;

            // æœˆåº¦è¶¨å‹¢åœ–
            const monthTrendChartEl = document.getElementById('monthTrendChart');
            monthTrendChartEl.innerHTML = '';

            for (let day = 1; day <= daysInMonth; day++) {
                const dateStr = `${selectedMonth}-${day.toString().padStart(2, '0')}`;
                const dayData = monthData.find(d => d.date === dateStr);
                const revenue = dayData ? dayData.totalRevenue : 0;

                const height = (revenue / 15000) * 150;

                const bar = document.createElement('div');
                bar.className = 'trend-bar';
                bar.innerHTML = `
                    <div class="trend-bar-value">$${Math.round(revenue / 1000)}k</div>
                    <div class="trend-bar-fill" style="height: ${height}px"></div>
                    <div class="trend-bar-label">${day}</div>
                `;
                monthTrendChartEl.appendChild(bar);
            }
        }

        // è¼‰å…¥æœ¬æœˆå ±è¡¨
        function loadThisMonthReport() {
            const today = new Date();
            const yearMonth = today.toISOString().slice(0, 7);
            document.getElementById('monthlyDateSelector').value = yearMonth;
            loadMonthlyReportByMonth();
        }

        // è¼‰å…¥ä¸Šæœˆå ±è¡¨
        function loadLastMonthReport() {
            const date = new Date();
            date.setMonth(date.getMonth() - 1);
            const yearMonth = date.toISOString().slice(0, 7);
            document.getElementById('monthlyDateSelector').value = yearMonth;
            loadMonthlyReportByMonth();
        }

        // è¨ˆç®—æŠ˜æ‰£æ˜ç´°ï¼ˆå¾æ­·å²è¨‚å–®ï¼‰
        function calculateDiscountDetailsFromOrders(orders) {
            const details = [];

            discountRules.forEach(rule => {
                let count = 0;
                let amount = 0;

                orders.forEach(order => {
                    if (rule.type === 'item') {
                        const item = order.items.find(i => i.name === rule.itemName);
                        if (item) {
                            const times = Math.floor(item.quantity / rule.quantity);
                            if (times > 0) {
                                count += times;
                                amount += times * rule.discountAmount;
                            }
                        }
                    } else if (rule.type === 'category') {
                        // ç°¡åŒ–è™•ç†ï¼šå‡è¨­ categorySales å·²ç¶“å­˜åœ¨
                    }
                });

                if (count > 0) {
                    let name = '';
                    if (rule.type === 'item') {
                        name = `${rule.itemName} è²·${rule.quantity}æŠ˜$${rule.discountAmount}`;
                    } else if (rule.type === 'category') {
                        name = `${rule.categoryName} è²·${rule.quantity}æŠ˜$${rule.discountAmount}`;
                    } else if (rule.type === 'total') {
                        name = `æ»¿${rule.quantity}ä»¶æŠ˜$${rule.discountAmount}`;
                    }

                    details.push({ name, count, amount });
                }
            });

            return details;
        }

        // éš±è—å ±è¡¨é é¢
        function hideReports() {
            document.getElementById('mainPage').style.display = 'block';
            document.getElementById('reportsPage').classList.remove('active');
            document.getElementById('settingsPage').classList.remove('active');
            // é¡¯ç¤ºåˆ†é¡æ¨™ç±¤
            document.getElementById('categoryTabs').classList.remove('hidden');
        }

        // é¡¯ç¤ºè¨­å®šé é¢
        function showSettings() {
            document.getElementById('mainPage').style.display = 'none';
            document.getElementById('reportsPage').classList.remove('active');
            document.getElementById('settingsPage').classList.add('active');
            // éš±è—åˆ†é¡æ¨™ç±¤
            document.getElementById('categoryTabs').classList.add('hidden');
            updateDiscountRulesList();

            // æª¢æŸ¥æ˜¯å¦ç‚ºæ¸¬è©¦æ¨¡å¼
            checkTestMode();
        }

        // æª¢æŸ¥æ¸¬è©¦æ¨¡å¼
        function checkTestMode() {
            // æª¢æŸ¥ URL åƒæ•¸æˆ– localStorage
            const urlParams = new URLSearchParams(window.location.search);
            const isTestMode = urlParams.get('test') === 'true' || localStorage.getItem('testMode') === 'true';

            const testDataSection = document.getElementById('testDataSection');
            if (testDataSection) {
                testDataSection.style.display = isTestMode ? 'block' : 'none';
            }
        }

        // å•Ÿç”¨æ¸¬è©¦æ¨¡å¼
        function enableTestMode() {
            localStorage.setItem('testMode', 'true');
            checkTestMode();
            alert('âœ… æ¸¬è©¦æ¨¡å¼å·²å•Ÿç”¨ï¼');
        }

        // ç¦ç”¨æ¸¬è©¦æ¨¡å¼
        function disableTestMode() {
            localStorage.setItem('testMode', 'false');
            checkTestMode();
            alert('âœ… æ¸¬è©¦æ¨¡å¼å·²åœç”¨ï¼');
        }

        // éš±è—è¨­å®šé é¢
        function hideSettings() {
            document.getElementById('settingsPage').classList.remove('active');
            document.getElementById('reportsPage').classList.remove('active');
            document.getElementById('mainPage').style.display = 'block';
            // é¡¯ç¤ºåˆ†é¡æ¨™ç±¤
            document.getElementById('categoryTabs').classList.remove('hidden');
        }

        // æ›´æ–°æŠ˜æ‰£è¦å‰‡åˆ—è¡¨
        function updateDiscountRulesList() {
            const listContainer = document.getElementById('discountRulesList');
            listContainer.innerHTML = '';

            if (discountRules.length === 0) {
                listContainer.innerHTML = `
                    <div class="empty-rules">
                        <div class="empty-rules-icon">ğŸ·ï¸</div>
                        <p>å°šæœªè¨­å®šæŠ˜æ‰£è¦å‰‡</p>
                        <p style="font-size: 14px; margin-top: 8px;">é»æ“Šä¸‹æ–¹æŒ‰éˆ•æ–°å¢å„ªæƒ è¦å‰‡</p>
                    </div>
                `;
                return;
            }

            discountRules.forEach(rule => {
                const ruleCard = document.createElement('div');
                ruleCard.className = 'discount-rule-card';

                let title, desc, typeBadge;

                if (rule.type === 'item') {
                    typeBadge = '<span class="badge badge-item">å–®ä¸€å“é …</span>';
                    title = rule.itemName;
                    desc = `è²· ${rule.quantity} ä¸² æŠ˜ $${rule.discountAmount}`;
                } else if (rule.type === 'category') {
                    typeBadge = '<span class="badge badge-category">åˆ†é¡æŠ˜æ‰£</span>';
                    title = `${categoryNames[rule.categoryId]}é¡`;
                    desc = `è²· ${rule.quantity} ä¸² æŠ˜ $${rule.discountAmount}`;
                } else if (rule.type === 'total') {
                    typeBadge = '<span class="badge badge-total">ç¸½æ•¸é‡</span>';
                    title = 'å…¨é¤¨å•†å“';
                    desc = `è²· ${rule.quantity} ä¸² æŠ˜ $${rule.discountAmount}`;
                }

                ruleCard.innerHTML = `
                    <div class="discount-rule-info">
                        <div class="discount-rule-title">${typeBadge} ${title}</div>
                        <div class="discount-rule-desc">${desc}</div>
                    </div>
                    <div class="discount-rule-actions">
                        <button class="discount-rule-btn btn-edit" onclick="editDiscountRule(${rule.id})">ç·¨è¼¯</button>
                        <button class="discount-rule-btn btn-delete" onclick="deleteDiscountRule(${rule.id})">åˆªé™¤</button>
                    </div>
                `;
                listContainer.appendChild(ruleCard);
            });
        }

        // é¡¯ç¤ºæ–°å¢æŠ˜æ‰£è¦å‰‡å½ˆçª—
        function showAddDiscountModal() {
            editingDiscountId = null;
            document.getElementById('discountModalTitle').textContent = 'æ–°å¢æŠ˜æ‰£è¦å‰‡';

            // å¡«å……å“é …é¸é …
            const itemSelect = document.getElementById('discountItem');
            itemSelect.innerHTML = menuItems.map(item =>
                `<option value="${item.id}">${item.name} - $${item.price}</option>`
            ).join('');

            // é‡è¨­è¡¨å–®
            document.getElementById('discountType').value = 'item';
            document.getElementById('discountQuantity').value = 3;
            document.getElementById('discountAmount').value = 5;
            onDiscountTypeChange();
            updateDiscountPreview();

            document.getElementById('discountModal').classList.add('active');
        }

        // æŠ˜æ‰£é¡å‹è®Šæ›´è™•ç†
        function onDiscountTypeChange() {
            const type = document.getElementById('discountType').value;
            const desc = discountTypes[type].desc;

            document.getElementById('discountTypeDesc').textContent = desc;

            // é¡¯ç¤º/éš±è—å°æ‡‰çš„é¸æ“‡å™¨
            document.getElementById('itemSelectGroup').style.display = type === 'item' ? 'block' : 'none';
            document.getElementById('categorySelectGroup').style.display = type === 'category' ? 'block' : 'none';

            updateDiscountPreview();
        }

        // ç·¨è¼¯æŠ˜æ‰£è¦å‰‡
        function editDiscountRule(id) {
            const rule = discountRules.find(r => r.id === id);
            if (!rule) return;

            editingDiscountId = id;
            document.getElementById('discountModalTitle').textContent = 'ç·¨è¼¯æŠ˜æ‰£è¦å‰‡';

            // è¨­å®šæŠ˜æ‰£é¡å‹
            document.getElementById('discountType').value = rule.type;
            onDiscountTypeChange();

            // å¡«å……å“é …é¸é …
            const itemSelect = document.getElementById('discountItem');
            itemSelect.innerHTML = menuItems.map(item =>
                `<option value="${item.id}">${item.name} - $${item.price}</option>`
            ).join('');

            // æ ¹æ“šé¡å‹è¨­å®šå€¼
            if (rule.type === 'item') {
                itemSelect.value = rule.itemId;
            } else if (rule.type === 'category') {
                document.getElementById('discountCategory').value = rule.categoryId;
            }

            document.getElementById('discountQuantity').value = rule.quantity;
            document.getElementById('discountAmount').value = rule.discountAmount;
            updateDiscountPreview();

            document.getElementById('discountModal').classList.add('active');
        }

        // åˆªé™¤æŠ˜æ‰£è¦å‰‡
        function deleteDiscountRule(id) {
            if (confirm('ç¢ºå®šè¦åˆªé™¤é€™å€‹æŠ˜æ‰£è¦å‰‡å—ï¼Ÿ')) {
                discountRules = discountRules.filter(r => r.id !== id);
                updateDiscountRulesList();
                updateCart(); // æ›´æ–°è³¼ç‰©è»Šä»¥åæ˜ æŠ˜æ‰£è®ŠåŒ–
            }
        }

        // éš±è—æŠ˜æ‰£è¦å‰‡å½ˆçª—
        function hideDiscountModal() {
            document.getElementById('discountModal').classList.remove('active');
        }

        // æ›´æ–°æŠ˜æ‰£é è¦½
        function updateDiscountPreview() {
            const type = document.getElementById('discountType').value;
            const quantity = parseInt(document.getElementById('discountQuantity').value) || 3;
            const discountAmount = parseInt(document.getElementById('discountAmount').value) || 5;

            let previewText = '';

            if (type === 'item') {
                const itemId = parseInt(document.getElementById('discountItem').value);
                const item = menuItems.find(i => i.id === itemId);
                const itemName = item ? item.name : 'å•†å“';
                previewText = `${itemName} è²·${quantity}ä¸² æŠ˜$${discountAmount}`;
            } else if (type === 'category') {
                const categoryId = document.getElementById('discountCategory').value;
                const categoryName = categoryNames[categoryId];
                previewText = `${categoryName}é¡ è²·${quantity}ä¸² æŠ˜$${discountAmount}`;
            } else if (type === 'total') {
                previewText = `å…¨é¤¨å•†å“ è²·${quantity}ä¸² æŠ˜$${discountAmount}`;
            }

            document.getElementById('discountPreviewText').textContent = previewText;
        }

        // å„²å­˜æŠ˜æ‰£è¦å‰‡
        function saveDiscountRule() {
            const type = document.getElementById('discountType').value;
            const quantity = parseInt(document.getElementById('discountQuantity').value);
            const discountAmount = parseInt(document.getElementById('discountAmount').value);

            if (!quantity || quantity < 1) {
                alert('è«‹è¼¸å…¥æœ‰æ•ˆçš„è³¼è²·æ•¸é‡');
                return;
            }

            if (!discountAmount || discountAmount < 1) {
                alert('è«‹è¼¸å…¥æœ‰æ•ˆçš„æŠ˜æ‰£é‡‘é¡');
                return;
            }

            let ruleData = {
                type: type,
                quantity: quantity,
                discountAmount: discountAmount
            };

            // æ ¹æ“šé¡å‹è¨­å®šç‰¹å®šè³‡æ–™
            if (type === 'item') {
                const itemId = parseInt(document.getElementById('discountItem').value);
                const item = menuItems.find(i => i.id === itemId);
                ruleData.itemId = itemId;
                ruleData.itemName = item.name;
            } else if (type === 'category') {
                ruleData.categoryId = document.getElementById('discountCategory').value;
            }

            if (editingDiscountId) {
                // ç·¨è¼¯ç¾æœ‰è¦å‰‡
                const rule = discountRules.find(r => r.id === editingDiscountId);
                if (rule) {
                    Object.assign(rule, ruleData);
                }
            } else {
                // æ–°å¢è¦å‰‡
                const newId = Math.max(...discountRules.map(r => r.id), 0) + 1;
                discountRules.push({
                    id: newId,
                    ...ruleData
                });
            }

            hideDiscountModal();
            updateDiscountRulesList();
            updateCart();
        }

        // é˜²æ­¢è§¸æ§ç¸®æ”¾å’Œæ‰‹å‹¢æ“ä½œ
        document.addEventListener('touchstart', function(event) {
            if (event.touches.length > 1) {
                // é˜²æ­¢å¤šæŒ‡è§¸æ§ç¸®æ”¾
                event.preventDefault();
            }
        }, { passive: false });

        let lastTouchEnd = 0;
        document.addEventListener('touchend', function(event) {
            const now = Date.now();
            if (now - lastTouchEnd <= 300) {
                // é˜²æ­¢é›™æ“Šç¸®æ”¾
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, false);

        // é˜²æ­¢æ‰‹å‹¢ç¸®æ”¾
        document.addEventListener('gesturestart', function(event) {
            event.preventDefault();
        });

        // å„ªåŒ–æ‰€æœ‰è§¸æ§æŒ‰éˆ•çš„éŸ¿æ‡‰
        document.addEventListener('DOMContentLoaded', () => {
            // å„ªåŒ–å¿«é€Ÿé‡‘é¡æŒ‰éˆ•
            const quickAmountBtns = document.querySelectorAll('.quick-amount-btn');

            quickAmountBtns.forEach(btn => {
                // ä½¿ç”¨ touchstart äº‹ä»¶ä¾†æ¶ˆé™¤ 300ms å»¶é²
                btn.addEventListener('touchstart', function(e) {
                    e.preventDefault(); // é˜²æ­¢è§¸ç™¼å¾ŒçºŒçš„ click äº‹ä»¶

                    // æ·»åŠ æŒ‰ä¸‹è¦–è¦ºæ•ˆæœ
                    this.classList.add('pressed');

                    // ä½¿ç”¨ vibration API æä¾›è§¸è¦ºå›é¥‹ï¼ˆå¦‚æœæ”¯æ´ï¼‰
                    if (navigator.vibrate) {
                        navigator.vibrate(10); // è¼•å¾®éœ‡å‹• 10ms
                    }

                    // å–å¾— onclick å±¬æ€§ä¸­çš„å‡½æ•¸åç¨±å’Œåƒæ•¸
                    const onclickValue = this.getAttribute('onclick');
                    if (onclickValue) {
                        // è§£æä¸¦åŸ·è¡Œå‡½æ•¸
                        // ä¾‹å¦‚ï¼šaddAmount(100) -> åŸ·è¡Œ addAmount(100)
                        const match = onclickValue.match(/(\w+)\(([^)]*)\)/);
                        if (match) {
                            const funcName = match[1];
                            const args = match[2] ? match[2].split(',').map(arg => {
                                arg = arg.trim();
                                // ç§»é™¤å¼•è™Ÿï¼ˆå­—ä¸²åƒæ•¸ï¼‰
                                if ((arg.startsWith("'") && arg.endsWith("'")) ||
                                    (arg.startsWith('"') && arg.endsWith('"'))) {
                                    return arg.slice(1, -1);
                                }
                                // æ•¸å­—åƒæ•¸
                                return isNaN(arg) ? arg : parseInt(arg);
                            }) : [];

                            // åŸ·è¡Œå°æ‡‰çš„å‡½æ•¸
                            if (typeof window[funcName] === 'function') {
                                window[funcName](...args);
                            }
                        }
                    }
                }, { passive: false });

                // ç§»é™¤æŒ‰ä¸‹ç‹€æ…‹
                btn.addEventListener('touchend', function(e) {
                    e.preventDefault();
                    this.classList.remove('pressed');
                }, { passive: false });

                // å¦‚æœè§¸æ§å–æ¶ˆï¼Œä¹Ÿè¦ç§»é™¤æŒ‰ä¸‹ç‹€æ…‹
                btn.addEventListener('touchcancel', function(e) {
                    this.classList.remove('pressed');
                });
            });

            // ä½¿ç”¨äº‹ä»¶å§”æ´¾ä¾†å„ªåŒ–è³¼ç‰©è»ŠæŒ‰éˆ•
            const cartItemsContainer = document.getElementById('cartItems');

            cartItemsContainer.addEventListener('touchstart', function(e) {
                const quantityBtn = e.target.closest('.quantity-btn');
                const deleteBtn = e.target.closest('.delete-btn');

                if (quantityBtn) {
                    e.preventDefault();
                    quantityBtn.classList.add('pressed');

                    // è§¸è¦ºå›é¥‹
                    if (navigator.vibrate) {
                        navigator.vibrate(10);
                    }

                    // å–å¾— onclick ä¸­çš„å‡½æ•¸å’Œåƒæ•¸
                    const onclickValue = quantityBtn.getAttribute('onclick');
                    if (onclickValue) {
                        const match = onclickValue.match(/(\w+)\(([^)]*)\)/);
                        if (match) {
                            const funcName = match[1];
                            const args = match[2] ? match[2].split(',').map(arg => {
                                arg = arg.trim();
                                if ((arg.startsWith("'") && arg.endsWith("'")) ||
                                    (arg.startsWith('"') && arg.endsWith('"'))) {
                                    return arg.slice(1, -1);
                                }
                                return isNaN(arg) ? arg : parseInt(arg);
                            }) : [];

                            if (typeof window[funcName] === 'function') {
                                window[funcName](...args);
                            }
                        }
                    }
                } else if (deleteBtn) {
                    e.preventDefault();
                    deleteBtn.classList.add('pressed');

                    // è§¸è¦ºå›é¥‹
                    if (navigator.vibrate) {
                        navigator.vibrate(10);
                    }

                    // å–å¾— onclick ä¸­çš„å‡½æ•¸å’Œåƒæ•¸
                    const onclickValue = deleteBtn.getAttribute('onclick');
                    if (onclickValue) {
                        const match = onclickValue.match(/(\w+)\(([^)]*)\)/);
                        if (match) {
                            const funcName = match[1];
                            const args = match[2] ? match[2].split(',').map(arg => {
                                arg = arg.trim();
                                if ((arg.startsWith("'") && arg.endsWith("'")) ||
                                    (arg.startsWith('"') && arg.endsWith('"'))) {
                                    return arg.slice(1, -1);
                                }
                                return isNaN(arg) ? arg : parseInt(arg);
                            }) : [];

                            if (typeof window[funcName] === 'function') {
                                window[funcName](...args);
                            }
                        }
                    }
                }
            }, { passive: false });

            cartItemsContainer.addEventListener('touchend', function(e) {
                const quantityBtn = e.target.closest('.quantity-btn');
                const deleteBtn = e.target.closest('.delete-btn');

                if (quantityBtn) {
                    e.preventDefault();
                    quantityBtn.classList.remove('pressed');
                } else if (deleteBtn) {
                    e.preventDefault();
                    deleteBtn.classList.remove('pressed');
                }
            }, { passive: false });

            cartItemsContainer.addEventListener('touchcancel', function(e) {
                const quantityBtn = e.target.closest('.quantity-btn');
                const deleteBtn = e.target.closest('.delete-btn');

                if (quantityBtn) {
                    quantityBtn.classList.remove('pressed');
                } else if (deleteBtn) {
                    deleteBtn.classList.remove('pressed');
                }
            });

            // å„ªåŒ–å¿«é€ŸæŠ˜æ‰£æŒ‰éˆ•ï¼ˆè¨­å®šæŠ˜æ‰£ï¼Œéç´¯åŠ ï¼‰
            const quickDiscountBtns = document.querySelectorAll('.quick-discount-btn');
            quickDiscountBtns.forEach(btn => {
                btn.addEventListener('touchstart', function(e) {
                    e.preventDefault();
                    this.classList.add('pressed');

                    if (navigator.vibrate) {
                        navigator.vibrate(10);
                    }

                    const onclickValue = this.getAttribute('onclick');
                    if (onclickValue) {
                        const match = onclickValue.match(/(\w+)\((\d+)\)/);
                        if (match) {
                            const funcName = match[1];
                            const amount = parseInt(match[2]);
                            if (typeof window[funcName] === 'function') {
                                window[funcName](amount);
                            }
                        }
                    }
                }, { passive: false });

                btn.addEventListener('touchend', function(e) {
                    e.preventDefault();
                    this.classList.remove('pressed');
                }, { passive: false });

                btn.addEventListener('touchcancel', function(e) {
                    this.classList.remove('pressed');
                });
            });

            // å„ªåŒ–ç™¾åˆ†æ¯”æŠ˜æ‰£æŒ‰éˆ•ï¼ˆè¨­å®šæŠ˜æ‰£ï¼Œéç´¯åŠ ï¼‰
            const percentageBtns = document.querySelectorAll('.percentage-btn');
            percentageBtns.forEach(btn => {
                btn.addEventListener('touchstart', function(e) {
                    e.preventDefault();
                    this.classList.add('pressed');

                    if (navigator.vibrate) {
                        navigator.vibrate(10);
                    }

                    const onclickValue = this.getAttribute('onclick');
                    if (onclickValue) {
                        const match = onclickValue.match(/(\w+)\((\d+)\)/);
                        if (match) {
                            const funcName = match[1];
                            const percentage = parseInt(match[2]);
                            if (typeof window[funcName] === 'function') {
                                window[funcName](percentage);
                            }
                        }
                    }
                }, { passive: false });

                btn.addEventListener('touchend', function(e) {
                    e.preventDefault();
                    this.classList.remove('pressed');
                }, { passive: false });

                btn.addEventListener('touchcancel', function(e) {
                    this.classList.remove('pressed');
                });
            });
        });

        // ç›£è½è¼¸å…¥è®ŠåŒ–ä»¥æ›´æ–°é è¦½
        document.addEventListener('DOMContentLoaded', () => {
            const inputs = ['discountItem', 'discountQuantity', 'discountAmount'];
            inputs.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('change', updateDiscountPreview);
                    element.addEventListener('input', updateDiscountPreview);
                }
            });
        });

        // ========== è¦æ ¼é¸æ“‡åŠŸèƒ½ ==========

        // ç›®å‰æ­£åœ¨ç·¨è¼¯çš„å“é …ç´¢å¼•ï¼ˆç”¨æ–¼çµå¸³æ™‚ç·¨è¼¯è¦æ ¼ï¼‰- å·²ç§»è‡³ appState.ui.currentEditIndex

        // ç·¨è¼¯å“é …è¦æ ¼ï¼ˆå¾çµå¸³è¦–çª—ï¼‰
        function editItemSpec(itemIndex) {
            const item = cart[itemIndex];
            if (!item) return;

            currentEditIndex = itemIndex;
            currentItem = item;

            // è¨­å®šç•¶å‰è¦æ ¼
            currentSpecQty = item.quantity;
            currentSpecSpicy = item.spicy || 'ä¸è¾£';
            currentSpecPepper = item.pepper || '';
            currentSpecSauce = item.sauce || '';
            currentSpecCustom = item.custom ? item.custom.split(', ') : [];

            document.getElementById('specItemName').textContent = item.name;
            document.getElementById('specItemPrice').textContent = `$${item.price}`;
            document.getElementById('specQtyDisplay').textContent = currentSpecQty;

            // è¨­å®šè¾£åº¦æŒ‰éˆ•
            document.querySelectorAll('.spec-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.spicy === currentSpecSpicy) {
                    btn.classList.add('active');
                }
            });

            // è¨­å®šèƒ¡æ¤’æŒ‰éˆ•
            document.querySelectorAll('.pepper-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.pepper === currentSpecPepper) {
                    btn.classList.add('active');
                }
            });

            // è¨­å®šé†¬æŒ‰éˆ•
            document.querySelectorAll('.sauce-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.sauce === currentSpecSauce) {
                    btn.classList.add('active');
                }
            });

            // é‡è¨­ä¸¦å‹¾é¸å‚™è¨» checkbox
            document.querySelectorAll('.spec-checkboxes input').forEach(cb => {
                cb.checked = currentSpecCustom.includes(cb.value);
            });

            // æ¸…ç©ºè‡ªè¨‚è¼¸å…¥
            document.getElementById('specCustomInput').value = '';

            // æ ¹æ“šåˆ†é¡é¡¯ç¤º/éš±è—è¾£åº¦ã€å†°å¡Šé¸é …å’Œèª¿å‘³é¸é …
            const spicySection = document.querySelector('.spicy-section');
            const drinkOptions = document.querySelector('.drink-options');
            const sugarOptions = document.getElementById('sugarOptions');
            const seasoningOptions = document.querySelector('.seasoning-options');

            if (item.category === 'drink') {
                // é£²æ–™é¡ï¼šéš±è—è¾£åº¦å’Œèª¿å‘³é¸é …ï¼Œé¡¯ç¤ºå†°å¡Šå’Œç”œåº¦é¸é …
                spicySection.style.display = 'none';
                drinkOptions.style.display = 'block';
                sugarOptions.style.display = 'block';
                seasoningOptions.style.display = 'none';
            } else {
                // å…¶ä»–åˆ†é¡ï¼šé¡¯ç¤ºè¾£åº¦å’Œèª¿å‘³é¸é …ï¼Œéš±è—å†°å¡Šå’Œç”œåº¦é¸é …
                spicySection.style.display = 'block';
                drinkOptions.style.display = 'none';
                sugarOptions.style.display = 'none';
                seasoningOptions.style.display = 'block';
            }

            document.getElementById('specModal').classList.add('active');
        }

        // éš±è—è¦æ ¼é¸æ“‡å°è©±æ¡†
        function hideSpecModal() {
            document.getElementById('specModal').classList.remove('active');
            currentItem = null;
        }

        // é¸æ“‡è¾£åº¦
        function selectSpicy(spicy) {
            currentSpecSpicy = spicy;

            // ç«‹å³æ›´æ–°æŒ‰éˆ•ç‹€æ…‹ï¼ˆç„¡å»¶é²ï¼‰
            document.querySelectorAll('#specModal .spec-btn[data-spicy]').forEach(btn => {
                btn.classList.remove('active');
            });

            // è¨­å®šç•¶å‰é¸æ“‡çš„è¾£åº¦æŒ‰éˆ•ç‚º active
            const spicyBtn = document.querySelector(`#specModal .spec-btn[data-spicy="${spicy}"]`);
            if (spicyBtn) spicyBtn.classList.add('active');
        }

        // é£²æ–™æº«åº¦é¸æ“‡
        function selectDrinkTemp(temp) {
            currentDrinkTemp = temp;

            // ç«‹å³æ›´æ–°æŒ‰éˆ•ç‹€æ…‹ï¼ˆç„¡å»¶é²ï¼‰
            document.querySelectorAll('.temp-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`.temp-btn[data-temp="${temp}"]`).classList.add('active');

            // é¡¯ç¤º/éš±è—å†°å¡Šé¸é …
            const iceOptions = document.getElementById('iceOptions');
            if (temp === 'å†°') {
                iceOptions.style.display = 'block';
            } else {
                iceOptions.style.display = 'none';
                currentIceLevel = 'æ­£å¸¸å†°'; // é‡è¨­å†°å¡Šé¸é …
            }

            // æ›´æ–°å®¢è£½åŒ–å‚™è¨»ï¼ˆè¼•é‡æ“ä½œï¼Œç„¡éœ€å»¶é²ï¼‰
            updateDrinkCustomNotes();
        }

        function selectIceLevel(level) {
            currentIceLevel = level;

            // ç«‹å³æ›´æ–°æŒ‰éˆ•ç‹€æ…‹ï¼ˆç„¡å»¶é²ï¼‰
            document.querySelectorAll('.ice-level-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`.ice-level-btn[data-ice="${level}"]`).classList.add('active');

            // æ›´æ–°å®¢è£½åŒ–å‚™è¨»ï¼ˆè¼•é‡æ“ä½œï¼Œç„¡éœ€å»¶é²ï¼‰
            updateDrinkCustomNotes();
        }

        function selectSugarLevel(sugar) {
            currentSugarLevel = sugar;

            // ç«‹å³æ›´æ–°æŒ‰éˆ•ç‹€æ…‹ï¼ˆç„¡å»¶é²ï¼‰
            document.querySelectorAll('.sugar-level-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`.sugar-level-btn[data-sugar="${sugar}"]`).classList.add('active');

            // æ›´æ–°å®¢è£½åŒ–å‚™è¨»ï¼ˆè¼•é‡æ“ä½œï¼Œç„¡éœ€å»¶é²ï¼‰
            updateDrinkCustomNotes();
        }

        // é¸æ“‡èƒ¡æ¤’
        function selectPepper(pepper) {
            currentSpecPepper = pepper;
            // ç«‹å³æ›´æ–°æŒ‰éˆ•ç‹€æ…‹ï¼ˆç„¡å»¶é²ï¼‰
            document.querySelectorAll('.pepper-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            const pepperBtn = document.querySelector(`.pepper-btn[data-pepper="${pepper}"]`);
            if (pepperBtn) pepperBtn.classList.add('active');
        }

        // é¸æ“‡é†¬
        function selectSauce(sauce) {
            currentSpecSauce = sauce;
            // ç«‹å³æ›´æ–°æŒ‰éˆ•ç‹€æ…‹ï¼ˆç„¡å»¶é²ï¼‰
            document.querySelectorAll('.sauce-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            const sauceBtn = document.querySelector(`.sauce-btn[data-sauce="${sauce}"]`);
            if (sauceBtn) sauceBtn.classList.add('active');
        }

        // é¸æ“‡çµ±ä¸€èƒ¡æ¤’
        function selectUnifiedPepper(pepper) {
            unifiedSpec.pepper = pepper;
            // ç«‹å³æ›´æ–°æŒ‰éˆ•ç‹€æ…‹ï¼ˆç„¡å»¶é²ï¼‰
            document.querySelectorAll('.unified-pepper-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            const pepperBtn = document.querySelector(`.unified-pepper-btn[data-pepper="${pepper}"]`);
            if (pepperBtn) pepperBtn.classList.add('active');
            // å»¶é²å¥—ç”¨åˆ°è³¼ç‰©è»Šï¼ˆä½¿ç”¨ requestAnimationFrameï¼‰
            applyUnifiedSpec();
        }

        // é¸æ“‡çµ±ä¸€é†¬
        function selectUnifiedSauce(sauce) {
            unifiedSpec.sauce = sauce;
            // ç«‹å³æ›´æ–°æŒ‰éˆ•ç‹€æ…‹ï¼ˆç„¡å»¶é²ï¼‰
            document.querySelectorAll('.unified-sauce-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            const sauceBtn = document.querySelector(`.unified-sauce-btn[data-sauce="${sauce}"]`);
            if (sauceBtn) sauceBtn.classList.add('active');
            // å»¶é²å¥—ç”¨åˆ°è³¼ç‰©è»Šï¼ˆä½¿ç”¨ requestAnimationFrameï¼‰
            applyUnifiedSpec();
        }

        // æ›´æ–°é£²æ–™å®¢è£½åŒ–å‚™è¨»
        function updateDrinkCustomNotes() {
            currentSpecCustom = [];

            // æ·»åŠ æº«åº¦
            if (currentDrinkTemp === 'ç†±') {
                currentSpecCustom.push('ç†±');
            } else {
                // å†°çš„è©±æ·»åŠ å†°å¡Šé¸é …
                if (currentIceLevel !== 'æ­£å¸¸å†°') {
                    currentSpecCustom.push(currentIceLevel);
                }
            }

            // æ·»åŠ ç”œåº¦ï¼ˆå¦‚æœä¸æ˜¯å…¨ç³–ï¼‰
            if (currentSugarLevel !== 'å…¨ç³–') {
                currentSpecCustom.push(currentSugarLevel);
            }

            // æ·»åŠ è‡ªè¨‚è¼¸å…¥
            const customInput = document.getElementById('specCustomInput').value.trim();
            if (customInput) {
                currentSpecCustom.push(customInput);
            }
        }

        // æ›´æ–°å®¢è£½åŒ–å‚™è¨»ï¼ˆéé£²æ–™é¡ï¼‰
        function updateCustomNotes() {
            currentSpecCustom = [];

            // æ”¶é›†è¾£åº¦é¸é …
            if (currentSpecSpicy && currentSpecSpicy !== 'ä¸è¾£') {
                currentSpecCustom.push(currentSpecSpicy);
            }

            // æ”¶é›†èƒ¡æ¤’/é†¬é¸é …
            if (currentSpecPepper) {
                currentSpecCustom.push(currentSpecPepper);
            }
            if (currentSpecSauce) {
                currentSpecCustom.push(currentSpecSauce);
            }

            // ç²å–è‡ªè¨‚è¼¸å…¥
            const customInput = document.getElementById('specCustomInput').value.trim();
            if (customInput) {
                currentSpecCustom.push(customInput);
            }
        }

        // èª¿æ•´è¦æ ¼æ•¸é‡
        function adjustSpecQty(delta) {
            currentSpecQty = Math.max(1, currentSpecQty + delta);
            document.getElementById('specQtyDisplay').textContent = currentSpecQty;
        }

        // ========== å“é …æŠ˜æ‰£åŠŸèƒ½ ==========

        // å¥—ç”¨å“é …å¿«é€ŸæŠ˜æ‰£
        function applyItemDiscount(amount) {
            const maxDiscount = currentItem.price * currentSpecQty;  // æœ€å¤§å¯æŠ˜æ‰£é‡‘é¡ç‚ºå“é …ç¸½åƒ¹
            currentItemDiscount = Math.min(amount, maxDiscount);
            updateItemDiscountDisplay();
        }

        // å¥—ç”¨å“é …è‡ªè¨‚æŠ˜æ‰£
        function applyCustomItemDiscount() {
            const input = document.getElementById('itemDiscountInput');
            const amount = parseFloat(input.value);
            if (!isNaN(amount) && amount > 0) {
                const maxDiscount = currentItem.price * currentSpecQty;
                currentItemDiscount = Math.min(amount, maxDiscount);
                input.value = '';
                updateItemDiscountDisplay();
            }
        }

        // æ¸…é™¤å“é …æŠ˜æ‰£
        function clearItemDiscount() {
            currentItemDiscount = 0;
            document.getElementById('itemDiscountInput').value = '';
            updateItemDiscountDisplay();
        }

        // æ›´æ–°å“é …æŠ˜æ‰£é¡¯ç¤º
        function updateItemDiscountDisplay() {
            const display = document.getElementById('itemDiscountDisplay');
            const amountSpan = document.getElementById('itemDiscountAmount');

            if (currentItemDiscount > 0) {
                display.style.display = 'block';
                amountSpan.textContent = currentItemDiscount;
            } else {
                display.style.display = 'none';
            }
        }

        // ç¢ºèªè¦æ ¼ä¸¦åŠ å…¥è³¼ç‰©è»Š
        function confirmSpec() {
            if (!currentItem) return;

            let allCustomNotes = [];

            // æ ¹æ“šå“é …é¡åˆ¥ç²å–å®¢è£½åŒ–å‚™è¨»
            if (currentItem.category === 'drink') {
                // é£²æ–™é¡ï¼šä½¿ç”¨é£²æ–™å®¢è£½é¸é …
                updateDrinkCustomNotes();
                allCustomNotes = [...currentSpecCustom];
            } else {
                // å…¶ä»–é¡åˆ¥ï¼šä½¿ç”¨èª¿å‘³é¸é …
                updateCustomNotes();
                allCustomNotes = [...currentSpecCustom];
            }

            // å¦‚æœæ˜¯ç·¨è¼¯æ¨¡å¼ï¼ˆå¾çµå¸³è¦–çª—ç·¨è¼¯é£²æ–™é¡å“é …ï¼‰
            if (currentEditIndex >= 0) {
                // æ›´æ–°ç¾æœ‰å“é …çš„è¦æ ¼ï¼ˆä¸ä¿®æ”¹æ•¸é‡ï¼‰
                cart[currentEditIndex].spicy = currentSpecSpicy;
                cart[currentEditIndex].pepper = currentSpecPepper;
                cart[currentEditIndex].sauce = currentSpecSauce;
                cart[currentEditIndex].custom = allCustomNotes.join(', ');

                // å¦‚æœæ˜¯é£²æ–™ï¼Œä¹Ÿè¦æ›´æ–°é£²æ–™å°ˆå±¬æ¬„ä½
                if (currentItem.category === 'drink') {
                    cart[currentEditIndex].temp = currentDrinkTemp;
                    cart[currentEditIndex].iceLevel = currentIceLevel;
                    cart[currentEditIndex].sugarLevel = currentSugarLevel;
                }

                currentEditIndex = -1;

                // ç«‹å³åˆ·æ–°çµå¸³è¦–çª—é¡¯ç¤º
                renderCheckoutItems();
            } else {
                // æ–°å¢æ¨¡å¼ï¼šå»ºç«‹è³¼ç‰©è»Šé …ç›®ï¼ˆåŒ…å«è¦æ ¼å’ŒæŠ˜æ‰£ï¼‰
                const cartItem = {
                    ...currentItem,
                    quantity: currentSpecQty,
                    spicy: currentSpecSpicy,
                    pepper: currentSpecPepper,
                    sauce: currentSpecSauce,
                    custom: allCustomNotes.join(', '),
                    discount: currentItemDiscount  // åŠ å…¥å“é …æŠ˜æ‰£
                };

                // å¦‚æœæ˜¯é£²æ–™ï¼ŒåŠ å…¥é£²æ–™å°ˆå±¬æ¬„ä½
                if (currentItem.category === 'drink') {
                    cartItem.temp = currentDrinkTemp;
                    cartItem.iceLevel = currentIceLevel;
                    cartItem.sugarLevel = currentSugarLevel;
                }

                // æª¢æŸ¥è³¼ç‰©è»Šæ˜¯å¦å·²æœ‰ç›¸åŒè¦æ ¼çš„å“é …ï¼ˆåŒ…å«æŠ˜æ‰£ï¼‰
                const existingIndex = cart.findIndex(i =>
                    i.id === cartItem.id &&
                    i.spicy === cartItem.spicy &&
                    i.pepper === cartItem.pepper &&
                    i.sauce === cartItem.sauce &&
                    i.custom === cartItem.custom &&
                    (i.discount || 0) === (cartItem.discount || 0) &&  // æ¯”è¼ƒæŠ˜æ‰£
                    (currentItem.category !== 'drink' || (
                        i.temp === cartItem.temp &&
                        i.iceLevel === cartItem.iceLevel &&
                        i.sugarLevel === cartItem.sugarLevel
                    ))
                );

                if (existingIndex >= 0) {
                    cart[existingIndex].quantity += cartItem.quantity;
                } else {
                    cart.push(cartItem);
                }
            }

            updateCart();
            hideSpecModal();
        }

        // ========== çµ±ä¸€è¦æ ¼é¸æ“‡åŠŸèƒ½ ==========

        // çµ±ä¸€è¦æ ¼è¨­å®š
        let unifiedSpec = {
            spicy: 'ä¸è¾£',
            pepper: '',
            sauce: '',
            custom: []
        };

        // åˆå§‹åŒ–çµ±ä¸€è¦æ ¼é¸æ“‡
        function initUnifiedSpec() {
            unifiedSpec = {
                spicy: 'ä¸è¾£',
                pepper: '',
                sauce: '',
                custom: []
            };

            // é‡è¨­è¾£åº¦æŒ‰éˆ•
            document.querySelectorAll('.unified-spec-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector('.unified-spec-btn[data-spicy="ä¸è¾£"]').classList.add('active');

            // é‡è¨­è”¥æŒ‰éˆ•
            document.querySelectorAll('.unified-pepper-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector('.unified-pepper-btn[data-pepper=""]').classList.add('active');

            // é‡è¨­é†¬æŒ‰éˆ•
            document.querySelectorAll('.unified-sauce-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector('.unified-sauce-btn[data-sauce=""]').classList.add('active');

            // é‡è¨­è‡ªè¨‚è¼¸å…¥
            document.getElementById('unifiedCustomInput').value = '';
        }

        // é¸æ“‡çµ±ä¸€è¾£åº¦
        function selectUnifiedSpicy(spicy) {
            unifiedSpec.spicy = spicy;

            // ç«‹å³æ›´æ–°æŒ‰éˆ•ç‹€æ…‹ï¼ˆç„¡å»¶é²ï¼‰
            document.querySelectorAll('.unified-spec-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`.unified-spec-btn[data-spicy="${spicy}"]`).classList.add('active');

            // å»¶é²å¥—ç”¨åˆ°è³¼ç‰©è»Šï¼ˆä½¿ç”¨ requestAnimationFrameï¼‰
            applyUnifiedSpec();
        }

        // æ›´æ–°çµ±ä¸€å®¢è£½åŒ–å‚™è¨»
        function updateUnifiedCustom() {
            unifiedSpec.custom = [];

            // ç²å–è‡ªè¨‚è¼¸å…¥
            const customInput = document.getElementById('unifiedCustomInput').value.trim();
            if (customInput) {
                unifiedSpec.custom.push(customInput);
            }

            // ç«‹å³å¥—ç”¨çµ±ä¸€è¦æ ¼åˆ°è³¼ç‰©è»Š
            applyUnifiedSpec();
        }

        // é˜²æŠ–è¨ˆæ™‚å™¨
        let applyUnifiedSpecTimer = null;

        // å¥—ç”¨çµ±ä¸€è¦æ ¼åˆ°æ‰€æœ‰éé£²æ–™é¡å“é …
        function applyUnifiedSpec() {
            // æ¸…é™¤ä¹‹å‰çš„å®šæ™‚å™¨
            if (applyUnifiedSpecTimer) {
                cancelAnimationFrame(applyUnifiedSpecTimer);
            }

            // ä½¿ç”¨ requestAnimationFrame å»¶é²åŸ·è¡Œï¼Œé¿å…é »ç¹æ›´æ–°
            applyUnifiedSpecTimer = requestAnimationFrame(() => {
                // æª¢æŸ¥è³¼ç‰©è»Šæ˜¯å¦æœ‰éé£²æ–™å“é …
                const hasNonDrinkItems = cart.some(item => item.category !== 'drink');
                if (!hasNonDrinkItems) {
                    return; // æ²’æœ‰éé£²æ–™å“é …ï¼Œç›´æ¥è¿”å›
                }

                cart.forEach(item => {
                    // åªå¥—ç”¨åˆ°éé£²æ–™é¡å“é …
                    if (item.category !== 'drink') {
                        item.spicy = unifiedSpec.spicy;
                        item.pepper = unifiedSpec.pepper;
                        item.sauce = unifiedSpec.sauce;

                        // æ”¶é›†æ‰€æœ‰å®¢è£½åŒ–å‚™è¨»
                        const allCustoms = [];
                        if (unifiedSpec.pepper) allCustoms.push(unifiedSpec.pepper);
                        if (unifiedSpec.sauce) allCustoms.push(unifiedSpec.sauce);
                        if (unifiedSpec.custom.length > 0) {
                            allCustoms.push(...unifiedSpec.custom);
                        }
                        item.custom = allCustoms.join(', ');
                    }
                });

                // é‡æ–°æ¸²æŸ“çµå¸³è¦–çª—çš„å“é …åˆ—è¡¨
                renderCheckoutItems();
            });
        }

        // ç·¨è¼¯é£²æ–™é¡å“é …çš„è¦æ ¼
        function editDrinkSpec(itemIndex) {
            const item = cart[itemIndex];
            if (!item || item.category !== 'drink') return;

            currentItem = item;
            currentEditIndex = itemIndex;

            // è¨­å®šç•¶å‰è¦æ ¼
            currentSpecQty = item.quantity;
            currentSpecCustom = item.custom ? item.custom.split(', ') : [];

            // è§£ææº«åº¦å’Œå†°å¡Šé¸é …
            currentDrinkTemp = item.temp || 'å†°';
            currentIceLevel = item.iceLevel || 'æ­£å¸¸å†°';
            currentSugarLevel = item.sugarLevel || 'å…¨ç³–';

            // å¾ custom ä¸­è§£ææº«åº¦å’Œå†°å¡Šï¼ˆå¦‚æœæ²’æœ‰ç›´æ¥æ¬„ä½ï¼‰
            if (!item.temp) {
                if (currentSpecCustom.includes('ç†±')) {
                    currentDrinkTemp = 'ç†±';
                } else if (currentSpecCustom.includes('å°‘å†°')) {
                    currentIceLevel = 'å°‘å†°';
                } else if (currentSpecCustom.includes('å»å†°')) {
                    currentIceLevel = 'å»å†°';
                } else if (currentSpecCustom.includes('æ­£å¸¸å†°')) {
                    currentIceLevel = 'æ­£å¸¸å†°';
                }
            }

            // å¾ custom ä¸­è§£æç”œåº¦ï¼ˆå¦‚æœæ²’æœ‰ç›´æ¥æ¬„ä½ï¼‰
            if (!item.sugarLevel) {
                if (currentSpecCustom.includes('å¾®ç³–')) {
                    currentSugarLevel = 'å¾®ç³–';
                } else if (currentSpecCustom.includes('åŠç³–')) {
                    currentSugarLevel = 'åŠç³–';
                } else if (currentSpecCustom.includes('å°‘ç³–')) {
                    currentSugarLevel = 'å°‘ç³–';
                } else if (currentSpecCustom.includes('ç„¡ç³–')) {
                    currentSugarLevel = 'ç„¡ç³–';
                }
            }

            document.getElementById('specItemName').textContent = item.name;
            document.getElementById('specItemPrice').textContent = `$${item.price}`;
            document.getElementById('specQtyDisplay').textContent = currentSpecQty;

            // é‡è¨­æŒ‰éˆ•ç‹€æ…‹
            document.querySelectorAll('.temp-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`.temp-btn[data-temp="${currentDrinkTemp}"]`).classList.add('active');

            document.querySelectorAll('.ice-level-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`.ice-level-btn[data-ice="${currentIceLevel}"]`).classList.add('active');

            // è¨­å®šç”œåº¦æŒ‰éˆ•
            document.querySelectorAll('.sugar-level-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`.sugar-level-btn[data-sugar="${currentSugarLevel}"]`).classList.add('active');

            // é¡¯ç¤º/éš±è—å†°å¡Šå’Œç”œåº¦é¸é …
            const iceOptions = document.getElementById('iceOptions');
            const sugarOptions = document.getElementById('sugarOptions');
            if (currentDrinkTemp === 'å†°') {
                iceOptions.style.display = 'block';
                sugarOptions.style.display = 'block';
            } else {
                iceOptions.style.display = 'none';
                sugarOptions.style.display = 'none';
            }

            // é£²æ–™é¡ï¼šåªé¡¯ç¤ºæº«åº¦/å†°å¡Šé¸é …ï¼Œä¸èƒ½ä¿®æ”¹æ•¸é‡
            const modalBody = document.querySelector('#specModal .modal-body');

            // éš±è—è¾£åº¦å€å¡Š
            const spicySection = modalBody.querySelector('.spicy-section');
            if (spicySection) spicySection.style.display = 'none';

            // éš±è—èª¿å‘³é¸é …
            const seasoningOptions = modalBody.querySelector('.seasoning-options');
            if (seasoningOptions) seasoningOptions.style.display = 'none';

            // éš±è—è‡ªè¨‚è¼¸å…¥
            const customInput = document.getElementById('specCustomInput');
            if (customInput) customInput.style.display = 'none';

            // éš±è—æ•¸é‡é¸æ“‡å€å¡Š
            const quantitySection = modalBody.querySelector('.spec-quantity')?.closest('.spec-section');
            if (quantitySection) quantitySection.style.display = 'none';

            // é¡¯ç¤ºé£²æ–™é¸é …
            const drinkOptions = modalBody.querySelector('.drink-options');
            if (drinkOptions) drinkOptions.style.display = 'block';

            document.getElementById('specModal').classList.add('active');
        }

        // é‡æ–°æ¸²æŸ“çµå¸³è¦–çª—çš„å“é …åˆ—è¡¨
        function renderCheckoutItems() {
            const checkoutItems = document.getElementById('checkoutItems');
            checkoutItems.innerHTML = '';
            let subtotal = 0;
            let totalItemDiscounts = 0;

            cart.forEach((item, index) => {
                const itemOriginalTotal = item.price * item.quantity;
                const itemDiscount = item.discount || 0;
                const itemFinalTotal = itemOriginalTotal - itemDiscount;
                subtotal += itemFinalTotal;  // å°è¨ˆä½¿ç”¨æŠ˜æ‰£å¾Œçš„é‡‘é¡
                totalItemDiscounts += itemDiscount;

                const checkoutItem = document.createElement('div');
                checkoutItem.className = 'checkout-item';

                // å»ºç«‹åƒ¹æ ¼é¡¯ç¤º HTML
                let priceHtml = '';
                if (itemDiscount > 0) {
                    // æœ‰æŠ˜æ‰£ï¼šé¡¯ç¤ºåŸåƒ¹ - æŠ˜æ‰£ = æŠ˜å¾Œåƒ¹
                    priceHtml = `
                        <span style="color: #999; font-size: 14px;">$${itemOriginalTotal}</span>
                        <span style="color: #D63031; font-weight: bold; font-size: 14px;">-$${itemDiscount}</span>
                        <span style="color: #2D3436; font-weight: bold;">= $${itemFinalTotal}</span>
                    `;
                } else {
                    // ç„¡æŠ˜æ‰£ï¼šåªé¡¯ç¤ºåŸåƒ¹
                    priceHtml = `<span style="color: #2D3436; font-weight: bold;">$${itemOriginalTotal}</span>`;
                }

                checkoutItem.innerHTML = `
                    <div style="flex: 1;">
                        <strong>${item.name}</strong>
                        <span style="margin-left: 8px; color: #636E72;">Ã— ${item.quantity}</span>
                        ${itemDiscount > 0 ? `<span style="margin-left: 8px; color: #D63031; font-size: 12px;">ğŸ’°</span>` : ''}
                    </div>
                    <div style="display: flex; align-items: center; gap: 6px;">
                        ${priceHtml}
                    </div>
                `;
                checkoutItems.appendChild(checkoutItem);
            });

            // è¨ˆç®—ä¸¦é¡¯ç¤ºè‡ªå‹•æŠ˜æ‰£
            const { totalDiscount: autoDiscount, appliedDiscounts } = calculateDiscounts();

            // é¡¯ç¤ºå“é …æŠ˜æ‰£
            // if (totalItemDiscounts > 0) {
            //     const itemDiscountDiv = document.createElement('div');
            //     itemDiscountDiv.className = 'checkout-item';
            //     itemDiscountDiv.style.cssText = 'background: #FFE0E0; color: #D63031;';
            //     itemDiscountDiv.innerHTML = `
            //         <div>
            //             <strong>ğŸ’° å“é …æŠ˜æ‰£</strong>
            //         </div>
            //         <div style="color: #D63031;">-$${totalItemDiscounts}</div>
            //     `;
            //     checkoutItems.appendChild(itemDiscountDiv);
            // }

            // é¡¯ç¤ºè‡ªå‹•æŠ˜æ‰£
            if (autoDiscount > 0) {
                const discountDiv = document.createElement('div');
                discountDiv.className = 'checkout-item';
                discountDiv.style.cssText = 'background: #FFF3CD; color: #856404;';
                discountDiv.innerHTML = `
                    <div>
                        <strong>ğŸ·ï¸ è‡ªå‹•æŠ˜æ‰£</strong>
                    </div>
                    <div style="color: #856404;">-$${autoDiscount}</div>
                `;
                checkoutItems.appendChild(discountDiv);

                // é¡¯ç¤ºæŠ˜æ‰£æ˜ç´°
                appliedDiscounts.forEach(discount => {
                    const discountInfo = document.createElement('div');
                    discountInfo.style.cssText = 'padding: 8px 12px; font-size: 12px; color: #636E72; background: #F8F9FA;';
                    discountInfo.textContent = discount.description;
                    checkoutItems.appendChild(discountInfo);
                });
            }

            // æ›´æ–°å°è¨ˆã€æŠ˜æ‰£å’Œç¸½è¨ˆ
            // å°è¨ˆå·²ç¶“æ˜¯æŠ˜æ‰£å¾Œçš„é‡‘é¡ï¼ˆåŒ…å«å“é …æŠ˜æ‰£ï¼‰ï¼Œæ‰€ä»¥ç¸½è¨ˆåªæ‰£é™¤è‡ªå‹•æŠ˜æ‰£
            const total = subtotal - autoDiscount;
            document.getElementById('checkoutSubtotal').textContent = `$${subtotal}`;
            document.getElementById('checkoutTotal').textContent = `$${total}`;

            // é¡¯ç¤º/éš±è—æŠ˜æ‰£è¡Œï¼ˆåªé¡¯ç¤ºè‡ªå‹•æŠ˜æ‰£ï¼‰
            const discountRow = document.getElementById('checkoutDiscountRow');
            if (autoDiscount > 0) {
                discountRow.style.display = 'flex';
                document.getElementById('checkoutDiscount').textContent = `-$${autoDiscount}`;
            } else {
                discountRow.style.display = 'none';
            }
        }

        // ========== æ‰‹å‹•æŠ˜æ‰£åŠŸèƒ½ ==========

        // å¥—ç”¨å¿«é€ŸæŠ˜æ‰£ï¼ˆåªèƒ½å¥—ç”¨ä¸€æ¬¡ï¼Œç›´æ¥è¨­å®šè€Œéç´¯åŠ ï¼‰
        function applyManualDiscount(amount) {
            // è¨ˆç®—æŠ˜æ‰£å¾Œå°è¨ˆå’Œè‡ªå‹•æŠ˜æ‰£
            const subtotal = cart.reduce((sum, item) => {
                const itemTotal = item.price * item.quantity;
                const itemDiscount = item.discount || 0;
                return sum + (itemTotal - itemDiscount);
            }, 0);
            const autoDiscount = calculateDiscounts().totalDiscount;
            const maxDiscount = subtotal - autoDiscount; // æœ€å¤§å¯æŠ˜æ‰£é‡‘é¡ï¼ˆæ‰£æ‰è‡ªå‹•æŠ˜æ‰£å¾Œï¼‰

            // è¨­å®šæŠ˜æ‰£é‡‘é¡ï¼ˆä¸ç´¯åŠ ï¼‰ï¼Œä¸¦ç¢ºä¿ä¸è¶…éæœ€å¤§å¯æŠ˜æ‰£é‡‘é¡
            currentManualDiscount = Math.min(amount, maxDiscount);
            updateManualDiscountDisplay();
            updateCheckoutTotal();
        }

        // å¥—ç”¨è‡ªè¨‚é‡‘é¡ï¼ˆåªèƒ½å¥—ç”¨ä¸€æ¬¡ï¼Œç›´æ¥è¨­å®šè€Œéç´¯åŠ ï¼‰
        function applyCustomDiscount() {
            const input = document.getElementById('manualDiscountInput');
            const amount = parseFloat(input.value);
            if (!isNaN(amount) && amount > 0) {
                // è¨ˆç®—æŠ˜æ‰£å¾Œå°è¨ˆå’Œè‡ªå‹•æŠ˜æ‰£
                const subtotal = cart.reduce((sum, item) => {
                    const itemTotal = item.price * item.quantity;
                    const itemDiscount = item.discount || 0;
                    return sum + (itemTotal - itemDiscount);
                }, 0);
                const autoDiscount = calculateDiscounts().totalDiscount;
                const maxDiscount = subtotal - autoDiscount; // æœ€å¤§å¯æŠ˜æ‰£é‡‘é¡

                // è¨­å®šæŠ˜æ‰£é‡‘é¡ï¼ˆä¸ç´¯åŠ ï¼‰ï¼Œä¸¦ç¢ºä¿ä¸è¶…éæœ€å¤§å¯æŠ˜æ‰£é‡‘é¡
                currentManualDiscount = Math.min(amount, maxDiscount);
                input.value = '';
                updateManualDiscountDisplay();
                updateCheckoutTotal();
            }
        }

        // å¥—ç”¨ç™¾åˆ†æ¯”æŠ˜æ‰£ï¼ˆåªèƒ½å¥—ç”¨ä¸€æ¬¡ï¼Œç›´æ¥è¨­å®šè€Œéç´¯åŠ ï¼‰
        function applyPercentageDiscount(percentage) {
            // è¨ˆç®—æŠ˜æ‰£å¾Œå°è¨ˆ
            const subtotal = cart.reduce((sum, item) => {
                const itemTotal = item.price * item.quantity;
                const itemDiscount = item.discount || 0;
                return sum + (itemTotal - itemDiscount);
            }, 0);
            const autoDiscount = calculateDiscounts().totalDiscount;
            const maxDiscount = subtotal - autoDiscount; // æ‰£æ‰è‡ªå‹•æŠ˜æ‰£å¾Œçš„å¯æŠ˜é‡‘é¡

            // è¨ˆç®—æŠ˜æ‰£é‡‘é¡
            const discountAmount = Math.round(maxDiscount * (percentage / 100));

            // è¨­å®šæŠ˜æ‰£é‡‘é¡ï¼ˆä¸ç´¯åŠ ï¼‰
            currentManualDiscount = discountAmount;
            updateManualDiscountDisplay();
            updateCheckoutTotal();
        }

        // æ›´æ–°æŠ˜æ‰£åŸå› 
        function updateDiscountReason() {
            currentDiscountReason = document.getElementById('discountReason').value;
        }

        // æ¸…é™¤æ‰‹å‹•æŠ˜æ‰£
        function clearManualDiscount() {
            currentManualDiscount = 0;
            currentDiscountReason = '';
            document.getElementById('discountReason').value = '';
            updateManualDiscountDisplay();
            updateCheckoutTotal();
        }

        // æ›´æ–°æ‰‹å‹•æŠ˜æ‰£é¡¯ç¤º
        function updateManualDiscountDisplay() {
            const display = document.getElementById('manualDiscountDisplay');
            const amountDisplay = document.getElementById('manualDiscountAmount');

            if (currentManualDiscount > 0) {
                display.style.display = 'block';
                amountDisplay.textContent = `-$${currentManualDiscount}`;
            } else {
                display.style.display = 'none';
            }
        }

        // æ›´æ–°çµå¸³ç¸½é¡
        function updateCheckoutTotal() {
            const checkoutTotal = document.getElementById('checkoutTotal');

            // è¨ˆç®—æŠ˜æ‰£å¾Œå°è¨ˆï¼ˆå“é …æŠ˜æ‰£å·²å¥—ç”¨ï¼‰
            const subtotal = cart.reduce((sum, item) => {
                const itemTotal = item.price * item.quantity;
                const itemDiscount = item.discount || 0;
                return sum + (itemTotal - itemDiscount);
            }, 0);

            // è¨ˆç®—è‡ªå‹•æŠ˜æ‰£
            const autoDiscount = calculateDiscounts().totalDiscount;

            // ç¸½è¨ˆ = æŠ˜æ‰£å¾Œå°è¨ˆ - è‡ªå‹•æŠ˜æ‰£ - æ‰‹å‹•æŠ˜æ‰£
            const total = Math.max(0, subtotal - autoDiscount - currentManualDiscount); // ç¢ºä¿ç¸½é‡‘é¡ä¸æœƒæ˜¯è² æ•¸

            // æ›´æ–°å°è¨ˆ
            document.getElementById('checkoutSubtotal').textContent = `$${subtotal}`;

            // æ›´æ–°æŠ˜æ‰£é¡¯ç¤ºï¼ˆåªé¡¯ç¤ºè‡ªå‹•æŠ˜æ‰£ + æ‰‹å‹•æŠ˜æ‰£ï¼‰
            const totalDiscount = autoDiscount + currentManualDiscount;
            const discountRow = document.getElementById('checkoutDiscountRow');
            if (totalDiscount > 0) {
                discountRow.style.display = 'flex';
                document.getElementById('checkoutDiscount').textContent = `-$${totalDiscount}`;
            } else {
                discountRow.style.display = 'none';
            }

            checkoutTotal.textContent = `$${total}`;
        }

        // åˆå§‹åŒ–
        window.onload = () => {
            // å¾ localStorage æ¢å¾©ç•¶å‰ç‡Ÿæ¥­æ—¥è³‡æ–™
            const savedBusinessDate = localStorage.getItem('currentBusinessDate');
            if (savedBusinessDate) {
                businessDate = savedBusinessDate;
            }

            const savedBusinessData = localStorage.getItem(`businessData_${businessDate}`);
            if (savedBusinessData) {
                const parsed = JSON.parse(savedBusinessData);
                dailyStats = {
                    date: parsed.date,
                    totalRevenue: parsed.totalRevenue || 0,
                    totalDiscount: parsed.totalDiscount || 0,
                    orderCount: parsed.orderCount || 0,
                    orders: parsed.orders || [],
                    hourlyData: parsed.hourlyData || {
                        '17': 0, '18': 0, '19': 0, '20': 0, '21': 0, '22': 0, '23': 0
                    },
                    itemSales: parsed.itemSales || {},
                    categorySales: parsed.categorySales || {
                        beef: 0, pork: 0, chicken: 0, vegetable: 0, skewer: 0, drink: 0
                    }
                };

                // æ¢å¾©è¨‚å–®ç·¨è™Ÿï¼ˆå¾ç‡Ÿæ¥­æ—¥æœ€å¤§è¨‚å–®è™Ÿç¹¼çºŒï¼‰
                if (dailyStats.orders && dailyStats.orders.length > 0) {
                    const lastOrderNumber = dailyStats.orders[dailyStats.orders.length - 1].orderNumber;
                    const match = lastOrderNumber.match(/-(\d+)$/);
                    if (match) {
                        orderCount = parseInt(match[1]) + 1;
                    }
                }

                console.log(`âœ… å·²æ¢å¾©ç‡Ÿæ¥­æ—¥ ${businessDate} çš„è³‡æ–™ï¼Œå…± ${dailyStats.orderCount} ç­†è¨‚å–®`);
            }

            initMenu();
            initCategoryTabs();
            initSpecButtons(); // å„ªåŒ–è¦æ ¼æŒ‰éˆ•è§¸æ§éŸ¿æ‡‰

            // æ›´æ–°ä¸»ç•«é¢ç‡Ÿæ¥­æ—¥é¡¯ç¤º
            updateHeaderBusinessDate();

            // è¨­å®šå ±è¡¨æŸ¥è©¢å€é–“é è¨­å€¼ç‚ºç‡Ÿæ¥­æ—¥
            document.getElementById('dailyStartDateSelector').value = businessDate;
            document.getElementById('dailyEndDateSelector').value = businessDate;

            checkTestMode(); // æª¢æŸ¥æ¸¬è©¦æ¨¡å¼
        };
    </script>
</body>
</html>
