# 夯肉 HANGROU - iPad POS 點餐系統開發規劃

> **專案狀態**：Phase 1 原型重構完成，準備 Vue 3 轉換
>
> **📑 文件導覽**：[README](./README.md) | [REFACTORING](./REFACTORING-SUMMARY.md) | [VUE3-MIGRATION](./VUE3-MIGRATION-GUIDE.md)

## 專案概述

### 專案資訊
- **專案名稱**：夯肉 HANGROU iPad POS 系統
- **設備平台**：iPad 9 (10.2吋，2021年及後續機型) - 使用 Safari 瀏覽器
- **技術堆疊**：Vue 3 + TypeScript
- **業務類型**：日式炭火燒烤夜市攤位
- **開發時間**：預計開發週期 10-12 週
- **目標使用者**：店內工作人員
- **Phase 1 範圍**：本地資料庫、現金付款、基礎功能、Web 版

### 專案目標
開發一款專為夜市燒烤攝位設計的 iPad POS 點餐系統，簡化點餐、結帳、出單流程，提供銷售資料分析功能，提升營運效率。

**Phase 1 目標**：完成 Web 版本，可在 iPad Safari 瀏覽器上使用。

### Phase 1 特色
- ✅ **Vue 3 開發**：學習曲線平緩，開發效率高
- ✅ **Web 優先**：在 iPad Safari 瀏覽器上運作
- ✅ **完全本地運作**：使用 IndexedDB 本地資料庫，不需網路連線
- ✅ **簡化付款流程**：Phase 1 專注於現金付款，快速上手
- ✅ **核心功能優先**：點餐、結帳、列印、統計四大核心功能
- ✅ **成本優化**：無需資料庫費用、無需 App 上架費用
- ✅ **易於擴展**：未來可打包為 App 或逐步增加電子付款、會員系統等功能

---

## 核心功能需求

### 1. 點餐系統 (Order Taking)

#### 1.1 選單展示
- **網格化選單佈局**：類似 dudoo 系統，大圖示卡片展示
- **分類管理**：
  - 🐔 雞肉類
  - 🐂 牛肉類
  - 🐖 豬肉類
  - 🥬 蔬菜類
  - 🍢 經典串燒
  - 🍺 飲料類
  - 🍚 主食/配菜
- **菜品資訊顯示**：名稱、價格（NT$）（已移除圖片和介紹文字，介面簡潔）
- **快速篩選**：支援按分類、價格、熱銷快速篩選

#### 1.2 點餐操作
- **點擊加單**：點擊菜品卡片新增到訂單
- **數量調整**：
  - 點擊 + / - 按鈕調整數量
  - 支援直接輸入數量
  - 支援長按快速增加
- **規格選擇**：
  - 辣度：不辣、微辣、中辣、特辣
  - 備註：少冰、去冰、加蔥等自訂備註
- **購物車/訂單列表**：
  - 即時顯示已點菜品
  - 顯示小計金額
  - 支援刪除/修改訂單項
  - 支援清空訂單

#### 1.3 特殊功能
- **口味選擇**（Phase 2 新增，已完成）：
  - 辣度選擇：不辣、微辣、中辣、大辣（按鈕式）
  - 蔵選擇：正常、蔥多、蔥少、去蔥（按鈕式）
  - 蒜選擇：正常、蒜多、蒜少、去蒜（按鈕式）
  - 醬選擇：正常、醬多、醬少、去醬（按鈕式）
  - **飲料規格**：
    - 溫度選擇：冰、熱（按鈕式）
    - 冰塊選擇：正常冰、少冰、去冰（按鈕式，選「冰」時顯示）
    - 甜度選擇：全糖、少糖、半糖、微糖、無糖（按鈕式，啤酒除外）
    - 正常冰和全糖不顯示（簡化顯示）
  - 支援統一規格設定：一鍵套用口味到所有品項
  - 支援單一品項編輯：彈窗選擇規格（飲料可編輯溫度/冰塊/甜度）
  - 結帳畫面不顯示品項口味，介面簡潔
  - 規格資訊會儲存到訂單中��廚房單會顯示

- **折扣優惠**：
  - **單一品項折扣**：買幾串折多少（例如：烤香菇買3串折$5）
  - **分類折扣**：同分類商品達到數量後折扣（例如：買3串任何雞肉品項折$5）
  - **總數量折扣**：購物車總數達到數量後折扣（例如：滿5串任何品項折$20）
  - 可在設定畫面靈活配置所有折扣類型
  - 自動計算折扣金額
  - 支援多個折扣規則同時套用
  - 購物車即時顯示折扣金額
  - 結帳時明確列出折扣明細

- **手動折扣按鈕**（Phase 2 新增，已完成）：
  - 快速折扣按鈕：折$10、折$20、折$50
  - 可自訂折扣金額輸入
  - 百分比折扣：暫時隱藏打9折/打8折按鈕
  - 折扣原因記錄：會員折扣、活動優惠、服務補償、其他
  - 清除手動折扣功能
  - 即時顯示已套用的手動折扣金額
  - 權限管理（需店長授權才能使用）- 待實作

- **套餐組合**：支援建立套餐（例如：燒肉拼盤）（未來擴展）
- **加購推薦**：點餐時顯示推薦搭配菜品（未來擴展）

---

### 2. 結帳系統 (Checkout)

#### 2.1 付款方式（Phase 1 以現金為主）
- **現金付款**：
  - 輸入實收金額（僅允許輸入數字）
  - 自動計算找零
  - 支援快速金額按鈕：
    - **累加模式**：$100, $500, $1000 按鈕可累加金額
    - **收全額**：一鍵填入應收總額
    - **歸零**：清除輸入金額

**未來擴展選項**（Phase 4）：
- LINE Pay
- 街口支付
- 悠遊卡/一卡通
- 信用卡讀卡機整合

#### 2.2 結帳流程
```
點餐完成 → 確認訂單 → 輸入實收金額 → 完成付款 → 自動列印廚房單/小票
```

**收款操作說明**：
1. **手動輸入**：直接輸入實收金額（僅允許數字）
2. **累加模式**：點擊 $100/$500/$1000 按鈕累加金額
3. **收全額**：點擊「💰 收全額」按鈕自動填入總額
4. **歸零**：點擊「🗹️ 歸零」按鈕清除金額重新輸入

**流程說明**：
1. **點餐完成**：客戶選擇完所有菜品
2. **確認訂單**：檢查訂單內容（品項、數量、金額）
3. **輸入實收金額**：輸入客戶支付的現金金額
4. **完成付款**：系統顯示找零金額，點擊確認付款
5. **自動列印**：
   - 廚房單 → 廚房列印機（1 台）
   - 小票 → 櫃台列印機（1 台）
6. **自動清空訂單**：準備下一筆訂單

---

### 3. 出單系統 (Printing)

#### 3.1 列印機類型
- **廚房列印機**：
  - 熱感式列印機（58mm 或 80mm）
  - 支援網路列印機（Wi-Fi/Ethernet）
  - 支援藍牙列印機
- **櫃台小票機**：
  - 58mm 或 80mm 熱感式列印機
  - 列印客戶小票

#### 3.2 列印內容
**廚房單（KDS Order Ticket）**：
- 訂單號
- 時間戳
- 桌號/訂單類型
- 菜品清單（按類別分組）
- 數量
- 特殊要求（辣度、備註）
- 製作優先級

**客戶小票**：
- 店铺資訊（Logo、名稱、地址、電話）
- 訂單號、日期時間
- 菜品明細（名稱、數量、單價、小計）
- 總金額、實付金額
- 付款方式
- 聯絡電話
- 感謝語

#### 3.3 自動列印規則
- **立即列印模式**：結帳後自動列印
  - 廚房單 → 廚房列印機（1 台）
  - 客戶小票 → 櫃台列印機（1 台）
- **列印份數**：支援設定列印份數（預設 1 份）

#### 3.4 KDS (Kitchen Display System) 選用功能
- 數位化廚房顯示系統取代傳統列印
- 即時顯示訂單佇列
- 訂單狀態管理（待處理、製作中、已完成）
- 顏色標識緊急程度
- 聲音提示新訂單

---

### 4. 銷售統計 (Sales Analytics)

#### 4.1 即時統計
- **今日營業額**：即時顯示當日總營收
- **訂單數量**：已完成訂單總數
- **平均客單價**：總營業額 / 訂單數
- **時段分析**：每小時/每時段營業額熱力圖

#### 4.2 銷售報表

**每天結帳條**（Phase 2 新增）：
- 每日結帳總覽介面
- 顯示當日營業額（原價）
- 顯示當日總折扣金額
- 顯示當日實收金額（營業額 - 折扣）
- 顯示當日利潤
- 完整銷售明細列表：
  - 訂單號
  - 訂單時間
  - 訂單品項明細
  - 訂單金額
  - 折扣金額
  - 實收金額
- 支援匯出結帳明細（Excel/PDF）
- 每日結帳確認功能（需店長確認）

**日報表**：
- 原價營業額（未折扣）
- 今日總折扣金額
- 今日利潤（原價 - 折扣）
- 訂單數統計
- 各分類銷售占比
- 熱銷商品 TOP 10（顯示排名、品項、數量、營業額）
- **折扣明細**：顯示每個折扣規則的使用次數和總折扣金額
- 每小時營業額分析

**週報表**：
- 7天營業額趨勢圖
- 同比上週成長
- 客流量分析
- 峰值時段識別

**月報表**：
- 月度營收總覽
- 月度銷售趨勢
- 商品銷售排行榜
- 客戶消費習慣分析

**歷史帳查詢**（Phase 2 新增）：
- 日期選擇器：可選擇任意日期查看
- 日期範圍查詢：可查詢特定時間範圍
- 顯示該日期的所有統計資料
- 顯示該日期的所有訂單明細
- 支援匯出特定日期的資料
- 快速切換昨日/上週/上月

**自訂報表**：
- 選擇日期範圍
- 選擇分類/單品
- 匯出 Excel/CSV/PDF

#### 4.3 資料視覺化
- **圖表類型**：
  - 折線圖（趨勢）
  - 長條圖（對比）
  - 圓餅圖（占比）
  - 熱力圖（時段分布）
- **互動式圖表**：支援點擊查看詳情

#### 4.4 庫存管理系統（Phase 3 新增）

**庫存進貨管理**：
- 手動新增進貨數量
- 記錄進貨日期和供應商
- 進貨單位管理（串、包、公斤等）
- 進貨價格記錄
- 支援批次號追蹤

**自動庫存扣減**：
- 銷售後自動扣減庫存
- 根據訂單明細精確扣減
- 支援多單位換算（例如：1包=10串）
- 庫存變更日誌

**庫存預警**：
- 低於安全庫量時自動提醒
- 缺貨商品標記
- 庫存不足時無法點餐
- 庫存即時顯示在選單上

**庫存盤點功能**：
- 定期盤點功能
- 盤點差異報表
- 損耗記錄
- 庫存調整原因記錄（損壞、贈送、自用等）

**庫存報表**：
- 庫存總覽
- 進銷存報表
- 庫存周轉率分析
- 滯銷品項識別
- 成本分析（根據進貨價計算）

**資料結構範例**：
```javascript
{
  id: "inventory_chicken_skewer",
  itemId: "item_chicken_skewer",
  itemName: "雞肉串",
  currentStock: 150,           // 當前庫存
  unit: "串",                  // 單位
  minStock: 30,                // 安全庫量
  lastRestockDate: "2026-01-26",
  restockHistory: [
    {
      date: "2026-01-26",
      quantity: 200,
      supplier: "供應商A",
      costPrice: 25            // 進貨價
    }
  ],
  salesHistory: [
    {
      date: "2026-01-26",
      quantity: 50             // 當日銷售
    }
  ]
}
```

---

## UI/UX 設計參考

### 設計風格（參考 dudoo 系統）

#### 配色方案
```css
/* 主色調 - 保持與夯肉品牌一致 */
--primary-color: #FF6B35;      /* 活力橙紅 */
--secondary-color: #FF8C42;    /* 溫暖橙色 */
--accent-color: #2D3436;       /* 深灰黑 */

/* 功能色彩 */
--success-color: #00B894;      /* 成功/完成 */
--warning-color: #FDCB6E;      /* 警告/待處理 */
--danger-color: #D63031;       /* 錯誤/刪除 */
--info-color: #0984E3;         /* 資訊 */

/* 中性色 */
--bg-primary: #FFFFFF;         /* 主背景 */
--bg-secondary: #F8F9FA;       /* 次級背景 */
--text-primary: #2D3436;       /* 主文字 */
--text-secondary: #636E72;     /* 次要文字 */
--border-color: #DFE6E9;       /* 邊框 */
```

#### 字型系統
- **中文**：Noto Sans TC（Google Fonts）
- **數字**：Roboto（清晰易讀）
- **字級**：
  - 大標題：24-28px
  - 標題：18-20px
  - 本文：16px
  - 說明：14px
  - 輔助：12px

### iPad 介面佈局

#### 主畫面 (10.2 吋 2166 x 1620 像素)
```
┌─────────────────────────────────────────────────────────┐
│  夯肉 HANGROU                    [設定] [報表] [登出]  │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  [🐔全部] [🐂牛肉] [🐖豬肉] [🥬蔬菜] [🍢串燒] [🍺飲料]  │
│                                                         │
│  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐      │
│  │  圖片   │ │  圖片   │ │  圖片   │ │  圖片   │      │
│  │ 雞肉串  │ │ 牛五花  │ │ 豬肋排  │ │ 烤玉米  │      │
│  │  $50   │ │  $120   │ │  $80   │ │  $40   │      │
│  └─────────┘ └─────────┘ └─────────┘ └─────────┘      │
│                                                         │
│  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐      │
│  │  圖片   │ │  圖片   │ │  圖片   │ │  圖片   │      │
│  │ ...     │ │ ...     │ │ ...     │ │ ...     │      │
│  │  $XX   │ │  $XX   │ │  $XX   │ │  $XX   │      │
│  └─────────┘ └─────────┘ └─────────┘ └─────────┘      │
│                                                         │
├─────────────────────────────────────────────────────────┤
│  目前訂單                               [結帳] [清空]  │
│  ┌─────────────────────────────────────────────────┐  │
│  │ 雞肉串          x2     $100   [刪除]            │  │
│  │ 牛五花          x1     $120   [刪除]            │  │
│  │ 烤玉米          x1     $40    [刪除]            │  │
│  ├─────────────────────────────────────────────────┤  │
│  │ 總計：          4件    $260                    │  │
│  └─────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────┘
```

#### 結帳介面
```
┌─────────────────────────────────────────────────────────┐
│  ← 返回                     結帳付款                     │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  訂單號：#20260126001                                   │
│  時間：2026-01-26 19:35                                 │
│                                                         │
│  ┌─────────────────────────────────────────────────┐  │
│  │ 雞肉串          x2     $100                     │  │
│  │ 牛五花          x1     $120                     │  │
│  │ 烤玉米          x1     $40                      │  │
│  │ 🏷️ 折扣優惠           -$0                      │  │
│  ├─────────────────────────────────────────────────┤  │
│  │ 總計：                $260                     │  │
│  └─────────────────────────────────────────────────┘  │
│                                                         │
│  💰 手動折扣                                            │
│  [折$10] [折$20] [折$50]                               │
│  [自訂金額] [套用]                                      │
│  [打9折] [打8折]                                       │
│  折扣原因：[會員折扣 ▼]                                 │
│                                                         │
│  實收金額：$ [________]                                 │
│  [$100] [$500] [$1000] [💰收全額] [🗑️歸零]              │
│  找零：$740                                             │
│                                                         │
│         [取消]              [確認付款]                 │
└─────────────────────────────────────────────────────────┘
```

#### 報表介面
```
┌─────────────────────────────────────────────────────────┐
│  ← 返回                     銷售報表                     │
├─────────────────────────────────────────────────────────┤
│  [今日] [本週] [本月] [自訂]                            │
│                                                         │
│  今日營業額                         ██████████  $8,560 │
│  訂單數：42 單                                            │
│  平均客單價：$204                                         │
│                                                         │
│  ┌─────────────────────────────────────────────────┐  │
│  │ 時段分布                            │  │
│  │ 17:00-18:00  ████ $800                           │  │
│  │ 18:00-19:00  ████████ $2,100                     │  │
│  │ 19:00-20:00  ████████████ $3,200                 │  │
│  │ 20:00-21:00  ██████████ $1,800                   │  │
│  │ 21:00-22:00  ████ $660                           │  │
│  └─────────────────────────────────────────────────┘  │
│                                                         │
│  熱銷 TOP 5：                                           │
│  1. 牛五花     25 份   $3,000                          │
│  2. 雞肉串     20 份   $1,000                          │
│  3. 豬肋排     15 份   $1,200                          │
│  4. 烤玉米     12 份   $480                            │
│  5. 培根捲     10 份   $500                            │
└─────────────────────────────────────────────────────────┘
```

### 互動設計原則

1. **大按鈕設計**：適合觸控操作，最小點擊區域 44x44 pt
2. **視覺回饋**：點擊時提供即時的視覺或觸覺回饋
3. **層次分明**：使用卡片、陰影、顏色區分不同區域
4. **操作簡化**：減少點擊次數，常用功能一鍵觸達
5. **資訊密度適中**：避免過度擁擠，保持介面清晰
6. **觸控優化**：
   - 禁止雙指縮放和雙擊放大
   - 防止誤觸導致畫面縮放
   - 僅允許單指點擊和滾動操作
   - 輸入框仍可正常選取文字
7. **Modal 彈窗設計**：
   - 使用 Flexbox 佈局（`display: flex; flex-direction: column;`）
   - 最大高度限制為 90vh，避免超出螢幕
   - Modal header 固定不縮小（`flex-shrink: 0`）
   - Modal body 自動填滿可用空間並可滾動（`flex: 1; overflow-y: auto;`）
   - 確保不會在外層出現 scrollbar

---

## 技術架構

### 技術堆疊

```javascript
{
  // 前端框架
  "framework": "Vue 3",
  "language": "TypeScript",

  // 開發工具
  "buildTool": "Vite 5",

  // 狀態管理
  "stateManagement": "Pinia",

  // UI 組件庫
  "uiLibrary": "Vant 4",

  // 本地資料庫
  "database": "IndexedDB",
  "dbWrapper": "Dexie.js",

  // 列印功能
  "printing": "ESC/POS 協定",
  "printerConnection": "Wi-Fi / Ethernet",

  // 部署
  "deployment": "Vercel / Netlify / 靜態託管"
}
```

### Vue 3 的優勢

**開發體驗**：
- ✅ 學習曲線平緩，語法直觀易學
- ✅ Composition API 強大且靈活
- ✅ 單文件組件（SFC）開發體驗佳
- ✅ 中文文檔和社區資源豐富

**技術優勢**：
- ✅ 完整的 TypeScript 支援
- ✅ 優秀的生態系統（Vant、Pinia、VueUse）
- ✅ 效能優異，體積更小
- ✅ Vite 建構速度極快

**適合 POS 系統**：
- ✅ 表單處理簡潔（付款、數量輸入）
- ✅ 雙向綁定方便（購物車即時更新）
- ✅ 移動端組件完善（Vant UI）

### 方案優勢

**開發優勢**：
- 開發快速，成本最低
- 完全離線運作，不需網路
- 無需額外資料庫費用
- 無需伺服器維護

**營運優勢**：
- 資料完全自主控制
- 適合單機使用
- Web 版無需 App 審核
- 更新部署快速

**注意事項**：
- 資料僅存在本地，需手動備份
- 無法多設備即時同步
- 資料丟失風險較高（需定期備份）
- Web 版僅支援網路列印機（不支援 USB 列印機）

### 資料結構設計（IndexedDB）

**選單分類**
```javascript
{
  id: "category_chicken",
  name: "雞肉",
  icon: "🐔",
  sortOrder: 1,
  active: true,
  createdAt: "2026-01-26T10:00:00Z",
  updatedAt: "2026-01-26T10:00:00Z"
}
```

**菜品**
```javascript
{
  id: "item_chicken_skewer",
  categoryId: "category_chicken",
  name: "雞肉串",
  description: "新鮮雞腿肉醃製",
  price: 50,
  image: "images/menu/chicken-skewer.jpg",
  options: {
    spicy: ["不辣", "微辣", "中辣", "特辣"],
    custom: ["加蔥", "去蔥", "多醬", "少醬", "去冰", "少冰"]
  },
  active: true,
  createdAt: "2026-01-26T10:00:00Z",
  updatedAt: "2026-01-26T10:00:00Z"
}
```

**說明**：
- `options.spicy`：辣度選項（Phase 2 使用按鈕快速選取）
- `options.custom`：客製化備註（Phase 2 擴充更多選項）
- 點餐時可快速選擇口味和備註
- 廚房單會顯示選擇的口味和備註
- **飲料類**：包含溫度（冰/熱）、冰塊（正常/少/去）、甜度（全/少/半/微/無）

**折扣規則**
```javascript
{
  id: 1,
  type: "item",            // 折扣類型: "item" | "category" | "total"

  // 單一品項折扣 (type: "item")
  itemId: "item_mushroom",
  itemName: "烤香菇",

  // 分類折扣 (type: "category")
  categoryId: "category_chicken",

  quantity: 3,              // 購買數量
  discountAmount: 5,        // 折扣金額
  active: true,
  createdAt: "2026-01-26T10:00:00Z",
  updatedAt: "2026-01-26T10:00:00Z"
}
```

**說明**：
- **type**：折扣類型
  - `"item"`：單一品項折扣（例如：烤香菇買3串折$5）
  - `"category"`：分類折扣（例如：買3串任何雞肉品項折$5）
  - `"total"`：總數量折扣（例如：購物車滿5串任何品項折$20）
- **itemId**：單一品項折扣時使用的品項 ID
- **categoryId**：分類折扣時使用的分類 ID
- **quantity**：需達到的購買數量
- **discountAmount**：折扣金額（新台幣）
- 系統會自動計算可套用幾次折扣
- 支援多個折扣規則同時套用

**訂單**
```javascript
{
  id: "order_20260126_001",
  orderNumber: "#20260126001", // 訂單編號（8位日期+3位序號，無 '-'）
  items: [
    {
      itemId: "item_chicken_skewer",
      name: "雞肉串",
      category: "chicken",
      quantity: 2,
      price: 50,
      spicy: "中辣",            // Phase 2：辣度選擇
      onion: "蔥多",            // Phase 2：蔥選擇（正常為空字串）
      garlic: "蒜多",           // Phase 2：蒜選擇（正常為空字串）
      sauce: "",                // Phase 2：醬選擇（正常為空字串）
      custom: "蔥多、蒜多"      // Phase 2：合併的客製化備註（用於顯示）
    },
    {
      itemId: "item_cola",
      name: "可樂",
      category: "drink",
      quantity: 1,
      price: 30,
      custom: "少冰、半糖"      // 飲料：溫度、冰塊、甜度
    }
  ],
  subtotal: 260,              // 原價小計
  discount: 0,                // 折扣金額
  manualDiscount: 0,          // Phase 2：手動折扣金額
  discountReason: "",         // Phase 2：折扣原因
  total: 260,                 // 實收金額（subtotal - discount - manualDiscount）
  paymentMethod: "cash",
  receivedAmount: 1000,
  changeAmount: 740,
  orderStatus: "completed",
  createdAt: "2026-01-26T11:35:00Z",
  completedAt: "2026-01-26T11:36:00Z"
}
```

**說明**：
- `spicy`：辣度選擇（Phase 2 新增）
- `onion`：蔥選擇（Phase 2 新增，正常為空字串）
- `garlic`：蒜選擇（Phase 2 新增，正常為空字串）
- `sauce`：醬選擇（Phase 2 新增，正常為空字串）
- `custom`：合併的客製化備註，用於購物車和結帳顯示
- `manualDiscount`：手動折扣金額（Phase 2 新增）
- `discountReason`：折扣原因說明（Phase 2 新增）

**銷售統計（每日彙總）**
```javascript
{
  date: "2026-01-26",
  totalRevenue: 9000,        // 原價營業額（未折扣）
  totalDiscount: 440,        // 總折扣金額
  orderCount: 42,
  paymentMethods: {
    "cash": 8560
  },
  hourlyData: {
    "17": 800,
    "18": 2100,
    "19": 3200,
    "20": 1800,
    "21": 660
  },
  itemSales: {
    "item_beef": {
      name: "牛五花",
      quantity: 25,
      revenue: 3000,          // 原價營業額
      discount: 150           // 該品項的折扣金額
    }
  },
  categorySales: {
    "beef": 3500,
    "pork": 2100,
    "chicken": 1800,
    "vegetable": 1160
  },
  createdAt: "2026-01-26T23:59:59Z"
}
```

**說明**：
- `totalRevenue`：原價營業額（未折扣前的總額）
- `totalDiscount`：當日所有折扣的總金額
- 利潤計算：`totalRevenue - totalDiscount = 實收金額`
- `itemSales`：每個品項包含原價營業額和折扣金額（用於後台計算）
- `hourlyData`：記錄每小時的原價營業額

**折扣明細顯示**：
- 根據 `discountRules` 和訂單記錄計算每個折扣規則的使用次數
- 顯示每個折扣規則的總折扣金額
- 支援三種折扣類型明細：
  - 單一品項折扣：顯示品項名稱
  - 分類折扣：顯示分類名稱
  - 總數量折扣：顯示「全館」
- Phase 2 新增：手動折扣明細顯示

**每日結帳記錄**（Phase 2 新增）：
```javascript
{
  date: "2026-01-26",
  checkoutTime: "2026-01-26T23:59:00Z",
  checkoutBy: "店長",
  confirmed: true,

  // 營業統計
  totalRevenue: 9000,          // 原價營業額
  totalDiscount: 440,          // 總折扣金額
  manualDiscount: 100,         // 手動折扣金額
  actualRevenue: 8460,         // 實收金額
  profit: 8546,                // 利潤

  // 訂單統計
  orderCount: 42,
  orders: [
    // 當日所有訂單明細
  ],

  // 分類銷售
  categorySales: {
    beef: 3500,
    pork: 2100,
    chicken: 1800,
    vegetable: 1160
  },

  // 庫存變更（Phase 3 新增）
  inventoryChanges: [
    {
      itemId: "item_chicken_skewer",
      itemName: "雞肉串",
      startStock: 200,
      endStock: 150,
      sold: 50,
      restocked: 0
    }
  ]
}
```

**說明**：
- 每日結帳時生成記錄
- 包含當日完整統計資料
- 包含當日所有訂單明細
- Phase 3 起包含庫存變更記錄
- 需要店長確認結帳
- 結帳後資料不可修改

**庫存資料結構**（Phase 3 新增）：
```javascript
{
  id: "inventory_chicken_skewer",
  itemId: "item_chicken_skewer",
  itemName: "雞肉串",
  currentStock: 150,           // 當前庫存
  unit: "串",                  // 單位
  minStock: 30,                // 安全庫量（低於此數量會警告）
  costPrice: 25,               // 進貨價格
  lastRestockDate: "2026-01-26",
  supplier: "供應商A",
  active: true,
  createdAt: "2026-01-26T10:00:00Z",
  updatedAt: "2026-01-26T10:00:00Z"
}
```

**進貨記錄**（Phase 3 新增）：
```javascript
{
  id: "restock_20260126_001",
  itemId: "item_chicken_skewer",
  itemName: "雞肉串",
  quantity: 200,               // 進貨數量
  unit: "串",
  costPrice: 25,               // 進貨價格
  totalCost: 5000,             // 總成本
  supplier: "供應商A",
  batchNumber: "B20260126001", // 批次號
  notes: "新鮮雞腿肉",
  restockedBy: "店長",
  restockDate: "2026-01-26",
  createdAt: "2026-01-26T10:00:00Z"
}
```

**說明**：
- 銷售時根據訂單明細自動扣減庫存
- 低於安全庫量時系統自動警告
- 進貨時增加庫存數量
- 記錄每次進貨的詳細資訊
- 支援批次追蹤（用於品質管理）
- 記錄進貨價格用於成本分析

### IndexedDB 資料庫設計

```javascript
// 資料庫名稱：HangroPOSDB
// 版本：2 (Phase 2 新增口味和結帳功能，Phase 3 新增庫存功能)

const DB_STRUCTURE = {
  name: 'HangroPOSDB',
  version: 2,
  stores: [
    {
      name: 'categories',      // 分類
      keyPath: 'id',
      indexes: ['sortOrder', 'active']
    },
    {
      name: 'items',           // 菜品
      keyPath: 'id',
      indexes: ['categoryId', 'active', 'price']
    },
    {
      name: 'orders',          // 訂單
      keyPath: 'id',
      indexes: ['createdAt', 'orderStatus', 'date']
    },
    {
      name: 'dailyStats',      // 每日統計
      keyPath: 'date',
      indexes: ['createdAt']
    },
    {
      name: 'discountRules',   // 折扣規則
      keyPath: 'id',
      indexes: ['type', 'itemId', 'categoryId', 'active']
    },
    {
      name: 'inventory',       // 庫存（Phase 3 新增）
      keyPath: 'id',
      indexes: ['itemId', 'currentStock']
    },
    {
      name: 'restockHistory',  // 進貨記錄（Phase 3 新增）
      keyPath: 'id',
      indexes: ['itemId', 'date']
    },
    {
      name: 'dailyCheckout',   // 每日結帳記錄（Phase 2 新增）
      keyPath: 'date',
      indexes: ['checkoutTime']
    },
    {
      name: 'settings',        // 系統設定
      keyPath: 'key'
    }
  ]
};
```

### 列印機整合

#### ESC/POS 列印協定
```javascript
// 範例：列印廚房單
const printKitchenTicket = async (order, printerIp) => {
  const receipt = `
    =================================
    夯肉 HANGROU - 廚房單
    =================================
    訂單號：${order.id}
    時間：${order.createdAt}
    ---------------------------------
  `;

  order.items.forEach(item => {
    receipt += `${item.name} x${item.quantity}\n`;
    if (item.options) {
      receipt += `  備註：${Object.values(item.options).join(', ')}\n`;
    }
  });

  receipt += `
    =================================
  `;

  // 發送到網路列印機
  await sendToPrinter(printerIp, 9100, receipt);
};
```

#### 支援的列印機型號
- **Epson TM-m30 / TM-m30II**（推薦，支援 Wi-Fi/Ethernet）
- **Star Micronics mC-Print3**
- **XPrinter XP-Q800F**
- **Goojprt 58mm/80mm 熱感式列印機**

---

## 未來擴展方案（Phase 2）

### App 打包選項

#### 選項 A：Capacitor 打包為原生 App

**優勢**：
- ✅ 跨平台（iOS + Android）
- ✅ 原生功能完整（USB 列印機、檔案系統、本地通知）
- ✅ 更接近原生體驗
- ✅ 可上架 App Store

**所需額外成本**：
- Apple Developer 帳號：NT$3,500/年
- Mac 電腦（如沒有）：NT$30,000 起
- 開發時間：+3-4 天

#### 選項 B：PWA（漸進式 Web App）

**優勢**：
- ✅ 可安裝到 iPad 主畫面
- ✅ 離線功能更完善
- ✅ 無需 App Store 審核
- ✅ 無需額外成本

**限制**：
- 無法使用 USB 列印機
- 無法使用部分原生功能
- Safari 限制較多

---

## 開發計畫

### 第一階段：需求確認與設計（1-2 週）

#### Week 1
- [ ] 確認詳細功能需求
- [ ] 繪製 UI 原型圖（Figma/Sketch）
- [ ] 確認列印機型號和採購
- [ ] 設計資料庫結構
- [ ] 制定開發規範

#### Week 2
- [ ] UI/UX 詳細設計
- [ ] 建立設計系統文件
- [ ] 準備測試資料
- [ ] 建構開發環境（Vue 3 + Vite）
- [ ] 確認技術堆疊
- [ ] 初始化 Vue 3 專案
- [ ] 安裝依賴套件（Vant、Pinia、Dexie）

### 第二階段：核心功能開發（4-5 週）

#### Week 3-4：基礎功能
- [ ] 專案初始化（Vue 3 + Vite）
- [ ] 資料庫初始化（IndexedDB）
- [ ] 基礎 UI 框架建構
- [ ] 選單分類和菜品展示
- [ ] 點餐功能（新增、修改、刪除）
- [ ] 購物車/訂單列表

#### Week 5-6：結帳與列印
- [ ] 結帳介面開發
- [ ] 付款方式選擇
- [ ] 現金付款計算
- [ ] 列印機整合（ESC/POS）
- [ ] 小票模板設計
- [ ] 自動列印功能

### 第三階段：統計與管理功能（2-3 週）

#### Week 7-8
- [ ] 銷售資料收集
- [ ] 即時統計展示
- [ ] 日報表開發
- [ ] 週報表開發
- [ ] 月報表開發
- [ ] 資料視覺化圖表

#### Week 9
- [ ] 商品管理（增刪改查）
- [ ] 分類管理
- [ ] 系統設定
- [ ] 資料備份與還原功能
- [ ] Web 版部署測試

### 第四階段：測試與優化（1-2 週）

#### Week 10-11
- [ ] 功能測試
- [ ] 列印機測試（網路列印機）
- [ ] 效能優化
- [ ] 使用者體驗優化
- [ ] iPad Safari 瀏覽器測試
- [ ] Bug 修復
- [ ] 真實環境測試

### 第五階段：部署與培訓（1 週）

#### Week 12
- [ ] 生產環境部署（Vercel）
- [ ] 初始化資料庫（選單資料）
- [ ] 列印機設定與測試
- [ ] 員工培訓
- [ ] 操作手冊編寫
- [ ] 資料備份機制設定
- [ ] 上線準備

---

## 硬體需求

### 必備硬體

#### iPad 設備
- **型號**：iPad 9 (10.2吋，2021)
- **儲存**：至少 64GB
- **網路**：Wi-Fi（可選 Cellular，用於備用網路）
- **數量**：1 台（櫃檯點餐使用）

#### 列印機
**廚房列印機（58mm 熱感式）**：
- 型號：Epson TM-m30II 或 XPrinter XP-Q800F
- 連接：Wi-Fi / Ethernet
- 數量：1 台

**櫃檯小票機（58mm/80mm 熱感式）**：
- 型號：同上或獨立設備
- 數量：1 台

**總計**：2 台列印機（廚房 1 台 + 櫃檯 1 台）

#### 網路設備
- **路由器**：支援 5GHz Wi-Fi 6
- **網路交換器**（如使用有線列印機）
- **UPS 不斷電系統**：防止突然斷電

### 選用硬體

- **iPad 支架**：桌面固定支架
- **觸控筆**：便於操作（Apple Pencil 或第三方）
- **掃描槍**：用於會員卡掃描（未來擴展）
- **讀卡機**：信用卡/悠遊卡讀卡機（未來擴展）
- **現金抽屜**：與列印機連動

---

---

## 風險與挑戰

### 技術風險

1. **列印機相容性**
   - 風險：不同列印機協定差異
   - 緩解：選擇支援 ESC/POS 標準的列印機，充分測試

2. **網路穩定性**
   - 風險：夜市環境網路可能不穩定
   - 緩解：本地資料庫版本完全離線運作，不受網路影響

3. **資料備份**
   - 風險：iPad 故障或遺失導致資料丟失
   - 緩解：
     - 每日自動備份到 iCloud / Google Drive
     - 支援手動匯出備份檔案
     - 定期備份到 USB 隨身碟

4. **效能問題**
   - 風險：大量訂單資料導致卡頓
   - 緩解：資料分頁、索引優化

---

## 後續擴展功能

### Phase 2 功能

**核心功能擴展**：

- [ ] **口味選擇功能**：
  - 辣度按鈕：不辣、微辣、中辣、特辣
  - 客製化備註：少冰、去冰、加蔥、去蔥等
  - 口味快速按鈕
  - 備註顯示在訂單和廚房單

- [ ] **手動折扣按鈕**：
  - 快速折扣：折$10、折$20、折$50
  - 自訂折扣金額
  - 百分比折扣（打9折）
  - 折扣原因記錄
  - 權限管理

- [ ] **每天結帳條**：
  - 每日結帳總覽
  - 營業額統計（原價）
  - 折扣額統計
  - 實收金額
  - 完整銷售明細
  - 匯出功能（Excel/PDF）
  - 結帳確認機制

- [ ] **歷史帳查詢**：
  - 日期選擇器
  - 日期範圍查詢
  - 查看任意日期統計
  - 查看任意日期訂單明細
  - 匯出特定日期資料
  - 快速切換昨日/上週/���月

### Phase 3 功能

**庫存管理系統**：
- [ ] **庫存進貨管理**：
  - 手動新增進貨數量
  - 記錄進貨日期和供應商
  - 進貨價格記錄
  - 支援批次號追蹤

- [ ] **自動庫存扣減**：
  - 銷售後自動扣減庫存
  - 根據訂單明細精確扣減
  - 庫存變更日誌

- [ ] **庫存預警**：
  - 低於安全庫量時自動提醒
  - 缺貨商品標記
  - 庫存不足時無法點餐
  - 庫存即時顯示在選單上

- [ ] **庫存盤點功能**：
  - 定期盤點功能
  - 盤點差異報表
  - 損耗記錄

- [ ] **庫存報表**：
  - 庫存總覽
  - 進銷存報表
  - 庫存周轉率分析
  - 滯銷品項識別
  - 成本分析（根據進貨價計算）

**進階功能**：
- [ ] **會員系統**：
  - 會員註冊與積分
  - 會員等級與折扣
  - 儲值卡功能

- [ ] **掃碼點餐**：
  - 顧客掃碼自助點餐
  - 訂單直接同步到廚房

### Phase 4 功能

**多種付款方式**：
- [ ] **電子支付整合**：
  - LINE Pay 整合
  - 街口支付
  - 悠遊卡/一卡通
  - 信用卡讀卡機整合

**智慧化與自動化**：
- [ ] **AI 分析**：
  - 銷售預測
  - 智慧補貨建議
  - 客戶行為分析

- [ ] **LINE 機器人**：
  - 訂單通知
  - 會員服務
  - 行銷推播

- [ ] **財務報表**：
  - 成本分析
  - 利潤分析
  - 稅務報表

---

## 成功指標

### 系統效能指標
- **點餐速度**：完成一筆訂單 < 30 秒
- **結帳速度**：完成結帳 < 20 秒
- **列印速度**：小票列印 < 5 秒
- **系統回應**：介面操作延遲 < 200ms
- **穩定性**：系統當機率 < 0.1%

### 業務影響指標
- **效率提升**：點餐速度提升 50%+
- **錯誤減少**：訂單錯誤率降低 80%+
- **資料準確**：銷售資料 100% 準確
- **成本節省**：人力成本降低 20-30%
- **營業額成長**：透過資料分析提升 10-15%

---

## 附錄

### 參考資源

#### 開發工具

**Vue 生態系**：
- **Vue 3**：https://vuejs.org/
- **Pinia**：https://pinia.vuejs.org/（狀態管理）
- **Vite**：https://vitejs.dev/（建構工具）
- **Vant UI**：https://vant-ui.github.io/vant/#/zh-CN（移動端組件庫）
- **Element Plus**：https://element-plus.org/zh-CN/（桌面端組件庫）
- **VueUse**：https://vueuse.org/（Composition API 工具集）

**通用工具**：
- **IndexedDB Wrapper**：https://github.com/jakearchibald/idb
- **Dexie.js**：https://dexie.org/（IndexedDB 包裝庫）
- **Tailwind CSS**：https://tailwindcss.com/
- **Chart.js / ECharts**：資料視覺化

#### 列印相關
- **ESC/POS 協定**：https://www.epson.com.vn/support/view/esc-pos-
- **node-thermal-printer**：https://github.com/KikeAmat/thermalPrinter
- **Web USB API**：https://developer.mozilla.org/en-US/docs/Web/API/Web_USB_API

#### 設計參考
- **Figma**：https://www.figma.com/
- **Dribbble**：https://dribbble.com/search/pos-system
- **dudoo 肚肚**：https://www.dudooeat.com/

#### POS 系統參考
- **Square POS**：https://squareup.com/
- **Toast POS**：https://pos.toasttab.com/
- **Lightspeed**：https://www.lightspeedhq.com/

### 相關文件
- `README.md`：**POS 系統文件導覽**（✅ 已完成 - 文件總覽與導航）
- `REFACTORING-SUMMARY.md`：**狀態管理重構總結**（✅ 已完成 - appState、StateManager、Utils 說明）
- `VUE3-MIGRATION-GUIDE.md`：**Vue 3 遷移指南**（✅ 已完成 - 原型轉 Vue 3 對照）
- `VUE3-QUICKSTART.md`：**Vue 3 快速開始指南**（✅ 已完成 - 專案初始化）
- `UI-DESIGN.md`：UI/UX 設計詳細文件（待建立）
- `DATABASE-SCHEMA.md`：IndexedDB 資料庫架構文件（待建立）
- `BACKUP-GUIDE.md`：資料備份與還原指南（待建立）
- `USER-MANUAL.md`：使用者操作手冊（待建立）
- `VUE-REACT-COMPARISON.md`：Vue vs React 技術選型分析（已完成）
- `CAPACITOR-GUIDE.md`：Capacitor 打包與上架指南（Phase 2 待建立）

---

## 待辦事項

### ✅ 已完成功能

#### 飲料規格優化（2026-02-08）
- ✅ 新增甜度選擇：全糖、少糖、半糖、微糖、無糖
- ✅ 飲料溫度：冰、熱（按鈕式）
- ✅ 冰塊選項：正常冰、少冰、去冰（選「冰」時顯示）
- ✅ 正常冰和全糖不顯示（簡化顯示）
- ✅ 啤酒不含甜度選項（符合實際情況）

#### Modal 高度優化（2026-02-08）
- ✅ 所有 modal 使用 Flexbox 佈局
- ✅ Modal 最大高度 90vh，自動適應螢幕
- ✅ Header 固定不縮小（`flex-shrink: 0`）
- ✅ Body 自動填滿並可滾動（`flex: 1; overflow-y: auto;`）
- ✅ 外層不出現 scrollbar
- ✅ 優化 modal：訂單明細、結帳、規格選擇、折扣規則

#### 測試資料生成優化（2026-02-08）
- ✅ 使用實際存在的品項（可樂、啤酒）
- ✅ 移除不存在的品項（珍珠奶茶、泡泡綠）
- ✅ 同一訂單的燒烤類使用統一的口味
- ✅ 分別存儲 onion、garlic、sauce 欄位
- ✅ 訂單明細正確顯示完整口味標籤
- ✅ 飲料類各自隨機生成溫度、冰塊、甜度

#### 結帳介面優化（2026-02-07）
- ✅ 總計和現金付款移至手動折扣下方
- ✅ 總計金額正確包含手動折扣
- ✅ 所有收付款函數已更新（setFullAmount, clearAmount, addAmount, calculateChange）

#### 訂單編號格式優化（2026-02-07）
- ✅ 移除訂單編號中的 '-' 符號
- ✅ 格式從 `#20260126-001` 改為 `#20260126001`
- ✅ 方便複製和查詢

#### 匯出結帳明細功能優化（2026-02-07）
- ✅ 支援日期區間查詢匯出
- ✅ 自動讀取日期選擇器的值
- ✅ 收集區間內所有日期的訂單資料
- ✅ 合併統計資料（營業額、折扣、訂單數）
- ✅ 依日期和訂單號排序
- ✅ 檔名根據日期區間自動命名
- ✅ 區間查詢時保留匯出按鈕，只隱藏關帳按鈕
- ✅ 修正所有繁體中文亂碼問題

---

### 🔴 高優先級 - Phase 1 缺失功能

#### 1. 列印機整合功能（出單系統）⭐⭐⭐⭐⭐
**狀態**：待開發
**影響**：Phase 1 核心功能缺失，無法自動列印廚房單和客戶小票

**任務內容**：

##### 研究與準備
- [ ] 調查 ESC/POS 協定規範
- [ ] 確認目標列印機型號（Epson TM-m30II 或 XPrinter XP-Q800F）
- [ ] 研究網路列印機連接方式（TCP/IP）
- [ ] 測試列印機與 iPad 的網路連通性

##### 廚房單列印功能
- [ ] 設計廚房單格式
  - 訂單號
  - 時間戳
  - 菜品清單（按類別分組）
  - 數量
  - 特殊要求（辣度、備註 - Phase 2 功能）
  - 製作優先級
- [ ] 實作 ESC/POS 命令格式化
- [ ] 實作網路列印發送功能
- [ ] 測試列印輸出

##### 客戶小票列印功能
- [ ] 設計客戶小票格式
  - 店鋪資訊（夯肉 HANGROU、地址、電話）
  - 訂單號、日期時間
  - 菜品明細（名稱、數量、單價、小計）
  - 折扣明細
  - 總金額、實付金額、找零
  - 付款方式
  - 感謝語
- [ ] 實作 ESC/POS 命令格式化
- [ ] 實作網路列印發送功能
- [ ] 測試列印輸出

##### 自動列印整合
- [ ] 在 `completePayment()` 函數中整合列印功能
- [ ] 實作並行列印（廚房單 + 小票同時發送）
- [ ] 添加列印錯誤處理
- [ ] 添加列印狀態提示（成功/失敗）
- [ ] 測試完整付款列印流程

##### 列印機設定管理
- [ ] 在系統設定中新增列印機設定頁面
  - 廚房列印機 IP 位址
  - 櫃台列印機 IP 位址
  - 列印機連接埠（預設 9100）
  - 測試連線按鈕
- [ ] 儲存列印機設定到 localStorage
- [ ] 提供列印機重新連線功能

##### 錯誤處理與使用者體驗
- [ ] 列印失敗時的提示訊息
- [ ] 網路斷線時的降級處理
- [ ] 支援手動重新列印功能
- [ ] 添加列印日誌（除錯用）

**技術細節**：
```javascript
// ESC/POS 協定範例
const initPrinter = () => '\x1B\x40'; // 初始化
const setAlign = (align) => {
  if (align === 'center') return '\x1B\x61\x01';
  if (align === 'right') return '\x1B\x61\x02';
  return '\x1B\x61\x00';
};

// 網路列印發送
const sendToPrinter = async (ip, port, data) => {
  const socket = new WebSocket(`ws://${ip}:${port}`);
  socket.onopen = () => {
    socket.send(data);
    socket.close();
  };
};
```

**驗收標準**：
- ✅ 付款後自動列印廚房單和客戶小票
- ✅ 廚房單格式正確，包含所有必要資訊
- ✅ 客戶小票格式清晰，包含完整明細
- ✅ 列印機設定可保存和修改
- ✅ 列印失敗有適當提示
- ✅ 支援手動重新列印

**注意事項**：
- Web 版限制：無法使用 USB 列印機，必須使用網路列印機
- Safari 限制：可能需要處理 CORS 問題
- 列印機必須與 iPad 在同一網路
- 建議使用支援 ESC/POS 標準的列印機型號

---

#### 2. 結帳介面優化（UI/UX 改進）✅ 已完成
**狀態**：✅ 已完成（2026-02-07）
**影響**：提升使用者體驗，確保金額計算正確

**任務內容**：
- [x] 將「總計」和「💵 現金付款」移到手動折扣區塊下方
- [x] 修正所有總計計算邏輯，確保包含手動折扣
- [x] 更新以下函數：
  - `setFullAmount()` - 收全額包含手動折扣
  - `clearAmount()` - 歸零提示包含手動折扣
  - `addAmount()` - 快速金額按鈕找零包含手動折扣
  - `calculateChange()` - 手動輸入找零包含手動折扣
  - `updateCheckoutTotal()` - 已正確實作
  - `completePayment()` - 已正確實作

**實作成果**：
- ✅ 結帳介面順序：訂單項目 → 自動折扣 → 手動折扣區塊 → **總計** → **💵 現金付款** → 實收金額 → 找零 → 確認付款
- ✅ 總計金額正確統計手動折扣
- ✅ 「收全額」按鈕自動填入扣除手動折扣後的金額
- ✅ 所有找零計算都包含手動折扣

**驗收標準**：
- ✅ 結帳介面佈局符合預期
- ✅ 總計正確包含所有折扣
- ✅ 快速金額按鈕計算正確
- ✅ 收全額功能計算正確
- ✅ 找零計算正確

---

#### 3. 訂單編號格式優化 ✅ 已完成
**狀態**：✅ 已完成（2026-02-07）
**優先級**：低

**任務內容**：
- [x] 移除訂單編號中的 '-' 符號
- [x] 更新所有生成訂單編號的程式碼
- [x] 更新 HTML 範例

**實作成果**：
- ✅ 舊格式：`#20260126-001`
- ✅ 新格式：`#20260126001`
- ✅ 更新位置：
  - HTML 範例（結帳彈窗）
  - `showCheckout()` 函數
  - `updateOrderNumber()` 函數
  - 測試資料生成

**驗收標準**：
- ✅ 訂單編號格式簡化
- ✅ 方便複製和查詢
- ✅ 所有訂單編號位置統一格式

---

#### 4. 平均客單價顯示（銷售統計）⭐⭐
**狀態**：待開發
**影響**：統計資訊不完整

**任務內容**：
- [ ] 在日報表頁面添加平均客單價顯示
- [ ] 計算公式：平均客單價 = 總營業額 ÷ 訂單數
- [ ] 格式化顯示（例如：$204）
- [ ] 添加到統計卡片中

**驗收標準**：
- ✅ 報表頁面顯示平均客單價
- ✅ 數值計算正確
- ✅ 即時更新

---

### 🟡 中優先級 - 優化與增強

#### 3. 折扣優惠系統功能調整
**狀態**：已完成開發，待確認階段歸屬
**說明**：原型已實作完整折扣系統（單一品項/分類/總數量折扣），但規劃文件中標註為 Phase 1 基礎功能

**任務內容**：
- [ ] 確認折扣優惠系統應歸屬 Phase 1 或 Phase 2
- [ ] 如歸屬 Phase 1，更新文件說明
- [ ] 驗證折扣計算邏輯正確性
- [ ] 測試多個折扣規則同時套用的情境

---

#### 4. 規格選擇功能（Phase 2）✅ 已完成
**狀態**：✅ 已完成（2026-02-07）
**優先級**：中（屬於 Phase 2 功能）

**任務內容**：
- [x] 實作辣度選擇（不辣、微辣、中辣、特辣）
- [x] 實作客製化備註（少冰、去冰、加蔥、去蔥等）
- [x] 在點餐流程中整合規格選擇
- [x] 在購物車中顯示選擇的規格
- [ ] 在廚房單中列印規格資訊（待列印功能完成後）

**實作成果**：
- ✅ 規格選擇對話框：辣度按鈕、客製化 checkbox、自訂輸入框
- ✅ 購物車顯示：使用標籤顯示選擇的辣度和備註
- ✅ 結帳單顯示：完整規格資訊列印在結帳頁面
- ✅ 數量選擇：可在規格選擇對話框中調整數量
- ✅ 相同規格合併：同品項同規格會自動累加數量

**驗收標準**：
- ✅ 點擊菜品卡片彈出規格選擇對話框
- ✅ 可以選擇辣度（單選）
- ✅ 可以選擇客製化備註（多選 + 自訂）
- ✅ 可以輸入自訂備註
- ✅ 可以選擇數量
- ✅ 購物車顯示規格資訊
- ✅ 結帳單顯示規格資訊
- ✅ 規格資訊包含在訂單資料中

---

#### 5. 手動折扣按鈕（Phase 2）✅ 已完成
**狀態**：✅ 已完成（2026-02-07）
**優先級**：中（屬於 Phase 2 功能）

**任務內容**：
- [x] 新增快速折扣按鈕（折$10、折$20、折$50）
- [x] 實作自訂折扣金額輸入
- [x] 實作百分比折扣（打9折、打8折）
- [x] 添加折扣原因記錄（會員折扣、活動優惠、服務補償、其他）
- [ ] 實作權限管理（需店長授權）- 未實作，可後續補強

**實作成果**：
- ✅ 快速折扣按鈕：折$10、折$20、折$50 一鍵套用
- ✅ 自訂金額輸入：支援輸入任意金額並套用
- ✅ 百分比折扣：打9折、打8折按鈕
- ✅ 折扣原因選擇：下拉選單選擇原因
- ✅ 清除功能：一鍵清除手動折扣
- ✅ 即時顯示：顯示已套用的手動折扣金額
- ✅ 自動計算：手動折扣與自動折扣正確累加
- ✅ 統計整合：付款完成後正確記錄到統計資料

**驗收標準**：
- ✅ 快速折扣按鈕可正常使用（$10/$20/$50）
- ✅ 可以輸入自訂折扣金額
- ✅ 百分比折扣功能正常（打9折、打8折）
- ✅ 可以選擇/輸入折扣原因
- ✅ 手動折扣與自動折扣正確累加
- ✅ 結帳金額正確計算
- ✅ 購物車顯示手動折扣資訊
- ✅ 付款完成後記錄手動折扣

---

#### 6. 每天結帳條和歷史帳查詢功能（Phase 2）✅ 已完成
**狀態**：✅ 已完成（2026-02-07）
**優先級**：中（屬於 Phase 2 功能）

**任務內容**：
- [x] 整合歷史資料功能到日/週/月報表
- [x] 添加日期查詢區間功能
- [x] 在日報表中添加日期選擇器
- [x] 在週報表中添加週選擇器
- [x] 在月報表中添加月份選擇器
- [x] 實作歷史資料查詢功能
- [x] 實作匯出功能（CSV 格式）
- [x] 快速切換按鈕（今日/昨日/本週/上週/本月/上月）
- [x] 每日結帳確認與保存功能

**實作成果**：
- ✅ **每日結帳條頁面**：
  - 統計卡片：營業額（原價）、總折扣、實收金額、利潤
  - 完整銷售明細表格：訂單號、時間、原價、折扣、實收
  - 匯出結帳明細功能（CSV 格式）
  - 確認結帳功能：將資料保存至 localStorage

- ✅ **歷史資料查詢整合**：
  - 日報表：日期選擇器 + 查詢按鈕 + 今日/昨日快速切換
  - 週報表：週選擇器 + 查詢按鈕 + 本週/上週快速切換
  - 月報表：月份選擇器 + 查詢按鈕 + 本月/上月快速切換
  - 支援查詢歷史任意日期/週/月
  - 資料從 localStorage 讀取

- ✅ **資料持久化**：
  - 每日結帳確認後保存到 `checkoutHistory`
  - 包含完整統計資料和訂單明細
  - 支援匯出為 CSV 檔案

**驗收標準**：
- ✅ 日報表可查詢任意日期
- ✅ 週報表可查詢任意週
- ✅ 月報表可查詢任意月份
- ✅ 資料正確顯示
- ✅ 支援快速切換今日/昨日/本週/上週/本月/上月
- ✅ 每日結帳確認功能正常
- ✅ 匯出 CSV 功能正常

---

### 🟢 低優先級 - 長期規劃

#### 7. 庫存管理系統（Phase 3）
**狀態**：未開發
**優先級**：低（屬於 Phase 3 功能）

**任務內容**：
- [ ] 庫存進貨管理
- [ ] 自動庫存扣減
- [ ] 庫存預警系統
- [ ] 庫存盤點功能
- [ ] 庫存報表

---

#### 7. 會員系統（Phase 3）
**狀態**：未開發
**優先級**：低（屬於 Phase 3 功能）

**任務內容**：
- [ ] 會員註冊與積分
- [ ] 會員等級與折扣
- [ ] 儲值卡功能

---

#### 8. 掃碼點餐（Phase 3）
**狀態**：未開發
**優先級**：低（屬於 Phase 3 功能）

**任務內容**：
- [ ] 顧客掃碼自助點餐
- [ ] 訂單同步到廚房

---

## 下一步行動

1. **確認需求**：與團隊確認功能優先級
2. **UI 設計**：開始繪製介面原型
3. **硬體採購**：確認列印機型號並下單
4. **建置環境**：初始化 Vue 3 專案
5. **開發團隊**：尋找合適的前端開發者
6. **預算批准**：確認開發預算

---

**文件版本**：v5.1
**建立日期**：2026-01-26
**最後更新**：2026-02-08
**維護者**：Claude Code Assistant
**狀態**：Phase 1 原型重構完成（狀態管理架構優化，準備 Vue 3 轉換），列印整合待開發

**更新記錄**：
- v5.1 (2026-02-08)：完成狀態管理架構重構：① 建立統一的 appState 物件整合 20+ 全域變數 ② 建立 CONSTANTS 常數物件移除魔法數字 ③ 建立 StateManager 工具提供統一的狀態存取 API ④ 建立 Utils 工具函數（格式化、計算） ⑤ 建立向後兼容層確保現有程式碼正常運作 ⑥ 移除重複變數宣告修復語法錯誤 ⑦ 新增 REFACTORING-SUMMARY.md 詳細記錄重構內容 ⑧ 為 Vue 3 轉換做好準備（對照 Pinia Store 架構）
- v5.0 (2026-02-08)：完成飲料規格與測試資料優化：① 新增甜度選擇（全糖、少糖、半糖、微糖、無糖）② 飲料溫度（冰/熱）與冰塊（正常/少/去）③ 啤酒不含甜度④ Modal 高度優化（Flexbox 佈局、90vh 最大高度、自動滾動）⑤ 測試資料使用實際品項（可樂、啤酒）⑥ 同一訂單燒烤類統一的口味⑦ 分別存儲 onion、garlic、sauce 欄位⑧ 訂單明細正確顯示完整口味標籤
- v4.9 (2026-02-07)：完成介面優化與觸控改進：① 連續點擊流暢度優化（放寬觸控時間至800ms、改善updateCart邏輯）② 點餐卡片簡化（移除圖片和介紹）③ 結帳畫面優化（隱藏品項口味、金額明細分層、統一規格按鈕化、按鈕樣式統一）④ 口味調整（蔥/蒜/醬依序按鈕、特辣改大辣）⑤ 字體放大（結帳畫面、按鈕、label）⑥ 隱藏百分比折扣按鈕
- v4.8 (2026-02-07)：優化匯出結帳明細功能，支援日期區間查詢匯出；自��讀取多天資料並合併統計；區間查詢時保留匯出按鈕只隱藏關帳按鈕；修正所有繁體中文亂碼問題
- v4.7 (2026-02-07)：完成結帳介面優化（總計和現金付款移至手動折扣下方，確保總計包含手動折扣）；優化訂單編號格式（移除 '-' 符號，方便查詢）
- v4.6 (2026-02-07)：完成 Phase 2 中優先級功能開發：③ 每天結帳條功能（營業統計、銷售明細、匯出、結帳確認）④ 歷史資料查詢整合（日/週/月報表添加日期選擇器，支援查詢任意歷史資料）；優化使用者體驗，移除獨立歷史標籤，將查詢功能整合至各報表頁面
- v4.5 (2026-02-07)：移除預算估算章節，簡化規劃文件專注於技術實作與功能規劃
- v4.4 (2026-02-07)：完成 Phase 2 中優先級功能開發：① 規格選擇功能（辣度 + 客製化備註）② 手動折扣按鈕（快速折扣 + 自訂金額 + 百分比折扣）；更新 prototype.html，功能已整合至點餐流程
- v4.3 (2026-02-07)：新增待辦事項章節，詳細列舉 Phase 1 缺失功能（列印機整合、平均客單價顯示）及 Phase 2/3 功能清單；確定列印整合為最高優先級任務
- v4.2 (2026-02-07)：調整階段規劃，將多種付款方式�� Phase 3 移至 Phase 4；Phase 3 現在專注於庫存管理、會員系統、掃碼點餐；Phase 4 包含電子支付、AI分析、LINE機器人、財務報表
- v4.1 (2026-02-07)：調整階段規劃，將庫存管理系統從 Phase 2 移至 Phase 3；將原 Phase 3 功能（AI分析、LINE機器人、財務報表）移至 Phase 4；各階段功能定位更清晰
- v4.0 (2026-02-07)：新增 Phase 2 功能規劃，包括口味選擇、手動折扣按鈕、每日結帳條、歷史帳查詢、庫存管理系統；將原 Phase 2 付款/會員/掃碼功能移至 Phase 3；更新資料庫結構至版本 2，新增庫存、進貨、結帳相關資料表
- v3.7 (2026-01-27)：優化觸控響應速度，移除所有按鈕過渡動畫，使用 touchstart 事件消除 300ms 延遲，優化菜單點餐、購物車增減、快速金額按鈕的連續點擊體驗
- v3.6 (2026-01-27)：優化觸控體驗，禁止雙指縮放和雙擊放大，防止誤觸導致畫面縮放，提升 iPad 操作體驗
- v3.5 (2026-01-27)：優化收款功能，快速金額按鈕支援累加模式，新增收全額和歸零按鈕，實收金額限制僅能輸入數字
- v3.4 (2026-01-26)：優化報表顯示，熱銷商品不顯示折扣金額，新增獨立折扣明細區域
- v3.3 (2026-01-26)：優化報表統計，營業額改用原價計算，新增利潤顯示，熱銷商品顯示折扣金額
- v3.2 (2026-01-26)：擴充折扣功能，支援跨品項折扣（單一品項、分類折扣、總數量折扣）
- v3.1 (2026-01-26)：新增折扣優惠功能，買幾串折多少的優惠規則
- v3.0 (2026-01-26)：移除方案選擇，確定使用 Vue 3，專注於 Web 版開發
- v2.1 (2026-01-26)：調整為 Web 優先方案，Phase 1 專注於 Web 版開發
- v2.0 (2026-01-26)：確定採用 Vue 3 + Capacitor 方案，加入 App 打包功能
- v1.1 (2026-01-26)：調整為本地資料庫方案，簡化付款方式為現金，移除折扣功能
- v1.0 (2026-01-26)：初版規劃文件

**技術堆疊確定（Phase 1）**：
- ✅ 前端框架：Vue 3 + TypeScript
- ✅ 狀態管理：Pinia
- ✅ UI 組件庫：Vant 4
- ✅ 本地資料庫：IndexedDB (Dexie.js)
- ✅ 建構工具：Vite 5
- ✅ 部署平台：Vercel / Netlify

**Phase 4 擴展（未來）**：
- ⏳ Capacitor 打包為 iOS App
- ⏳ PWA 漸進式 Web App
- ⏳ 電子付款整合
- ⏳ 會員系統

**聯絡方式**：
如有任何問題或需要進一步討論，請聯絡專案負責人。

**備註**：
本文件為開發規劃，具體實施過程中可能會根據實際需求進行調整。
